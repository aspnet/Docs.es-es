---
title: Control de versiones de servicios gRPC
author: jamesnk
description: Obtenga información sobre cómo controlar las versiones de servicios gRPC.
monikerRange: '>= aspnetcore-3.0'
ms.author: jamesnk
ms.date: 01/09/2020
no-loc:
- ':::no-loc(appsettings.json):::'
- ':::no-loc(ASP.NET Core Identity):::'
- ':::no-loc(cookie):::'
- ':::no-loc(Cookie):::'
- ':::no-loc(Blazor):::'
- ':::no-loc(Blazor Server):::'
- ':::no-loc(Blazor WebAssembly):::'
- ':::no-loc(Identity):::'
- ":::no-loc(Let's Encrypt):::"
- ':::no-loc(Razor):::'
- ':::no-loc(SignalR):::'
uid: grpc/versioning
ms.openlocfilehash: 38204b16d041f21221862c566b90a6a9571d26a1
ms.sourcegitcommit: ca34c1ac578e7d3daa0febf1810ba5fc74f60bbf
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/30/2020
ms.locfileid: "93058706"
---
# <a name="versioning-grpc-services"></a><span data-ttu-id="a1869-103">Control de versiones de servicios gRPC</span><span class="sxs-lookup"><span data-stu-id="a1869-103">Versioning gRPC services</span></span>

<span data-ttu-id="a1869-104">Por [James Newton-King](https://twitter.com/jamesnk)</span><span class="sxs-lookup"><span data-stu-id="a1869-104">By [James Newton-King](https://twitter.com/jamesnk)</span></span>

<span data-ttu-id="a1869-105">Las nuevas características agregadas a una aplicación pueden requerir que los servicios gRPC que se proporcionan a los clientes cambien y, en ocasiones, que lo hagan de forma inesperada y repentina.</span><span class="sxs-lookup"><span data-stu-id="a1869-105">New features added to an app can require gRPC services provided to clients to change, sometimes in unexpected and breaking ways.</span></span> <span data-ttu-id="a1869-106">Si cambian los servicios gRPC:</span><span class="sxs-lookup"><span data-stu-id="a1869-106">When gRPC services change:</span></span>

* <span data-ttu-id="a1869-107">Se debe tener en cuenta cómo afectan los cambios a los clientes.</span><span class="sxs-lookup"><span data-stu-id="a1869-107">Consideration should be given on how changes impact clients.</span></span>
* <span data-ttu-id="a1869-108">Se debe implementar una estrategia de control de versiones para admitir los cambios.</span><span class="sxs-lookup"><span data-stu-id="a1869-108">A versioning strategy to support changes should be implemented.</span></span>

## <a name="backwards-compatibility"></a><span data-ttu-id="a1869-109">Compatibilidad con versiones anteriores</span><span class="sxs-lookup"><span data-stu-id="a1869-109">Backwards compatibility</span></span>

<span data-ttu-id="a1869-110">El protocolo gRPC está diseñado para admitir servicios que cambian con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="a1869-110">The gRPC protocol is designed to support services that change over time.</span></span> <span data-ttu-id="a1869-111">Por lo general, las adiciones a los servicios y métodos gRPC suponen cambios secundarios.</span><span class="sxs-lookup"><span data-stu-id="a1869-111">Generally, additions to gRPC services and methods are non-breaking.</span></span> <span data-ttu-id="a1869-112">Los cambios secundarios permiten a los clientes existentes seguir trabajando como de costumbre.</span><span class="sxs-lookup"><span data-stu-id="a1869-112">Non-breaking changes allow existing clients to continue working without changes.</span></span> <span data-ttu-id="a1869-113">La modificación o la eliminación de los servicios gRPC producen cambios importantes.</span><span class="sxs-lookup"><span data-stu-id="a1869-113">Changing or deleting gRPC services are breaking changes.</span></span> <span data-ttu-id="a1869-114">Si un servicio gRPC sufre cambios importantes, los clientes que lo usen deberán actualizarse y volver a implementarse.</span><span class="sxs-lookup"><span data-stu-id="a1869-114">When gRPC services have breaking changes, clients using that service have to be updated and redeployed.</span></span>

<span data-ttu-id="a1869-115">La realización de cambios secundarios en un servicio tiene una serie de ventajas:</span><span class="sxs-lookup"><span data-stu-id="a1869-115">Making non-breaking changes to a service has a number of benefits:</span></span>

* <span data-ttu-id="a1869-116">Los clientes existentes continúan ejecutándose.</span><span class="sxs-lookup"><span data-stu-id="a1869-116">Existing clients continue to run.</span></span>
* <span data-ttu-id="a1869-117">Evita tener que notificar a los clientes los cambios importantes y tener que actualizarlos.</span><span class="sxs-lookup"><span data-stu-id="a1869-117">Avoids work involved with notifying clients of breaking changes, and updating them.</span></span>
* <span data-ttu-id="a1869-118">Solo es necesario documentar y mantener una versión del servicio.</span><span class="sxs-lookup"><span data-stu-id="a1869-118">Only one version of the service needs to be documented and maintained.</span></span>

### <a name="non-breaking-changes"></a><span data-ttu-id="a1869-119">Cambios secundarios</span><span class="sxs-lookup"><span data-stu-id="a1869-119">Non-breaking changes</span></span>

<span data-ttu-id="a1869-120">Los siguientes cambios son secundarios a nivel del protocolo gRPC y a nivel binario de .NET.</span><span class="sxs-lookup"><span data-stu-id="a1869-120">These changes are non-breaking at a gRPC protocol level and .NET binary level.</span></span>

* <span data-ttu-id="a1869-121">**Adición de un nuevo servicio**</span><span class="sxs-lookup"><span data-stu-id="a1869-121">**Adding a new service**</span></span>
* <span data-ttu-id="a1869-122">**Adición de un nuevo método en un servicio**</span><span class="sxs-lookup"><span data-stu-id="a1869-122">**Adding a new method to a service**</span></span>
* <span data-ttu-id="a1869-123">**Adición de un campo en un mensaje de solicitud** : los campos agregados en un mensaje de solicitud se deserializan con el [valor predeterminado](https://developers.google.com/protocol-buffers/docs/proto3#default) en el servidor cuando no se fija un valor.</span><span class="sxs-lookup"><span data-stu-id="a1869-123">**Adding a field to a request message** - Fields added to a request message are deserialized with the [default value](https://developers.google.com/protocol-buffers/docs/proto3#default) on the server when not set.</span></span> <span data-ttu-id="a1869-124">Para ser un cambio secundario, el servicio debe funcionar correctamente en los casos en los que los clientes más antiguos no establezcan el nuevo campo.</span><span class="sxs-lookup"><span data-stu-id="a1869-124">To be a non-breaking change, the service must succeed when the new field isn't set by older clients.</span></span>
* <span data-ttu-id="a1869-125">**Adición de un campo en un mensaje de respuesta** : los campos agregados en un mensaje de respuesta se deserializan en la colección [campos desconocidos](https://developers.google.com/protocol-buffers/docs/proto3#unknowns) del mensaje del cliente.</span><span class="sxs-lookup"><span data-stu-id="a1869-125">**Adding a field to a response message** - Fields added to a response message are deserialized into the message's [unknown fields](https://developers.google.com/protocol-buffers/docs/proto3#unknowns) collection on the client.</span></span>
* <span data-ttu-id="a1869-126">**Adición de un valor en una enumeración** : las enumeraciones se serializan como un valor numérico.</span><span class="sxs-lookup"><span data-stu-id="a1869-126">**Adding a value to an enum** - Enums are serialized as a numeric value.</span></span> <span data-ttu-id="a1869-127">Los nuevos valores de enumeración se deserializan en el cliente en el valor de enumeración sin un nombre de enumeración.</span><span class="sxs-lookup"><span data-stu-id="a1869-127">New enum values are deserialized on the client to the enum value without an enum name.</span></span> <span data-ttu-id="a1869-128">Para que sea un cambio secundario, los clientes más antiguos deben ejecutarse correctamente al recibir el nuevo valor de enumeración.</span><span class="sxs-lookup"><span data-stu-id="a1869-128">To be a non-breaking change, older clients must run correctly when receiving the new enum value.</span></span>

### <a name="binary-breaking-changes"></a><span data-ttu-id="a1869-129">Cambios binarios importantes</span><span class="sxs-lookup"><span data-stu-id="a1869-129">Binary breaking changes</span></span>

<span data-ttu-id="a1869-130">Los siguientes cambios son secundarios en el nivel del protocolo gRPC, pero es necesario actualizar el cliente si pasa a usar el contrato *.proto* o el ensamblado .NET de cliente más reciente.</span><span class="sxs-lookup"><span data-stu-id="a1869-130">The following changes are non-breaking at a gRPC protocol level, but the client needs to be updated if it upgrades to the latest *.proto* contract or client .NET assembly.</span></span> <span data-ttu-id="a1869-131">La compatibilidad binaria es importante si tiene previsto publicar una biblioteca de gRPC en NuGet.</span><span class="sxs-lookup"><span data-stu-id="a1869-131">Binary compatibility is important if you plan to publish a gRPC library to NuGet.</span></span>

* <span data-ttu-id="a1869-132">**Eliminación de un campo** : los valores de un campo eliminado se deserializan en [campos desconocidos](https://developers.google.com/protocol-buffers/docs/proto3#unknowns) de un mensaje.</span><span class="sxs-lookup"><span data-stu-id="a1869-132">**Removing a field** - Values from a removed field are deserialized to a message's [unknown fields](https://developers.google.com/protocol-buffers/docs/proto3#unknowns).</span></span> <span data-ttu-id="a1869-133">No se trata de un cambio importante del protocolo gRPC, pero el cliente debe actualizarse si pasa a usar el contrato más reciente.</span><span class="sxs-lookup"><span data-stu-id="a1869-133">This isn't a gRPC protocol breaking change, but the client needs to be updated if it upgrades to the latest contract.</span></span> <span data-ttu-id="a1869-134">Es importante que un número de campo eliminado no se vuelva a usar accidentalmente en el futuro.</span><span class="sxs-lookup"><span data-stu-id="a1869-134">It's important that a removed field number isn't accidentally reused in the future.</span></span> <span data-ttu-id="a1869-135">Para asegurarse de que esto no suceda, especifique en el mensaje los nombres y números de los campos eliminados con la palabra clave [reservada](https://developers.google.com/protocol-buffers/docs/proto3#reserved) de Protobuf.</span><span class="sxs-lookup"><span data-stu-id="a1869-135">To ensure this doesn't happen, specify deleted field numbers and names on the message using Protobuf's [reserved](https://developers.google.com/protocol-buffers/docs/proto3#reserved) keyword.</span></span>
* <span data-ttu-id="a1869-136">**Cambio de nombre de un mensaje** : los nombres de los mensajes no se envían normalmente en la red, por lo que no se trata de un cambio importante del protocolo gRPC.</span><span class="sxs-lookup"><span data-stu-id="a1869-136">**Renaming a message** - Message names aren't typically sent on the network, so this isn't a gRPC protocol breaking change.</span></span> <span data-ttu-id="a1869-137">El cliente deberá actualizarse si pasa a usar el contrato más reciente.</span><span class="sxs-lookup"><span data-stu-id="a1869-137">The client will need to be updated if it upgrades to the latest contract.</span></span> <span data-ttu-id="a1869-138">Una situación en la que los nombres de mensaje **sí** se envían en la red es en el caso de los campos [Any](https://developers.google.com/protocol-buffers/docs/proto3#any), cuando el nombre del mensaje se usa para identificar el tipo de mensaje.</span><span class="sxs-lookup"><span data-stu-id="a1869-138">One situation where message names **are** sent on the network is with [Any](https://developers.google.com/protocol-buffers/docs/proto3#any) fields, when the message name is used to identify the message type.</span></span>
* <span data-ttu-id="a1869-139">**Cambio de csharp_namespace** : al modificar `csharp_namespace`, cambiará el espacio de nombres de los tipos .NET generados.</span><span class="sxs-lookup"><span data-stu-id="a1869-139">**Changing csharp_namespace** - Changing `csharp_namespace` will change the namespace of generated .NET types.</span></span> <span data-ttu-id="a1869-140">No se trata de un cambio importante del protocolo gRPC, pero el cliente debe actualizarse si pasa a usar el contrato más reciente.</span><span class="sxs-lookup"><span data-stu-id="a1869-140">This isn't a gRPC protocol breaking change, but the client needs to be updated if it upgrades to the latest contract.</span></span>

### <a name="protocol-breaking-changes"></a><span data-ttu-id="a1869-141">Cambios importantes de protocolo</span><span class="sxs-lookup"><span data-stu-id="a1869-141">Protocol breaking changes</span></span>

<span data-ttu-id="a1869-142">Los elementos siguientes son cambios binarios y de protocolo importantes:</span><span class="sxs-lookup"><span data-stu-id="a1869-142">The following items are protocol and binary breaking changes:</span></span>

* <span data-ttu-id="a1869-143">**Cambio de nombre de un campo** : en el contenido de Protobuf, los nombres de campos solo se usan en el código generado.</span><span class="sxs-lookup"><span data-stu-id="a1869-143">**Renaming a field** - With Protobuf content, the field names are only used in generated code.</span></span> <span data-ttu-id="a1869-144">El número de campo se usa para identificar los campos de la red.</span><span class="sxs-lookup"><span data-stu-id="a1869-144">The field number is used to identify fields on the network.</span></span> <span data-ttu-id="a1869-145">La modificación del nombre de un campo no es un cambio importante en el protocolo para Protobuf.</span><span class="sxs-lookup"><span data-stu-id="a1869-145">Renaming a field isn't a protocol breaking change for Protobuf.</span></span> <span data-ttu-id="a1869-146">Sin embargo, si un servidor usa contenido JSON, modificar el nombre de un campo sí se considera un cambio importante.</span><span class="sxs-lookup"><span data-stu-id="a1869-146">However, if a server is using JSON content then renaming a field is a breaking change.</span></span>
* <span data-ttu-id="a1869-147">**Cambio de un tipo de datos de campo** : si cambia el tipo de datos de un campo por un [tipo incompatible](https://developers.google.com/protocol-buffers/docs/proto3#updating), se producirán errores al deserializar el mensaje.</span><span class="sxs-lookup"><span data-stu-id="a1869-147">**Changing a field data type** - Changing a field's data type to an [incompatible type](https://developers.google.com/protocol-buffers/docs/proto3#updating) will cause errors when deserializing the message.</span></span> <span data-ttu-id="a1869-148">Aunque el nuevo tipo de datos sea compatible, es probable que el cliente deba actualizarse para admitir el nuevo tipo si pasa a usar el contrato más reciente.</span><span class="sxs-lookup"><span data-stu-id="a1869-148">Even if the new data type is compatible, it's likely the client needs to be updated to support the new type if it upgrades to the latest contract.</span></span>
* <span data-ttu-id="a1869-149">**Cambio de un número de campo** : con las cargas de Protobuf, el número de campo se usa para identificar los campos de la red.</span><span class="sxs-lookup"><span data-stu-id="a1869-149">**Changing a field number** - With Protobuf payloads, the field number is used to identify fields on the network.</span></span>
* <span data-ttu-id="a1869-150">**Cambio de nombre de un paquete, un servicio o un método** : gRPC se usa el nombre del paquete, del servicio y del método para generar la dirección URL.</span><span class="sxs-lookup"><span data-stu-id="a1869-150">**Renaming a package, service or method** - gRPC uses the package name, service name, and method name to build the URL.</span></span> <span data-ttu-id="a1869-151">El cliente recibe el estado *SIN IMPLEMENTAR* del servidor.</span><span class="sxs-lookup"><span data-stu-id="a1869-151">The client gets an *UNIMPLEMENTED* status from the server.</span></span>
* <span data-ttu-id="a1869-152">**Eliminación de un servicio o método** : el cliente recibe el estado *SIN IMPLEMENTAR* del servidor al llamar al método eliminado.</span><span class="sxs-lookup"><span data-stu-id="a1869-152">**Removing a service or method** - The client gets an *UNIMPLEMENTED* status from the server when calling the removed method.</span></span>

### <a name="behavior-breaking-changes"></a><span data-ttu-id="a1869-153">Cambios importantes de comportamiento</span><span class="sxs-lookup"><span data-stu-id="a1869-153">Behavior breaking changes</span></span>

<span data-ttu-id="a1869-154">Al realizar cambios secundarios, también debe tener en cuenta si los clientes más antiguos pueden seguir trabajando con el nuevo comportamiento del servicio.</span><span class="sxs-lookup"><span data-stu-id="a1869-154">When making non-breaking changes, you must also consider whether older clients can continue working with the new service behavior.</span></span> <span data-ttu-id="a1869-155">Por ejemplo, agregar un nuevo campo a un mensaje de solicitud:</span><span class="sxs-lookup"><span data-stu-id="a1869-155">For example, adding a new field to a request message:</span></span>

* <span data-ttu-id="a1869-156">No es un cambio importante de protocolo.</span><span class="sxs-lookup"><span data-stu-id="a1869-156">Isn't a protocol breaking change.</span></span>
* <span data-ttu-id="a1869-157">Devuelve un estado de error en el servidor si el nuevo campo no está establecido y se convierte en un cambio importante para los clientes antiguos.</span><span class="sxs-lookup"><span data-stu-id="a1869-157">Returning an error status on the server if the new field isn't set makes it a breaking change for old clients.</span></span>

<span data-ttu-id="a1869-158">La compatibilidad con el comportamiento la determina el código específico de su aplicación.</span><span class="sxs-lookup"><span data-stu-id="a1869-158">Behavior compatibility is determined by your app-specific code.</span></span>

## <a name="version-number-services"></a><span data-ttu-id="a1869-159">Servicios de número de versión</span><span class="sxs-lookup"><span data-stu-id="a1869-159">Version number services</span></span>

<span data-ttu-id="a1869-160">Es conveniente procurar que los servicios sigan siendo compatibles con versiones anteriores de los clientes antiguos.</span><span class="sxs-lookup"><span data-stu-id="a1869-160">Services should strive to remain backwards compatible with old clients.</span></span> <span data-ttu-id="a1869-161">Es posible que los cambios realizados en la aplicación requieran cambios importantes.</span><span class="sxs-lookup"><span data-stu-id="a1869-161">Eventually changes to your app may require breaking changes.</span></span> <span data-ttu-id="a1869-162">Introducir cambios en los clientes antiguos y exigir su actualización con un servicio nuevo no es una buena experiencia de usuario.</span><span class="sxs-lookup"><span data-stu-id="a1869-162">Breaking old clients and forcing them to be updated along with your service isn't a good user experience.</span></span> <span data-ttu-id="a1869-163">Una manera de mantener la compatibilidad con versiones anteriores al realizar cambios importantes es publicar varias versiones de un servicio.</span><span class="sxs-lookup"><span data-stu-id="a1869-163">A way to maintain backwards compatibility while making breaking changes is to publish multiple versions of a service.</span></span>

<span data-ttu-id="a1869-164">gRPC admite un especificador de [paquete](https://developers.google.com/protocol-buffers/docs/proto3#packages) opcional, que funciona de manera muy similar a un espacio de nombres de .NET.</span><span class="sxs-lookup"><span data-stu-id="a1869-164">gRPC supports an optional [package](https://developers.google.com/protocol-buffers/docs/proto3#packages) specifier, which functions much like a .NET namespace.</span></span> <span data-ttu-id="a1869-165">De hecho, `package` se usará como el espacio de nombres de .NET para los tipos .NET generados si `option csharp_namespace` no se establece en el archivo *.proto*.</span><span class="sxs-lookup"><span data-stu-id="a1869-165">In fact, the `package` will be used as the .NET namespace for generated .NET types if `option csharp_namespace` is not set in the *.proto* file.</span></span> <span data-ttu-id="a1869-166">El paquete se puede usar para especificar un número de versión para el servicio y sus mensajes:</span><span class="sxs-lookup"><span data-stu-id="a1869-166">The package can be used to specify a version number for your service and its messages:</span></span>

[!code-protobuf[](versioning/sample/greet.v1.proto?highlight=3)]

<span data-ttu-id="a1869-167">El nombre del paquete se combina con el nombre del servicio para identificar una dirección de servicio.</span><span class="sxs-lookup"><span data-stu-id="a1869-167">The package name is combined with the service name to identify a service address.</span></span> <span data-ttu-id="a1869-168">Una dirección de servicio permite hospedar varias versiones de un servicio en paralelo:</span><span class="sxs-lookup"><span data-stu-id="a1869-168">A service address allows multiple versions of a service to be hosted side-by-side:</span></span>

* `greet.v1.Greeter`
* `greet.v2.Greeter`

<span data-ttu-id="a1869-169">Las implementaciones del servicio con versiones se registran en *Startup.cs* :</span><span class="sxs-lookup"><span data-stu-id="a1869-169">Implementations of the versioned service are registered in *Startup.cs* :</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    // Implements greet.v1.Greeter
    endpoints.MapGrpcService<GreeterServiceV1>();

    // Implements greet.v2.Greeter
    endpoints.MapGrpcService<GreeterServiceV2>();
});
```

<span data-ttu-id="a1869-170">Incluir un número de versión en el nombre del paquete le permite publicar una versión  *v2* de su servicio con cambios importantes, a la vez que continúa admitiendo clientes más antiguos que llaman a la versión  *v1*.</span><span class="sxs-lookup"><span data-stu-id="a1869-170">Including a version number in the package name gives you the opportunity to publish a *v2* version of your service with breaking changes, while continuing to support older clients who call the *v1* version.</span></span> <span data-ttu-id="a1869-171">Una vez que los clientes se hayan actualizado para usar el servicio  *v2* , podrá eliminar la versión anterior.</span><span class="sxs-lookup"><span data-stu-id="a1869-171">Once clients have updated to use the *v2* service, you can choose to remove the old version.</span></span> <span data-ttu-id="a1869-172">A la hora de planificar la publicación de varias versiones de un servicio:</span><span class="sxs-lookup"><span data-stu-id="a1869-172">When planning to publish multiple versions of a service:</span></span>

* <span data-ttu-id="a1869-173">Evite introducir cambios importantes, si es posible.</span><span class="sxs-lookup"><span data-stu-id="a1869-173">Avoid breaking changes if reasonable.</span></span>
* <span data-ttu-id="a1869-174">No actualice el número de versión a menos que realice cambios importantes.</span><span class="sxs-lookup"><span data-stu-id="a1869-174">Don't update the version number unless making breaking changes.</span></span>
* <span data-ttu-id="a1869-175">Actualice el número de versión cuando realice cambios importantes.</span><span class="sxs-lookup"><span data-stu-id="a1869-175">Do update the version number when you make breaking changes.</span></span>

<span data-ttu-id="a1869-176">Al publicar varias versiones de un servicio, este se duplica.</span><span class="sxs-lookup"><span data-stu-id="a1869-176">Publishing multiple versions of a service duplicates it.</span></span> <span data-ttu-id="a1869-177">Para reducir la duplicación, le recomendamos mover la lógica de negocios de las implementaciones de servicio a una ubicación centralizada que se pueda reutilizar en las implementaciones antiguas y nuevas:</span><span class="sxs-lookup"><span data-stu-id="a1869-177">To reduce duplication, consider moving business logic from the service implementations to a centralized location that can be reused by the old and new implementations:</span></span>

[!code-csharp[](versioning/sample/GreeterServiceV1.cs?highlight=10,19)]

<span data-ttu-id="a1869-178">Los servicios y mensajes generados con distintos nombres de paquetes son **diferentes tipos de .NET**.</span><span class="sxs-lookup"><span data-stu-id="a1869-178">Services and messages generated with different package names are **different .NET types**.</span></span> <span data-ttu-id="a1869-179">Mover la lógica de negocios a una ubicación centralizada requiere la asignación de mensajes a tipos comunes.</span><span class="sxs-lookup"><span data-stu-id="a1869-179">Moving business logic to a centralized location requires mapping messages to common types.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="a1869-180">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="a1869-180">Additional resources</span></span>

* <xref:grpc/protobuf>
