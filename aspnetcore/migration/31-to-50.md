---
title: Migrar de ASP.NET Core 3,1 a 5,0
author: scottaddie
description: Obtenga información sobre cómo migrar un proyecto ASP.NET Core 3,1 a ASP.NET Core 5,0.
ms.author: scaddie
ms.custom: mvc
ms.date: 12/02/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: migration/31-to-50
ms.openlocfilehash: 355eb545d59246425c6bc2dda5d22c89c7c2afa8
ms.sourcegitcommit: 92439194682dc788b8b5b3a08bd2184dc00e200b
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 12/03/2020
ms.locfileid: "96556637"
---
# <a name="migrate-from-aspnet-core-31-to-50"></a><span data-ttu-id="ccbf8-103">Migrar de ASP.NET Core 3,1 a 5,0</span><span class="sxs-lookup"><span data-stu-id="ccbf8-103">Migrate from ASP.NET Core 3.1 to 5.0</span></span>

<span data-ttu-id="ccbf8-104">Por [Scott Addie](https://github.com/scottaddie)</span><span class="sxs-lookup"><span data-stu-id="ccbf8-104">By [Scott Addie](https://github.com/scottaddie)</span></span>

<span data-ttu-id="ccbf8-105">En este artículo se explica cómo actualizar un proyecto ASP.NET Core 3,1 existente a ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-105">This article explains how to update an existing ASP.NET Core 3.1 project to ASP.NET Core 5.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="ccbf8-106">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="ccbf8-106">Prerequisites</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="ccbf8-107">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="ccbf8-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-5.0.md)]

# <a name="visual-studio-code"></a>[<span data-ttu-id="ccbf8-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="ccbf8-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-5.0.md)]

# <a name="visual-studio-for-mac"></a>[<span data-ttu-id="ccbf8-109">Visual Studio para Mac</span><span class="sxs-lookup"><span data-stu-id="ccbf8-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-5.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="ccbf8-110">Actualización de la versión del SDK de .NET Core en global.json</span><span class="sxs-lookup"><span data-stu-id="ccbf8-110">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="ccbf8-111">Si confía [ en unaglobal.jsen](/dotnet/core/tools/global-json) archivo para tener como destino una versión de SDK de .net Core específica, actualice la `version` propiedad a la versión del SDK de .net 5,0 que está instalada.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-111">If you rely upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update the `version` property to the .NET 5.0 SDK version that's installed.</span></span> <span data-ttu-id="ccbf8-112">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-112">For example:</span></span>

```diff
{
  "sdk": {
-    "version": "3.1.200"
+    "version": "5.0.100"
  }
}
```

## <a name="update-the-target-framework"></a><span data-ttu-id="ccbf8-113">Actualización de la plataforma de destino</span><span class="sxs-lookup"><span data-stu-id="ccbf8-113">Update the target framework</span></span>

<span data-ttu-id="ccbf8-114">Si actualiza un Blazor WebAssembly proyecto, vaya a la sección [actualizar Blazor WebAssembly proyectos](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-114">If updating a Blazor WebAssembly project, skip to the [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) section.</span></span> <span data-ttu-id="ccbf8-115">Para cualquier otro tipo de proyecto de ASP.NET Core, actualice el [moniker de la plataforma de destino (TFM)](/dotnet/standard/frameworks) del archivo de proyecto a `net5.0` :</span><span class="sxs-lookup"><span data-stu-id="ccbf8-115">For any other ASP.NET Core project type, update the project file's [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `net5.0`:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
  </PropertyGroup>

</Project>
```

<!-- HOLD until 5.0.1 package is released

## Changes to Blazor app routing logic in 5.0.1

The computation of route precedence changed in the ASP.NET Core 5.0.1 patch release. This might affect you if you've defined catch-all routes or routes with optional parameters.

### Old behavior

With the prior behavior in ASP.NET Core 5.0.0 or earlier, routes with lower precedence, such as `{*slug}`, are matched before routes with higher precedence, such as `/customer/{id}`.

### New behavior

The new behavior in ASP.NET Core 5.0.1 or later more closely matches the routing behavior defined in ASP.NET Core apps, where the framework computes and establishes the route precedence for each segment first and only uses the length of the route to break ties as a secondary criteria.

### Reason for change

The original behavior is considered a bug in the implementation because our goal is for the Blazor routing system to behave in the same way as the ASP.NET Core routing system for the subset of features supported by Blazor routing.

### Recommended action

Add the `PreferExactMatches` attribute to the `Router` component in the `App.razor` file to opt into the correct behavior:

```razor
<Router AppAssembly="@typeof(Program).Assembly" PreferExactMatches="true">
```

When `PreferExactMatches` is set to `true`, route matching prefers exact matches over wildcards.

> [!IMPORTANT]
> All apps should explicitly set `PreferExactMatches` to `true`.
>
> The ability to set the option to `false` or leave it unset, which defaults the option to `false`, *is only provided for backward compatibility*.
>
> When .NET 6 is released, the router will always prefer exact matches, and the `PreferExactMatches` option won't be available.

-->

## <a name="update-no-locblazor-webassembly-and-no-locblazor-server-projects"></a><span data-ttu-id="ccbf8-116">Actualizar Blazor WebAssembly y Blazor Server proyectos</span><span class="sxs-lookup"><span data-stu-id="ccbf8-116">Update Blazor WebAssembly and Blazor Server projects</span></span>

<span data-ttu-id="ccbf8-117">*Las instrucciones de esta sección se aplican a ambos Blazor modelos de hospedaje. En las secciones que siguen a esta sección se proporcionan instrucciones adicionales específicas para el hospedaje de modelos y tipos de aplicaciones. Aplique la guía de todas las secciones pertinentes a la aplicación.*</span><span class="sxs-lookup"><span data-stu-id="ccbf8-117">*The guidance in this section applies to both Blazor hosting models. Sections following this section provide additional guidance specific to hosting models and app types. Apply the guidance from all relevant sections to your app.*</span></span>

1. <span data-ttu-id="ccbf8-118">En `wwwroot/index.html` una Blazor WebAssembly aplicación o en la `Pages/_Host.cshtml` de una Blazor Server aplicación, agregue un `<link>` elemento al `<head>` elemento para los estilos.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-118">In `wwwroot/index.html` of a Blazor WebAssembly app or the `Pages/_Host.cshtml` of a Blazor Server app, add a `<link>` element to the `<head>` element for styles.</span></span> <span data-ttu-id="ccbf8-119">En los siguientes `<link>` valores de atributo de elemento `href` , el marcador de posición `{ASSEMBLY NAME}` es el nombre de ensamblado de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-119">In the following `<link>` element `href` attribute values, the placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

    ```diff
    +<link href="{ASSEMBLY NAME}.styles.css" rel="stylesheet" />
    ```
    
    <span data-ttu-id="ccbf8-120">Independiente Blazor WebAssembly o Blazor Server ejemplo:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-120">Standalone Blazor WebAssembly or Blazor Server example:</span></span>
    
    ```diff
    +<link href="BlazorSample.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="ccbf8-121">*`Client`* ejemplo de proyecto de una solución hospedada Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="ccbf8-121">*`Client`* project of a hosted Blazor WebAssembly solution example:</span></span>
    
    ```diff
    +<link href="BlazorSample.Client.styles.css" rel="stylesheet" />
    ```

1. <span data-ttu-id="ccbf8-122">Incluya un nuevo espacio de nombres en el archivo de la aplicación `_Imports.razor` para la [virtualización de componentes](xref:blazor/components/virtualization) <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-122">Include a new namespace in the app's `_Imports.razor` file for [component virtualization](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName>.</span></span> <span data-ttu-id="ccbf8-123">Los `_Imports.razor` archivos siguientes muestran los espacios de nombres predeterminados en las aplicaciones generadas a partir de las Blazor plantillas de proyecto.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-123">The following `_Imports.razor` files show the default namespaces in apps generated from the Blazor project templates.</span></span> <span data-ttu-id="ccbf8-124">El marcador de posición `{ASSEMBLY NAME}` es el nombre del ensamblado de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-124">The placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

   <span data-ttu-id="ccbf8-125">Blazor WebAssembly (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="ccbf8-125">Blazor WebAssembly (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using System.Net.Http.Json
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.AspNetCore.Components.WebAssembly.Http
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```

   <span data-ttu-id="ccbf8-126">Blazor Server (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="ccbf8-126">Blazor Server (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using Microsoft.AspNetCore.Authorization
   @using Microsoft.AspNetCore.Components.Authorization
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```
   
1. <span data-ttu-id="ccbf8-127">En el `MainLayout` componente ( `Shared/MainLayout.razor` ), rodee el marcado HTML del componente con un `<div>` elemento que tenga un `class` atributo establecido en `page` :</span><span class="sxs-lookup"><span data-stu-id="ccbf8-127">In the `MainLayout` component (`Shared/MainLayout.razor`), surround the component's HTML markup with a `<div>` element that has a `class` attribute set to `page`:</span></span>

    ```razor
    <div class="page">
    
        ...
        
    </div>
    ```
    
1. <span data-ttu-id="ccbf8-128">Agregue los siguientes archivos a la `Shared` carpeta:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-128">Add the following files to the `Shared` folder:</span></span>

    <span data-ttu-id="ccbf8-129">`MainLayout.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-129">`MainLayout.razor.css`:</span></span>
    
    ```css
    .page {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .main {
        flex: 1;
    }

    .sidebar {
        background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
    }

    .top-row {
        background-color: #f7f7f7;
        border-bottom: 1px solid #d6d5d5;
        justify-content: flex-end;
        height: 3.5rem;
        display: flex;
        align-items: center;
    }

        .top-row ::deep a, .top-row .btn-link {
            white-space: nowrap;
            margin-left: 1.5rem;
        }

        .top-row a:first-child {
            overflow: hidden;
            text-overflow: ellipsis;
        }

    @media (max-width: 767.98px) {
        .top-row:not(.auth) {
            display: none;
        }

        .top-row.auth {
            justify-content: space-between;
        }

        .top-row a, .top-row .btn-link {
            margin-left: 0;
        }
    }

    @media (min-width: 768px) {
        .page {
            flex-direction: row;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .top-row {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .main > div {
            padding-left: 2rem !important;
            padding-right: 1.5rem !important;
        }
    }
    ```
    
    <span data-ttu-id="ccbf8-130">`NavMenu.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-130">`NavMenu.razor.css`:</span></span>
    
    ```css
    .navbar-toggler {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .top-row {
        height: 3.5rem;
        background-color: rgba(0,0,0,0.4);
    }

    .navbar-brand {
        font-size: 1.1rem;
    }

    .oi {
        width: 2rem;
        font-size: 1.1rem;
        vertical-align: text-top;
        top: -2px;
    }

    .nav-item {
        font-size: 0.9rem;
        padding-bottom: 0.5rem;
    }

        .nav-item:first-of-type {
            padding-top: 1rem;
        }

        .nav-item:last-of-type {
            padding-bottom: 1rem;
        }

        .nav-item ::deep a {
            color: #d7d7d7;
            border-radius: 4px;
            height: 3rem;
            display: flex;
            align-items: center;
            line-height: 3rem;
        }

    .nav-item ::deep a.active {
        background-color: rgba(255,255,255,0.25);
        color: white;
    }

    .nav-item ::deep a:hover {
        background-color: rgba(255,255,255,0.1);
        color: white;
    }

    @media (min-width: 768px) {
        .navbar-toggler {
            display: none;
        }

        .collapse {
            /* Never collapse the sidebar for wide screens */
            display: block;
        }
    }
    ```

1. <span data-ttu-id="ccbf8-131">El archivo base más reciente `wwwroot/css/app.css` de una Blazor WebAssembly aplicación o un `wwwroot/css/site.css` archivo de una Blazor Server aplicación incluye los siguientes estilos.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-131">The latest base `wwwroot/css/app.css` file of a Blazor WebAssembly app or `wwwroot/css/site.css` file of a Blazor Server app includes the following styles.</span></span> <span data-ttu-id="ccbf8-132">Quite los estilos adicionales que dejen los siguientes estilos y los que haya agregado a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-132">Remove extra styles leaving the following styles and any that you've added to the app.</span></span>

    <span data-ttu-id="ccbf8-133">La siguiente hoja de estilos solo incluye estilos base y **no** incluye los estilos personalizados agregados por el desarrollador:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-133">The following stylesheet only includes base styles and does **not** include custom styles added by the developer:</span></span>
   
    ```css
    @import url('open-iconic/font/css/open-iconic-bootstrap.min.css');

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    a, .btn-link {
        color: #0366d6;
    }

    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    .content {
        padding-top: 1.1rem;
    }

    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }

    .invalid {
        outline: 1px solid red;
    }

    .validation-message {
        color: red;
    }

    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    ```

## <a name="update-no-locblazor-webassembly-projects"></a><span data-ttu-id="ccbf8-134">Actualizar Blazor WebAssembly proyectos</span><span class="sxs-lookup"><span data-stu-id="ccbf8-134">Update Blazor WebAssembly projects</span></span>

<span data-ttu-id="ccbf8-135">Siga las instrucciones de la sección anterior de la [actualización Blazor WebAssembly y los Blazor Server proyectos](#update-blazor-webassembly-and-blazor-server-projects) .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-135">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) section.</span></span>

<span data-ttu-id="ccbf8-136">Para un Blazor WebAssembly proyecto, incluido el *`Client`* proyecto de una solución hospedada Blazor , aplique los siguientes cambios al archivo de proyecto:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-136">For a Blazor WebAssembly project, including the *`Client`* project of a hosted Blazor solution, apply the following changes to the project file:</span></span>

1. <span data-ttu-id="ccbf8-137">Actualice el SDK de `Microsoft.NET.Sdk.Web` a `Microsoft.NET.Sdk.BlazorWebAssembly` :</span><span class="sxs-lookup"><span data-stu-id="ccbf8-137">Update the SDK from `Microsoft.NET.Sdk.Web` to `Microsoft.NET.Sdk.BlazorWebAssembly`:</span></span>

    ```diff
    - <Project Sdk="Microsoft.NET.Sdk.Web">
    + <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    ```
    
    > [!NOTE]
    > <span data-ttu-id="ccbf8-138">Esta actualización solo se aplica a Blazor WebAssembly los proyectos independientes y a los *`Client`* proyectos de soluciones hospedadas Blazor .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-138">This update only applies to standalone Blazor WebAssembly projects and the *`Client`* projects of hosted Blazor solutions.</span></span>

1. <span data-ttu-id="ccbf8-139">Actualice las siguientes propiedades:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-139">Update the following properties:</span></span>

    ```diff
    <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    
      <PropertyGroup>
    -     <TargetFramework>netstandard2.1</TargetFramework>
    -     <RazorLangVersion>3.0</RazorLangVersion>
    +     <TargetFramework>net5.0</TargetFramework>
      </PropertyGroup>
    ```

1. <span data-ttu-id="ccbf8-140">Quite la referencia de paquete a [Microsoft. AspNetCore. Components. Webassembly. Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span><span class="sxs-lookup"><span data-stu-id="ccbf8-140">Remove the package reference to [Microsoft.AspNetCore.Components.WebAssembly.Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span></span>

    ```diff
    <ItemGroup>
    -    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Build" Version="3.2.1" PrivateAssets="all" />
    ```

1. <span data-ttu-id="ccbf8-141">Actualice otros paquetes a sus versiones más recientes.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-141">Update other packages to their latest versions.</span></span> <span data-ttu-id="ccbf8-142">Las versiones más recientes se pueden encontrar en [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="ccbf8-142">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

1. <span data-ttu-id="ccbf8-143">En `wwwroot/index.html` , cambie el elemento que carga el `App` componente a un `<div>` elemento con un `id` establecido en `app` :</span><span class="sxs-lookup"><span data-stu-id="ccbf8-143">In `wwwroot/index.html`, change the element that loads the `App` component to a `<div>` element with an `id` set to `app`:</span></span>
    
    ```diff
    -<app>Loading...</app>
    +<div id="app">Loading...</div>
    ```
    
1. <span data-ttu-id="ccbf8-144">En `Program.Main` (`Program.cs`):</span><span class="sxs-lookup"><span data-stu-id="ccbf8-144">In `Program.Main` (`Program.cs`):</span></span>

   * <span data-ttu-id="ccbf8-145">Cambie la referencia al `<app>` elemento a un selector de CSS agregando un hash `#` a él.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-145">Change the reference to the `<app>` element to a CSS selector by adding a hash `#` to it.</span></span>
   * <span data-ttu-id="ccbf8-146">Cambiar el `HttpClient` registro a ámbito.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-146">Change the `HttpClient` registration to scoped.</span></span>

    ```diff
    -builder.RootComponents.Add<App>("app");
    +builder.RootComponents.Add<App>("#app");
    
    -builder.Services.AddTransient(sp => new HttpClient 
    -    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    +builder.Services.AddScoped(sp => new HttpClient 
    +    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    ```

### <a name="standalone-no-locblazor-webassembly-app-with-microsoft-accounts"></a><span data-ttu-id="ccbf8-147">Blazor WebAssemblyAplicación independiente con cuentas de Microsoft</span><span class="sxs-lookup"><span data-stu-id="ccbf8-147">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>

<span data-ttu-id="ccbf8-148">Siga las instrucciones de [las secciones Blazor WebAssembly ](#update-blazor-webassembly-projects) actualizar proyectos y proyectos de [actualización Blazor WebAssembly Blazor Server ](#update-blazor-webassembly-and-blazor-server-projects) anteriores.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-148">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="ccbf8-149">Para una Blazor WebAssembly aplicación independiente registrada en el Azure portal usar Azure Active Directory (AAD) para las cuentas de Microsoft:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-149">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) for Microsoft Accounts:</span></span>

* <span data-ttu-id="ccbf8-150">La aplicación requiere los `openid` `offline_access` ámbitos y:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-150">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="ccbf8-151">En la hoja Azure Portal la **autenticación** del registro de aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-151">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="ccbf8-152">Quite la configuración de plataforma **Web** .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-152">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="ccbf8-153">Agregue una configuración de plataforma de aplicación de una **sola página** con el URI de redireccionamiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-153">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="ccbf8-154">Deshabilite la **concesión implícita** de **tokens de acceso** y **tokens de identificador**.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-154">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="ccbf8-155">Para obtener más información, vea <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-155">For more information, see <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad"></a><span data-ttu-id="ccbf8-156">Blazor WebAssemblyAplicación independiente con Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="ccbf8-156">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>

<span data-ttu-id="ccbf8-157">Siga las instrucciones de [las secciones Blazor WebAssembly ](#update-blazor-webassembly-projects) actualizar proyectos y proyectos de [actualización Blazor WebAssembly Blazor Server ](#update-blazor-webassembly-and-blazor-server-projects) anteriores.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-157">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="ccbf8-158">Para una Blazor WebAssembly aplicación independiente registrada en el Azure portal usar Azure Active Directory (AAD):</span><span class="sxs-lookup"><span data-stu-id="ccbf8-158">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD):</span></span>

* <span data-ttu-id="ccbf8-159">La aplicación requiere el `https://graph.microsoft.com/User.Read` ámbito:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-159">The app requires the `https://graph.microsoft.com/User.Read` scope:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes
      .Add("https://graph.microsoft.com/User.Read");
  ```
  
* <span data-ttu-id="ccbf8-160">En la hoja Azure Portal la **autenticación** del registro de aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-160">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="ccbf8-161">Quite la configuración de plataforma **Web** .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-161">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="ccbf8-162">Agregue una configuración de plataforma de aplicación de una **sola página** con el URI de redireccionamiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-162">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="ccbf8-163">Deshabilite la **concesión implícita** de **tokens de acceso** y **tokens de identificador**.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-163">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>
  
<span data-ttu-id="ccbf8-164">Para obtener más información, vea <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-164">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad-b2c"></a><span data-ttu-id="ccbf8-165">Blazor WebAssemblyAplicación independiente con Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="ccbf8-165">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>

<span data-ttu-id="ccbf8-166">Siga las instrucciones de [las secciones Blazor WebAssembly ](#update-blazor-webassembly-projects) actualizar proyectos y proyectos de [actualización Blazor WebAssembly Blazor Server ](#update-blazor-webassembly-and-blazor-server-projects) anteriores.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-166">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="ccbf8-167">Para una Blazor WebAssembly aplicación independiente registrada en el Azure portal usar Azure Active Directory (AAD) B2C:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-167">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) B2C:</span></span>

* <span data-ttu-id="ccbf8-168">La aplicación requiere los `openid` `offline_access` ámbitos y:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-168">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="ccbf8-169">En la hoja Azure Portal la **autenticación** del registro de aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-169">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="ccbf8-170">Quite la configuración de plataforma **Web** .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-170">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="ccbf8-171">Agregue una configuración de plataforma de aplicación de una **sola página** con el URI de redireccionamiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-171">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="ccbf8-172">Deshabilite la **concesión implícita** de **tokens de acceso** y **tokens de identificador**.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-172">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="ccbf8-173">Para obtener más información, vea <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-173">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span></span>

### <a name="hosted-no-locblazor-webassembly-app-with-azure-active-directory-aad-or-aad-b2c"></a><span data-ttu-id="ccbf8-174">Aplicación hospedada Blazor WebAssembly con Azure Active Directory (AAD) o AAD B2C</span><span class="sxs-lookup"><span data-stu-id="ccbf8-174">Hosted Blazor WebAssembly app with Azure Active Directory (AAD) or AAD B2C</span></span>

<span data-ttu-id="ccbf8-175">Siga las instrucciones de [las secciones Blazor WebAssembly ](#update-blazor-webassembly-projects) actualizar proyectos y proyectos de [actualización Blazor WebAssembly Blazor Server ](#update-blazor-webassembly-and-blazor-server-projects) anteriores.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-175">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="ccbf8-176">El *`Client`* registro de la aplicación de una solución hospedada Blazor que usa AAD o AAD B2C para la autenticación de usuario debe usar una **aplicación de una sola página** configuración de la plataforma de aplicaciones de Azure.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-176">The *`Client`* app registration of a hosted Blazor solution that uses AAD or AAD B2C for user authentication should use a **Single-page application** Azure Apps platform configuration.</span></span>

<span data-ttu-id="ccbf8-177">En la *`Client`* hoja Azure portal la **autenticación** del registro de aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-177">In the Azure portal *`Client`* app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="ccbf8-178">Quite la configuración de plataforma **Web** .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-178">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="ccbf8-179">Agregue una configuración de plataforma de aplicación de una **sola página** con el URI de redireccionamiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-179">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="ccbf8-180">Deshabilite la **concesión implícita** de **tokens de acceso** y **tokens de identificador**.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-180">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="ccbf8-181">Para obtener más información, consulte:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-181">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="update-the-server-project-of-a-hosted-no-locblazor-solution"></a><span data-ttu-id="ccbf8-182">Actualización del proyecto de servidor de una Blazor solución hospedada</span><span class="sxs-lookup"><span data-stu-id="ccbf8-182">Update the Server project of a hosted Blazor solution</span></span>

<span data-ttu-id="ccbf8-183">Siga las instrucciones de las secciones anteriores:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-183">Follow the guidance in the preceding sections:</span></span>

* [<span data-ttu-id="ccbf8-184">Actualizar Blazor WebAssembly y Blazor Server proyectos</span><span class="sxs-lookup"><span data-stu-id="ccbf8-184">Update Blazor WebAssembly and Blazor Server projects</span></span>](#update-blazor-webassembly-and-blazor-server-projects)
* [<span data-ttu-id="ccbf8-185">Actualizar Blazor WebAssembly proyectos</span><span class="sxs-lookup"><span data-stu-id="ccbf8-185">Update Blazor WebAssembly projects</span></span>](#update-blazor-webassembly-projects)
* <span data-ttu-id="ccbf8-186">La sección que se aplica al proveedor de la aplicación con Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-186">The section that applies to the app's provider with Azure Active Directory:</span></span>
  * [<span data-ttu-id="ccbf8-187">Blazor WebAssemblyAplicación independiente con cuentas de Microsoft</span><span class="sxs-lookup"><span data-stu-id="ccbf8-187">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>](#standalone-blazor-webassembly-app-with-microsoft-accounts)
  * [<span data-ttu-id="ccbf8-188">Blazor WebAssemblyAplicación independiente con Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="ccbf8-188">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad)
  * [<span data-ttu-id="ccbf8-189">Blazor WebAssemblyAplicación independiente con Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="ccbf8-189">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad-b2c)

<span data-ttu-id="ccbf8-190">Actualice el *`Server`* proyecto de una solución hospedada Blazor como una ASP.net Core aplicación siguiendo las instrucciones generales de este artículo.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-190">Update the *`Server`* project of a hosted Blazor solution as an ASP.NET Core app following the general guidance in this article.</span></span>

<span data-ttu-id="ccbf8-191">Además, *`Server`* los proyectos que autentican a los usuarios en las Blazor WebAssembly aplicaciones cliente con Azure Active Directory (AAD) o B2C deben adoptar nuevos paquetes de Microsoft Identity v 2.0:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-191">Additionally, *`Server`* projects that authenticate users to client Blazor WebAssembly apps with Azure Active Directory (AAD) or B2C should adopt new Microsoft Identity v2.0 packages:</span></span> 
  
<span data-ttu-id="ccbf8-192">Para AAD:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-192">For AAD:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureAD.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="ccbf8-193">Por AAD B2C:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-193">For AAD B2C:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureADB2C.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="ccbf8-194">Para las referencias de paquete anteriores, determine las versiones de paquete para los `{VERSION}` marcadores de posición en NuGet.org:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-194">For the preceding package references, determine the package versions for the `{VERSION}` placeholders at NuGet.org:</span></span>

* [`Microsoft.Identity.Web`](https://www.nuget.org/packages/Microsoft.Identity.Web)
* [`Microsoft.Identity.Web.UI`](https://www.nuget.org/packages/Microsoft.Identity.Web.UI)

> [!NOTE]
> <span data-ttu-id="ccbf8-195">El SDK del *`Server`* proyecto en una solución hospedada Blazor WebAssembly sigue siendo `Microsoft.NET.Sdk.Web` :</span><span class="sxs-lookup"><span data-stu-id="ccbf8-195">The SDK of the *`Server`* project in a hosted Blazor WebAssembly solution remains `Microsoft.NET.Sdk.Web`:</span></span>
>
> ```xml
> <Project Sdk="Microsoft.NET.Sdk.Web">
> ```

<span data-ttu-id="ccbf8-196">Para obtener más información, consulte:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-196">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="clean-and-rebuild-the-solution"></a><span data-ttu-id="ccbf8-197">Limpie y Recompile la solución</span><span class="sxs-lookup"><span data-stu-id="ccbf8-197">Clean and rebuild the solution</span></span>

<span data-ttu-id="ccbf8-198">Después de migrar la aplicación o la solución a .NET 5, limpie y Recompile la aplicación o la solución.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-198">After migrating the app or solution to .NET 5, clean and rebuild the app or solution.</span></span> <span data-ttu-id="ccbf8-199">Si existen incompatibilidades de paquetes entre las nuevas referencias de paquete y los paquetes en caché:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-199">If package incompatibilities exist between new package references and cached packages:</span></span>

1. <span data-ttu-id="ccbf8-200">Borre las memorias caché de paquetes NuGet ejecutando el siguiente [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) comando en un shell de comandos:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-200">Clear NuGet package caches by executing the following [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) command in a command shell:</span></span>

   ```dotnetcli
   dotnet nuget locals --clear all
   ```
   
1. <span data-ttu-id="ccbf8-201">Limpie y Recompile la aplicación o la solución.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-201">Clean and rebuild the app or solution.</span></span>

### <a name="troubleshoot"></a><span data-ttu-id="ccbf8-202">Solución de problemas</span><span class="sxs-lookup"><span data-stu-id="ccbf8-202">Troubleshoot</span></span>

<span data-ttu-id="ccbf8-203">Siga las instrucciones de *solución de problemas* al final del Blazor WebAssembly tema de seguridad que se aplica a la aplicación:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-203">Follow the *Troubleshoot* guidance at the end of the Blazor WebAssembly security topic that applies to your app:</span></span>

<span data-ttu-id="ccbf8-204">Aplicaciones de Blazor WebAssembly independientes:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-204">Standalone Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="ccbf8-205">Instrucciones generales para los proveedores de OIDC y la biblioteca de autenticación WebAssembly</span><span class="sxs-lookup"><span data-stu-id="ccbf8-205">General guidance for OIDC providers and the WebAssembly Authentication Library</span></span>](xref:blazor/security/webassembly/standalone-with-authentication-library)
* [<span data-ttu-id="ccbf8-206">Cuentas de Microsoft</span><span class="sxs-lookup"><span data-stu-id="ccbf8-206">Microsoft Accounts</span></span>](xref:blazor/security/webassembly/standalone-with-microsoft-accounts)
* [<span data-ttu-id="ccbf8-207">Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="ccbf8-207">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory)
* [<span data-ttu-id="ccbf8-208">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="ccbf8-208">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c)

<span data-ttu-id="ccbf8-209">Aplicaciones de Blazor WebAssembly hospedadas:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-209">Hosted Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="ccbf8-210">Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="ccbf8-210">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory)
* [<span data-ttu-id="ccbf8-211">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="ccbf8-211">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c)
* [<span data-ttu-id="ccbf8-212">Servidor de Identity</span><span class="sxs-lookup"><span data-stu-id="ccbf8-212">Identity Server</span></span>](xref:blazor/security/webassembly/hosted-with-identity-server)

### <a name="unauthorized-client-for-azure-active-directory-aad"></a><span data-ttu-id="ccbf8-213">Cliente no autorizado para Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="ccbf8-213">Unauthorized client for Azure Active Directory (AAD)</span></span>

<span data-ttu-id="ccbf8-214">Después de actualizar una Blazor WebAssembly aplicación que usa AAD para la autenticación, es posible que reciba el siguiente error en la devolución de llamada de inicio de sesión a la aplicación después de que el usuario inicie sesión con AAD:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-214">After upgrading a Blazor WebAssembly app that uses AAD for authentication, you may receive the following error on the login callback to the app after the user signs in with AAD:</span></span>

> <span data-ttu-id="ccbf8-215">Información: Error de autorización de Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2].</span><span class="sxs-lookup"><span data-stu-id="ccbf8-215">info: Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] Authorization failed.</span></span> <span data-ttu-id="ccbf8-216">No se cumplen estos requisitos: DenyAnonymousAuthorizationRequirement: se requiere un usuario autenticado.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-216">These requirements were not met: DenyAnonymousAuthorizationRequirement: Requires an authenticated user.</span></span>

<span data-ttu-id="ccbf8-217">Error de devolución de llamada de inicio de sesión de AAD:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-217">Login callback error from AAD:</span></span>

* <span data-ttu-id="ccbf8-218">Error: `unauthorized_client`</span><span class="sxs-lookup"><span data-stu-id="ccbf8-218">Error: `unauthorized_client`</span></span>
* <span data-ttu-id="ccbf8-219">Description (Descripción): `AADB2C90058: The provided application is not configured to allow public clients.`</span><span class="sxs-lookup"><span data-stu-id="ccbf8-219">Description: `AADB2C90058: The provided application is not configured to allow public clients.`</span></span>

<span data-ttu-id="ccbf8-220">Para resolver el error:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-220">To resolve the error:</span></span>

1. <span data-ttu-id="ccbf8-221">En Azure Portal, acceda al [manifiesto de la aplicación](/azure/active-directory/develop/reference-app-manifest).</span><span class="sxs-lookup"><span data-stu-id="ccbf8-221">In the Azure portal, access the [app's manifest](/azure/active-directory/develop/reference-app-manifest).</span></span>
1. <span data-ttu-id="ccbf8-222">Defina el atributo [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) en `null` o `true`.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-222">Set the [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) attribute to `null` or `true`.</span></span>

## <a name="update-a-no-locblazor-progressive-web-application-pwa"></a><span data-ttu-id="ccbf8-223">Actualización de una Blazor aplicación web progresiva (PWA)</span><span class="sxs-lookup"><span data-stu-id="ccbf8-223">Update a Blazor Progressive Web Application (PWA)</span></span>

<span data-ttu-id="ccbf8-224">Agregue el siguiente elemento al archivo de proyecto de la aplicación PWA:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-224">Add the following item to the PWA app's project file:</span></span>

```xml
<ItemGroup>
  <ServiceWorker Include="wwwroot\service-worker.js" 
    PublishedContent="wwwroot\service-worker.published.js" />
</ItemGroup>
```

## <a name="update-no-locrazor-class-libraries-rcls"></a><span data-ttu-id="ccbf8-225">Actualizar Razor bibliotecas de clases (RCLs)</span><span class="sxs-lookup"><span data-stu-id="ccbf8-225">Update Razor class libraries (RCLs)</span></span>

<span data-ttu-id="ccbf8-226">Migre Razor las bibliotecas de clases (RCLs) para aprovechar las nuevas API o características que se incluyen como parte de ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-226">Migrate Razor class libraries (RCLs) to take advantage of new APIs or features that are introduced as part of ASP.NET Core 5.0.</span></span> 

<span data-ttu-id="ccbf8-227">Para actualizar un RCL que tiene como destino componentes:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-227">To update a RCL that targets components:</span></span>

1. <span data-ttu-id="ccbf8-228">Actualice las siguientes propiedades en el archivo de proyecto:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-228">Update the following properties in the project file:</span></span>

   ```diff
   <Project Sdk="Microsoft.NET.Sdk.Razor">
    
     <PropertyGroup>
   -     <TargetFramework>netstandard2.0</TargetFramework>
   -     <RazorLangVersion>3.0</RazorLangVersion>
   +     <TargetFramework>net5.0</TargetFramework>
     </PropertyGroup>
   ```

1. <span data-ttu-id="ccbf8-229">Actualice otros paquetes a sus versiones más recientes.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-229">Update other packages to their latest versions.</span></span> <span data-ttu-id="ccbf8-230">Las versiones más recientes se pueden encontrar en [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="ccbf8-230">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

<span data-ttu-id="ccbf8-231">Para actualizar un RCL que tiene como destino MVC, actualice las siguientes propiedades en el archivo de proyecto:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-231">To update an RCL targeting MVC, update the following properties in the project file:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
  </PropertyGroup>
```

## <a name="update-package-references"></a><span data-ttu-id="ccbf8-232">Actualización de las referencias del paquete</span><span class="sxs-lookup"><span data-stu-id="ccbf8-232">Update package references</span></span>

<span data-ttu-id="ccbf8-233">En el archivo de proyecto, actualice cada [Microsoft. AspNetCore. \*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft. EntityFrameworkCore. \*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft. extensions. \*](https://www.nuget.org/packages?q=Microsoft.Extensions.*)y [System.Net.Http.Jsen](https://www.nuget.org/packages/System.Net.Http.Json) el atributo de referencia del paquete `Version` a 5.0.0 o posterior.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-233">In the project file, update each [Microsoft.AspNetCore.\*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft.EntityFrameworkCore.\*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft.Extensions.\*](https://www.nuget.org/packages?q=Microsoft.Extensions.*), and [System.Net.Http.Json](https://www.nuget.org/packages/System.Net.Http.Json) package reference's `Version` attribute to 5.0.0 or later.</span></span> <span data-ttu-id="ccbf8-234">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-234">For example:</span></span>

```diff
<ItemGroup>
-    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="3.1.6" />
-    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.1.6">
-    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="3.1.6" />
-    <PackageReference Include="System.Net.Http.Json" Version="3.2.1" />
+    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="5.0.0" />
+    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="5.0.0">
+    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="5.0.0" />
+    <PackageReference Include="System.Net.Http.Json" Version="5.0.0" />
</ItemGroup>
```

## <a name="update-docker-images"></a><span data-ttu-id="ccbf8-235">Actualización de imágenes de Docker</span><span class="sxs-lookup"><span data-stu-id="ccbf8-235">Update Docker images</span></span>

<span data-ttu-id="ccbf8-236">En el caso de las aplicaciones que usan *Dockerfile* Docker, actualice las `FROM` instrucciones y los scripts de Dockerfile.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-236">For apps using Docker, update your *Dockerfile* `FROM` statements and scripts.</span></span> <span data-ttu-id="ccbf8-237">Usar una imagen base que incluye el tiempo de ejecución de ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-237">Use a base image that includes the ASP.NET Core 5.0 runtime.</span></span> <span data-ttu-id="ccbf8-238">Tenga en cuenta la `docker pull` diferencia de comandos siguiente entre ASP.NET Core 3,1 y 5,0:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-238">Consider the following `docker pull` command difference between ASP.NET Core 3.1 and 5.0:</span></span>

```diff
- docker pull mcr.microsoft.com/dotnet/core/aspnet:3.1
+ docker pull mcr.microsoft.com/dotnet/aspnet:5.0
```

<span data-ttu-id="ccbf8-239">Como parte de la migración a ".NET" como nombre del producto, las imágenes de Docker se movieron desde los `mcr.microsoft.com/dotnet/core` repositorios a `mcr.microsoft.com/dotnet` .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-239">As part of the move to ".NET" as the product name, the Docker images moved from the `mcr.microsoft.com/dotnet/core` repositories to `mcr.microsoft.com/dotnet`.</span></span> <span data-ttu-id="ccbf8-240">Para obtener más información, consulte [dotnet/dotnet-Docker # 1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span><span class="sxs-lookup"><span data-stu-id="ccbf8-240">For more information, see [dotnet/dotnet-docker#1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span></span>

## <a name="model-binding-changes-in-aspnet-core-mvc-and-no-locrazor-pages"></a><span data-ttu-id="ccbf8-241">Cambios de enlace de modelos en ASP.NET Core MVC y Razor páginas</span><span class="sxs-lookup"><span data-stu-id="ccbf8-241">Model binding changes in ASP.NET Core MVC and Razor Pages</span></span>

### <a name="datetime-values-are-model-bound-as-utc-times"></a><span data-ttu-id="ccbf8-242">Los valores DateTime están enlazados a modelos como horas UTC</span><span class="sxs-lookup"><span data-stu-id="ccbf8-242">DateTime values are model bound as UTC times</span></span>

<span data-ttu-id="ccbf8-243">En ASP.NET Core 3,1 y versiones anteriores, `DateTime` los valores se enlazaron en el modelo como hora local, donde el servidor determinó la zona horaria.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-243">In ASP.NET Core 3.1 and earlier, `DateTime` values were model-bound as local time, where the timezone was determined by the server.</span></span> <span data-ttu-id="ccbf8-244">`DateTime` los valores enlazados desde el formato de entrada (JSON) y `DateTimeOffset` los valores se enlazaron como zonas horarias UTC.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-244">`DateTime` values bound from input formatting (JSON) and `DateTimeOffset` values were bound as UTC timezones.</span></span>

<span data-ttu-id="ccbf8-245">En ASP.NET Core 5,0 y versiones posteriores, el enlace de modelos enlaza los valores de forma coherente `DateTime` con la zona horaria UTC.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-245">In ASP.NET Core 5.0 and later, model binding consistently binds `DateTime` values with the UTC timezone.</span></span>

<span data-ttu-id="ccbf8-246">Para conservar el comportamiento anterior, quite el `DateTimeModelBinderProvider` de `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="ccbf8-246">To retain the previous behavior, remove the `DateTimeModelBinderProvider` in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddControllersWithViews(options => 
    options.ModelBinderProviders.RemoveType<DateTimeModelBinderProvider>());
```

### <a name="complexobjectmodelbinderprovider--complexobjectmodelbinder-replace-complextypemodelbinderprovider--complextypemodelbinder"></a><span data-ttu-id="ccbf8-247">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder reemplazar ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span><span class="sxs-lookup"><span data-stu-id="ccbf8-247">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span></span>

<span data-ttu-id="ccbf8-248">Para agregar compatibilidad con los [tipos de registro de C# 9](/dotnet/csharp/whats-new/csharp-9#record-types)de enlace de modelos, el <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> es:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-248">To add support for model binding [C# 9 record types](/dotnet/csharp/whats-new/csharp-9#record-types), the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> is:</span></span>

* <span data-ttu-id="ccbf8-249">Anotado como obsoleto.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-249">Annotated as obsolete.</span></span>
* <span data-ttu-id="ccbf8-250">Ya no se registra de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-250">No longer registered by default.</span></span>

<span data-ttu-id="ccbf8-251">Las aplicaciones que se basan en la presencia de `ComplexTypeModelBinderProvider` en la `ModelBinderProviders` colección deben hacer referencia al nuevo proveedor de enlazador:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-251">Apps that rely on the presence of the `ComplexTypeModelBinderProvider` in the `ModelBinderProviders` collection need to reference the new binder provider:</span></span>

```diff
- var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexTypeModelBinderProvider>();
+ var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexObjectModelBinderProvider>();
```

## <a name="usedatabaseerrorpage-obsolete"></a><span data-ttu-id="ccbf8-252">UseDatabaseErrorPage obsoleto</span><span class="sxs-lookup"><span data-stu-id="ccbf8-252">UseDatabaseErrorPage obsolete</span></span>

<span data-ttu-id="ccbf8-253">Las plantillas ASP.NET Core 3,1 que incluyen una opción para las cuentas de usuario individuales generan una llamada a <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A> .</span><span class="sxs-lookup"><span data-stu-id="ccbf8-253">The ASP.NET Core 3.1 templates that include an option for individual user accounts generate a call to <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A>.</span></span> <span data-ttu-id="ccbf8-254">`UseDatabaseErrorPage` está ahora obsoleto y debe reemplazarse por una combinación de `AddDatabaseDeveloperPageExceptionFilter` y `UseMigrationsEndPoint` , tal y como se muestra en el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="ccbf8-254">`UseDatabaseErrorPage` is now obsolete and should be replaced with a combination of `AddDatabaseDeveloperPageExceptionFilter` and `UseMigrationsEndPoint`, as shown in the following code:</span></span>

```diff
public void ConfigureServices(IServiceCollection services)
{
    services.AddDbContext<ApplicationDbContext>(options =>
        options.UseSqlServer(
            Configuration.GetConnectionString("DefaultConnection")));
+   services.AddDatabaseDeveloperPageExceptionFilter();
    services.AddDefaultIdentity<IdentityUser>(options => options.SignIn.RequireConfirmedAccount = true)
        .AddEntityFrameworkStores<ApplicationDbContext>();
    services.AddRazorPages();
}

public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
+       app.UseMigrationsEndPoint()
-       app.UseDatabaseErrorPage();
    }
    else
    {
        app.UseExceptionHandler("/Error");
        app.UseHsts();
    }
```

<span data-ttu-id="ccbf8-255">Para más información, consulte [este problema de GitHub](https://github.com/dotnet/aspnetcore/issues/24987).</span><span class="sxs-lookup"><span data-stu-id="ccbf8-255">For more information, see [this GitHub issue](https://github.com/dotnet/aspnetcore/issues/24987).</span></span>

## <a name="review-breaking-changes"></a><span data-ttu-id="ccbf8-256">Revisar cambios importantes</span><span class="sxs-lookup"><span data-stu-id="ccbf8-256">Review breaking changes</span></span>

<span data-ttu-id="ccbf8-257">Para realizar cambios importantes de .NET Core 3,1 a .NET 5,0, consulte [cambios importantes para la migración de la versión 3,1 a la 5,0](/dotnet/core/compatibility/3.1-5.0).</span><span class="sxs-lookup"><span data-stu-id="ccbf8-257">For breaking changes from .NET Core 3.1 to .NET 5.0, see [Breaking changes for migration from version 3.1 to 5.0](/dotnet/core/compatibility/3.1-5.0).</span></span> <span data-ttu-id="ccbf8-258">También se incluyen ASP.NET Core y Entity Framework Core en la lista.</span><span class="sxs-lookup"><span data-stu-id="ccbf8-258">ASP.NET Core and Entity Framework Core are also included in the list.</span></span>
