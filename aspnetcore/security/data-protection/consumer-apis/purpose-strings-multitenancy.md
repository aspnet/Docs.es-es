---
title: Jerarquía de propósito y multiinquilino en ASP.NET Core
author: rick-anderson
description: Obtenga información acerca de la jerarquía de cadenas de propósito y multiinquilino en lo que se refiere a las API de protección de datos de ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
no-loc:
- 'appsettings.json'
- 'ASP.NET Core Identity'
- 'cookie'
- 'Cookie'
- 'Blazor'
- 'Blazor Server'
- 'Blazor WebAssembly'
- 'Identity'
- "Let's Encrypt"
- 'Razor'
- 'SignalR'
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: 84714cd852a3cbc7ff77d0fd0c88931536dead1a
ms.sourcegitcommit: ca34c1ac578e7d3daa0febf1810ba5fc74f60bbf
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/30/2020
ms.locfileid: "93052791"
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="ea636-103">Jerarquía de propósito y multiinquilino en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="ea636-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="ea636-104">Puesto que `IDataProtector` también es implícitamente un `IDataProtectionProvider` , los propósitos se pueden encadenar juntos.</span><span class="sxs-lookup"><span data-stu-id="ea636-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="ea636-105">En este sentido, `provider.CreateProtector([ "purpose1", "purpose2" ])` es equivalente a `provider.CreateProtector("purpose1").CreateProtector("purpose2")` .</span><span class="sxs-lookup"><span data-stu-id="ea636-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="ea636-106">Esto permite algunas relaciones jerárquicas interesantes a través del sistema de protección de datos.</span><span class="sxs-lookup"><span data-stu-id="ea636-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="ea636-107">En el ejemplo anterior de [contoso. Messaging. SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), el componente SecureMessage puede llamar al `provider.CreateProtector("Contoso.Messaging.SecureMessage")` principio y almacenar en caché el resultado en un `_myProvider` campo privado.</span><span class="sxs-lookup"><span data-stu-id="ea636-107">In the earlier example of [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvider` field.</span></span> <span data-ttu-id="ea636-108">Después, los protectores futuros se pueden crear a través `_myProvider.CreateProtector("User: username")` de llamadas a, y estos protectores se utilizarían para proteger los mensajes individuales.</span><span class="sxs-lookup"><span data-stu-id="ea636-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="ea636-109">También se puede voltear.</span><span class="sxs-lookup"><span data-stu-id="ea636-109">This can also be flipped.</span></span> <span data-ttu-id="ea636-110">Considere una única aplicación lógica que hospede varios inquilinos (un CMS parece razonable) y cada inquilino se puede configurar con su propio sistema de administración de estado y autenticación.</span><span class="sxs-lookup"><span data-stu-id="ea636-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="ea636-111">La aplicación paraguas tiene un único proveedor maestro y llama a `provider.CreateProtector("Tenant 1")` y `provider.CreateProtector("Tenant 2")` para dar a cada inquilino su propio segmento aislado del sistema de protección de datos.</span><span class="sxs-lookup"><span data-stu-id="ea636-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="ea636-112">Después, los inquilinos pueden derivar sus propios protectores individuales en función de sus propias necesidades, pero independientemente de lo difícil que intenten no crear protectores que entren en conflicto con cualquier otro inquilino del sistema.</span><span class="sxs-lookup"><span data-stu-id="ea636-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="ea636-113">Gráficamente, esto se representa como se indica a continuación.</span><span class="sxs-lookup"><span data-stu-id="ea636-113">Graphically, this is represented as below.</span></span>

![Propósitos de varios inquilinos](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="ea636-115">Se supone que la aplicación de paraguas controla qué API están disponibles para los inquilinos individuales y que los inquilinos no pueden ejecutar código arbitrario en el servidor.</span><span class="sxs-lookup"><span data-stu-id="ea636-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="ea636-116">Si un inquilino puede ejecutar código arbitrario, podría realizar la reflexión privada para interrumpir las garantías de aislamiento o simplemente leer el material de creación de claves maestro directamente y derivar las subclaves que deseen.</span><span class="sxs-lookup"><span data-stu-id="ea636-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="ea636-117">En realidad, el sistema de protección de datos usa una especie de varios inquilinos en su configuración predeterminada.</span><span class="sxs-lookup"><span data-stu-id="ea636-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="ea636-118">De forma predeterminada, el material de creación de claves maestra se almacena en la carpeta de Perfil de usuario de la cuenta de proceso de trabajo (o el registro para las identidades del grupo de aplicaciones de IIS).</span><span class="sxs-lookup"><span data-stu-id="ea636-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="ea636-119">Pero es realmente frecuente usar una única cuenta para ejecutar varias aplicaciones y, por lo tanto, todas estas aplicaciones terminaran compartiendo el material de creación de claves maestra.</span><span class="sxs-lookup"><span data-stu-id="ea636-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="ea636-120">Para solucionarlo, el sistema de protección de datos inserta automáticamente un identificador único por aplicación como el primer elemento en la cadena de propósito general.</span><span class="sxs-lookup"><span data-stu-id="ea636-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="ea636-121">Este propósito implícito sirve para [aislar las aplicaciones individuales](xref:security/data-protection/configuration/overview#per-application-isolation) entre sí al tratar eficazmente cada aplicación como un inquilino único dentro del sistema y el proceso de creación del protector es idéntico a la imagen anterior.</span><span class="sxs-lookup"><span data-stu-id="ea636-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
