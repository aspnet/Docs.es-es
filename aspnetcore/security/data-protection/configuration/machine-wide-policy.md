---
title: Compatibilidad con la Directiva de protección de datos en ASP.NET Core
author: rick-anderson
description: Obtenga información sobre la compatibilidad con la configuración de una directiva predeterminada de todo el equipo para todas las aplicaciones que consumen ASP.NET Core protección de datos.
ms.author: riande
ms.date: 10/14/2016
no-loc:
- ':::no-loc(appsettings.json):::'
- ':::no-loc(ASP.NET Core Identity):::'
- ':::no-loc(cookie):::'
- ':::no-loc(Cookie):::'
- ':::no-loc(Blazor):::'
- ':::no-loc(Blazor Server):::'
- ':::no-loc(Blazor WebAssembly):::'
- ':::no-loc(Identity):::'
- ":::no-loc(Let's Encrypt):::"
- ':::no-loc(Razor):::'
- ':::no-loc(SignalR):::'
uid: security/data-protection/configuration/machine-wide-policy
ms.openlocfilehash: f6f258e193bf964cb9b4cbd24da2740c5ed89a91
ms.sourcegitcommit: ca34c1ac578e7d3daa0febf1810ba5fc74f60bbf
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/30/2020
ms.locfileid: "93052999"
---
# <a name="data-protection-machine-wide-policy-support-in-aspnet-core"></a><span data-ttu-id="ad688-103">Compatibilidad con la Directiva de protección de datos en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="ad688-103">Data Protection machine-wide policy support in ASP.NET Core</span></span>

<span data-ttu-id="ad688-104">Por [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="ad688-104">By [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="ad688-105">Cuando se ejecuta en Windows, el sistema de protección de datos tiene compatibilidad limitada para establecer una directiva predeterminada de todo el equipo para todas las aplicaciones que consumen ASP.NET Core protección de datos.</span><span class="sxs-lookup"><span data-stu-id="ad688-105">When running on Windows, the Data Protection system has limited support for setting a default machine-wide policy for all apps that consume ASP.NET Core Data Protection.</span></span> <span data-ttu-id="ad688-106">La idea general es que es posible que un administrador desee cambiar una configuración predeterminada, como los algoritmos usados o la duración de la clave, sin necesidad de actualizar manualmente todas las aplicaciones de la máquina.</span><span class="sxs-lookup"><span data-stu-id="ad688-106">The general idea is that an administrator might wish to change a default setting, such as the algorithms used or key lifetime, without the need to manually update every app on the machine.</span></span>

> [!WARNING]
> <span data-ttu-id="ad688-107">El administrador del sistema puede establecer la directiva predeterminada, pero no puede aplicarla.</span><span class="sxs-lookup"><span data-stu-id="ad688-107">The system administrator can set default policy, but they can't enforce it.</span></span> <span data-ttu-id="ad688-108">El desarrollador de la aplicación siempre puede reemplazar cualquier valor por uno de su propia elección.</span><span class="sxs-lookup"><span data-stu-id="ad688-108">The app developer can always override any value with one of their own choosing.</span></span> <span data-ttu-id="ad688-109">La directiva predeterminada solo afecta a las aplicaciones en las que el desarrollador no ha especificado un valor explícito para una configuración.</span><span class="sxs-lookup"><span data-stu-id="ad688-109">The default policy only affects apps where the developer hasn't specified an explicit value for a setting.</span></span>

## <a name="setting-default-policy"></a><span data-ttu-id="ad688-110">Configuración de la directiva predeterminada</span><span class="sxs-lookup"><span data-stu-id="ad688-110">Setting default policy</span></span>

<span data-ttu-id="ad688-111">Para establecer la directiva predeterminada, un administrador puede establecer valores conocidos en el registro del sistema en la siguiente clave del registro:</span><span class="sxs-lookup"><span data-stu-id="ad688-111">To set default policy, an administrator can set known values in the system registry under the following registry key:</span></span>

<span data-ttu-id="ad688-112">**HKLM\SOFTWARE\Microsoft\DotNetPackages\Microsoft.AspNetCore.DataProtection**</span><span class="sxs-lookup"><span data-stu-id="ad688-112">**HKLM\SOFTWARE\Microsoft\DotNetPackages\Microsoft.AspNetCore.DataProtection**</span></span>

<span data-ttu-id="ad688-113">Si se encuentra en un sistema operativo de 64 bits y quiere afectar al comportamiento de las aplicaciones de 32 bits, no olvide configurar el equivalente de Wow6432Node de la clave anterior.</span><span class="sxs-lookup"><span data-stu-id="ad688-113">If you're on a 64-bit operating system and want to affect the behavior of 32-bit apps, remember to configure the Wow6432Node equivalent of the above key.</span></span>

<span data-ttu-id="ad688-114">Los valores admitidos se muestran a continuación.</span><span class="sxs-lookup"><span data-stu-id="ad688-114">The supported values are shown below.</span></span>

| <span data-ttu-id="ad688-115">Valor</span><span class="sxs-lookup"><span data-stu-id="ad688-115">Value</span></span>              | <span data-ttu-id="ad688-116">Tipo</span><span class="sxs-lookup"><span data-stu-id="ad688-116">Type</span></span>   | <span data-ttu-id="ad688-117">Descripción</span><span class="sxs-lookup"><span data-stu-id="ad688-117">Description</span></span> |
| ------------------ | :----: | ----------- |
| <span data-ttu-id="ad688-118">EncryptionType</span><span class="sxs-lookup"><span data-stu-id="ad688-118">EncryptionType</span></span>     | <span data-ttu-id="ad688-119">string</span><span class="sxs-lookup"><span data-stu-id="ad688-119">string</span></span> | <span data-ttu-id="ad688-120">Especifica los algoritmos que se deben usar para la protección de datos.</span><span class="sxs-lookup"><span data-stu-id="ad688-120">Specifies which algorithms should be used for data protection.</span></span> <span data-ttu-id="ad688-121">El valor debe ser CNG-CBC, CNG-GCM o administrado y se describe con más detalle a continuación.</span><span class="sxs-lookup"><span data-stu-id="ad688-121">The value must be CNG-CBC, CNG-GCM, or Managed and is described in more detail below.</span></span> |
| <span data-ttu-id="ad688-122">DefaultKeyLifetime</span><span class="sxs-lookup"><span data-stu-id="ad688-122">DefaultKeyLifetime</span></span> | <span data-ttu-id="ad688-123">DWORD</span><span class="sxs-lookup"><span data-stu-id="ad688-123">DWORD</span></span>  | <span data-ttu-id="ad688-124">Especifica la duración de las claves generadas recientemente.</span><span class="sxs-lookup"><span data-stu-id="ad688-124">Specifies the lifetime for newly-generated keys.</span></span> <span data-ttu-id="ad688-125">El valor se especifica en días y debe ser >= 7.</span><span class="sxs-lookup"><span data-stu-id="ad688-125">The value is specified in days and must be >= 7.</span></span> |
| <span data-ttu-id="ad688-126">KeyEscrowSinks</span><span class="sxs-lookup"><span data-stu-id="ad688-126">KeyEscrowSinks</span></span>     | <span data-ttu-id="ad688-127">string</span><span class="sxs-lookup"><span data-stu-id="ad688-127">string</span></span> | <span data-ttu-id="ad688-128">Especifica los tipos que se usan para el custodia de claves.</span><span class="sxs-lookup"><span data-stu-id="ad688-128">Specifies the types that are used for key escrow.</span></span> <span data-ttu-id="ad688-129">El valor es una lista delimitada por signos de punto y coma de receptores de custodia de claves, donde cada elemento de la lista es el nombre calificado con el ensamblado de un tipo que implementa [IKeyEscrowSink](/dotnet/api/microsoft.aspnetcore.dataprotection.keymanagement.ikeyescrowsink).</span><span class="sxs-lookup"><span data-stu-id="ad688-129">The value is a semicolon-delimited list of key escrow sinks, where each element in the list is the assembly-qualified name of a type that implements [IKeyEscrowSink](/dotnet/api/microsoft.aspnetcore.dataprotection.keymanagement.ikeyescrowsink).</span></span> |

## <a name="encryption-types"></a><span data-ttu-id="ad688-130">Tipos de cifrado</span><span class="sxs-lookup"><span data-stu-id="ad688-130">Encryption types</span></span>

<span data-ttu-id="ad688-131">Si EncryptionType es CNG-CBC, el sistema está configurado para usar un cifrado de bloques simétricos de modo CBC para confidencialidad y HMAC para la autenticidad con los servicios proporcionados por CNG de Windows (consulte [especificación de algoritmos CNG personalizados de Windows](xref:security/data-protection/configuration/overview#specifying-custom-windows-cng-algorithms) para obtener más detalles).</span><span class="sxs-lookup"><span data-stu-id="ad688-131">If EncryptionType is CNG-CBC, the system is configured to use a CBC-mode symmetric block cipher for confidentiality and HMAC for authenticity with services provided by Windows CNG (see [Specifying custom Windows CNG algorithms](xref:security/data-protection/configuration/overview#specifying-custom-windows-cng-algorithms) for more details).</span></span> <span data-ttu-id="ad688-132">Se admiten los siguientes valores adicionales, cada uno de los cuales corresponde a una propiedad en el tipo CngCbcAuthenticatedEncryptionSettings.</span><span class="sxs-lookup"><span data-stu-id="ad688-132">The following additional values are supported, each of which corresponds to a property on the CngCbcAuthenticatedEncryptionSettings type.</span></span>

| <span data-ttu-id="ad688-133">Valor</span><span class="sxs-lookup"><span data-stu-id="ad688-133">Value</span></span>                       | <span data-ttu-id="ad688-134">Tipo</span><span class="sxs-lookup"><span data-stu-id="ad688-134">Type</span></span>   | <span data-ttu-id="ad688-135">Descripción</span><span class="sxs-lookup"><span data-stu-id="ad688-135">Description</span></span> |
| --------------------------- | :----: | ----------- |
| <span data-ttu-id="ad688-136">EncryptionAlgorithm</span><span class="sxs-lookup"><span data-stu-id="ad688-136">EncryptionAlgorithm</span></span>         | <span data-ttu-id="ad688-137">string</span><span class="sxs-lookup"><span data-stu-id="ad688-137">string</span></span> | <span data-ttu-id="ad688-138">Nombre de un algoritmo de cifrado de bloques simétricos entendido por CNG.</span><span class="sxs-lookup"><span data-stu-id="ad688-138">The name of a symmetric block cipher algorithm understood by CNG.</span></span> <span data-ttu-id="ad688-139">Este algoritmo se abre en modo CBC.</span><span class="sxs-lookup"><span data-stu-id="ad688-139">This algorithm is opened in CBC mode.</span></span> |
| <span data-ttu-id="ad688-140">EncryptionAlgorithmProvider</span><span class="sxs-lookup"><span data-stu-id="ad688-140">EncryptionAlgorithmProvider</span></span> | <span data-ttu-id="ad688-141">string</span><span class="sxs-lookup"><span data-stu-id="ad688-141">string</span></span> | <span data-ttu-id="ad688-142">El nombre de la implementación del proveedor de CNG que puede generar el algoritmo EncryptionAlgorithm.</span><span class="sxs-lookup"><span data-stu-id="ad688-142">The name of the CNG provider implementation that can produce the algorithm EncryptionAlgorithm.</span></span> |
| <span data-ttu-id="ad688-143">EncryptionAlgorithmKeySize</span><span class="sxs-lookup"><span data-stu-id="ad688-143">EncryptionAlgorithmKeySize</span></span>  | <span data-ttu-id="ad688-144">DWORD</span><span class="sxs-lookup"><span data-stu-id="ad688-144">DWORD</span></span>  | <span data-ttu-id="ad688-145">La longitud (en bits) de la clave que se va a derivar para el algoritmo de cifrado de bloques simétricos.</span><span class="sxs-lookup"><span data-stu-id="ad688-145">The length (in bits) of the key to derive for the symmetric block cipher algorithm.</span></span> |
| <span data-ttu-id="ad688-146">HashAlgorithm</span><span class="sxs-lookup"><span data-stu-id="ad688-146">HashAlgorithm</span></span>               | <span data-ttu-id="ad688-147">string</span><span class="sxs-lookup"><span data-stu-id="ad688-147">string</span></span> | <span data-ttu-id="ad688-148">Nombre de un algoritmo hash que entiende CNG.</span><span class="sxs-lookup"><span data-stu-id="ad688-148">The name of a hash algorithm understood by CNG.</span></span> <span data-ttu-id="ad688-149">Este algoritmo se abre en modo HMAC.</span><span class="sxs-lookup"><span data-stu-id="ad688-149">This algorithm is opened in HMAC mode.</span></span> |
| <span data-ttu-id="ad688-150">HashAlgorithmProvider</span><span class="sxs-lookup"><span data-stu-id="ad688-150">HashAlgorithmProvider</span></span>       | <span data-ttu-id="ad688-151">string</span><span class="sxs-lookup"><span data-stu-id="ad688-151">string</span></span> | <span data-ttu-id="ad688-152">El nombre de la implementación del proveedor de CNG que puede generar el algoritmo HashAlgorithm.</span><span class="sxs-lookup"><span data-stu-id="ad688-152">The name of the CNG provider implementation that can produce the algorithm HashAlgorithm.</span></span> |

<span data-ttu-id="ad688-153">Si EncryptionType es CNG-GCM, el sistema está configurado para usar un cifrado de bloques simétricos de modo Galois/Counter para la confidencialidad y la autenticidad con los servicios proporcionados por CNG de Windows (consulte [especificación de algoritmos CNG personalizados de Windows](xref:security/data-protection/configuration/overview#specifying-custom-windows-cng-algorithms) para obtener más detalles).</span><span class="sxs-lookup"><span data-stu-id="ad688-153">If EncryptionType is CNG-GCM, the system is configured to use a Galois/Counter Mode symmetric block cipher for confidentiality and authenticity with services provided by Windows CNG (see [Specifying custom Windows CNG algorithms](xref:security/data-protection/configuration/overview#specifying-custom-windows-cng-algorithms) for more details).</span></span> <span data-ttu-id="ad688-154">Se admiten los siguientes valores adicionales, cada uno de los cuales corresponde a una propiedad en el tipo CngGcmAuthenticatedEncryptionSettings.</span><span class="sxs-lookup"><span data-stu-id="ad688-154">The following additional values are supported, each of which corresponds to a property on the CngGcmAuthenticatedEncryptionSettings type.</span></span>

| <span data-ttu-id="ad688-155">Valor</span><span class="sxs-lookup"><span data-stu-id="ad688-155">Value</span></span>                       | <span data-ttu-id="ad688-156">Tipo</span><span class="sxs-lookup"><span data-stu-id="ad688-156">Type</span></span>   | <span data-ttu-id="ad688-157">Descripción</span><span class="sxs-lookup"><span data-stu-id="ad688-157">Description</span></span> |
| --------------------------- | :----: | ----------- |
| <span data-ttu-id="ad688-158">EncryptionAlgorithm</span><span class="sxs-lookup"><span data-stu-id="ad688-158">EncryptionAlgorithm</span></span>         | <span data-ttu-id="ad688-159">string</span><span class="sxs-lookup"><span data-stu-id="ad688-159">string</span></span> | <span data-ttu-id="ad688-160">Nombre de un algoritmo de cifrado de bloques simétricos entendido por CNG.</span><span class="sxs-lookup"><span data-stu-id="ad688-160">The name of a symmetric block cipher algorithm understood by CNG.</span></span> <span data-ttu-id="ad688-161">Este algoritmo se abre en el modo Galois/Counter.</span><span class="sxs-lookup"><span data-stu-id="ad688-161">This algorithm is opened in Galois/Counter Mode.</span></span> |
| <span data-ttu-id="ad688-162">EncryptionAlgorithmProvider</span><span class="sxs-lookup"><span data-stu-id="ad688-162">EncryptionAlgorithmProvider</span></span> | <span data-ttu-id="ad688-163">string</span><span class="sxs-lookup"><span data-stu-id="ad688-163">string</span></span> | <span data-ttu-id="ad688-164">El nombre de la implementación del proveedor de CNG que puede generar el algoritmo EncryptionAlgorithm.</span><span class="sxs-lookup"><span data-stu-id="ad688-164">The name of the CNG provider implementation that can produce the algorithm EncryptionAlgorithm.</span></span> |
| <span data-ttu-id="ad688-165">EncryptionAlgorithmKeySize</span><span class="sxs-lookup"><span data-stu-id="ad688-165">EncryptionAlgorithmKeySize</span></span>  | <span data-ttu-id="ad688-166">DWORD</span><span class="sxs-lookup"><span data-stu-id="ad688-166">DWORD</span></span>  | <span data-ttu-id="ad688-167">La longitud (en bits) de la clave que se va a derivar para el algoritmo de cifrado de bloques simétricos.</span><span class="sxs-lookup"><span data-stu-id="ad688-167">The length (in bits) of the key to derive for the symmetric block cipher algorithm.</span></span> |

<span data-ttu-id="ad688-168">Si EncryptionType está administrado, el sistema está configurado para usar un SymmetricAlgorithm administrado para la confidencialidad y para KeyedHashAlgorithm para la autenticidad (consulte [especificación de algoritmos administrados personalizados](xref:security/data-protection/configuration/overview#specifying-custom-managed-algorithms) para obtener más detalles).</span><span class="sxs-lookup"><span data-stu-id="ad688-168">If EncryptionType is Managed, the system is configured to use a managed SymmetricAlgorithm for confidentiality and KeyedHashAlgorithm for authenticity (see [Specifying custom managed algorithms](xref:security/data-protection/configuration/overview#specifying-custom-managed-algorithms) for more details).</span></span> <span data-ttu-id="ad688-169">Se admiten los siguientes valores adicionales, cada uno de los cuales corresponde a una propiedad en el tipo ManagedAuthenticatedEncryptionSettings.</span><span class="sxs-lookup"><span data-stu-id="ad688-169">The following additional values are supported, each of which corresponds to a property on the ManagedAuthenticatedEncryptionSettings type.</span></span>

| <span data-ttu-id="ad688-170">Valor</span><span class="sxs-lookup"><span data-stu-id="ad688-170">Value</span></span>                      | <span data-ttu-id="ad688-171">Tipo</span><span class="sxs-lookup"><span data-stu-id="ad688-171">Type</span></span>   | <span data-ttu-id="ad688-172">Descripción</span><span class="sxs-lookup"><span data-stu-id="ad688-172">Description</span></span> |
| -------------------------- | :----: | ----------- |
| <span data-ttu-id="ad688-173">EncryptionAlgorithmType</span><span class="sxs-lookup"><span data-stu-id="ad688-173">EncryptionAlgorithmType</span></span>    | <span data-ttu-id="ad688-174">string</span><span class="sxs-lookup"><span data-stu-id="ad688-174">string</span></span> | <span data-ttu-id="ad688-175">Nombre calificado con el ensamblado de un tipo que implementa SymmetricAlgorithm.</span><span class="sxs-lookup"><span data-stu-id="ad688-175">The assembly-qualified name of a type that implements SymmetricAlgorithm.</span></span> |
| <span data-ttu-id="ad688-176">EncryptionAlgorithmKeySize</span><span class="sxs-lookup"><span data-stu-id="ad688-176">EncryptionAlgorithmKeySize</span></span> | <span data-ttu-id="ad688-177">DWORD</span><span class="sxs-lookup"><span data-stu-id="ad688-177">DWORD</span></span>  | <span data-ttu-id="ad688-178">La longitud (en bits) de la clave que se va a derivar para el algoritmo de cifrado simétrico.</span><span class="sxs-lookup"><span data-stu-id="ad688-178">The length (in bits) of the key to derive for the symmetric encryption algorithm.</span></span> |
| <span data-ttu-id="ad688-179">ValidationAlgorithmType</span><span class="sxs-lookup"><span data-stu-id="ad688-179">ValidationAlgorithmType</span></span>    | <span data-ttu-id="ad688-180">string</span><span class="sxs-lookup"><span data-stu-id="ad688-180">string</span></span> | <span data-ttu-id="ad688-181">Nombre calificado con el ensamblado de un tipo que implementa KeyedHashAlgorithm.</span><span class="sxs-lookup"><span data-stu-id="ad688-181">The assembly-qualified name of a type that implements KeyedHashAlgorithm.</span></span> |

<span data-ttu-id="ad688-182">Si EncryptionType tiene cualquier otro valor distinto de null o vacío, el sistema de protección de datos inicia una excepción al iniciarse.</span><span class="sxs-lookup"><span data-stu-id="ad688-182">If EncryptionType has any other value other than null or empty, the Data Protection system throws an exception at startup.</span></span>

> [!WARNING]
> <span data-ttu-id="ad688-183">Al configurar una configuración de directiva predeterminada que implique nombres de tipo (EncryptionAlgorithmType, ValidationAlgorithmType, KeyEscrowSinks), los tipos deben estar disponibles para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="ad688-183">When configuring a default policy setting that involves type names (EncryptionAlgorithmType, ValidationAlgorithmType, KeyEscrowSinks), the types must be available to the app.</span></span> <span data-ttu-id="ad688-184">Esto significa que para las aplicaciones que se ejecutan en el CLR de escritorio, los ensamblados que contienen estos tipos deben estar presentes en la caché de ensamblados global (GAC).</span><span class="sxs-lookup"><span data-stu-id="ad688-184">This means that for apps running on Desktop CLR, the assemblies that contain these types should be present in the Global Assembly Cache (GAC).</span></span> <span data-ttu-id="ad688-185">En el caso de las aplicaciones ASP.NET Core que se ejecutan en .NET Core, deben instalarse los paquetes que contienen estos tipos.</span><span class="sxs-lookup"><span data-stu-id="ad688-185">For ASP.NET Core apps running on .NET Core, the packages that contain these types should be installed.</span></span>
