---
title: Pruebas unitarias de Razor Pages en ASP.NET Core
author: rick-anderson
description: Aprenda a crear pruebas unitarias de aplicaciones de Razor Pages.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 7/22/2020
no-loc:
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: test/razor-pages-tests
ms.openlocfilehash: 21810f00548ad9f9c399ec4e453dd914dc186f5d
ms.sourcegitcommit: 497be502426e9d90bb7d0401b1b9f74b6a384682
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 08/08/2020
ms.locfileid: "88018954"
---
# <a name="no-locrazor-pages-unit-tests-in-aspnet-core"></a><span data-ttu-id="147dc-103">Pruebas unitarias de Razor Pages en ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="147dc-103">Razor Pages unit tests in ASP.NET Core</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="147dc-104">ASP.NET Core admite pruebas unitarias de aplicaciones de Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="147dc-104">ASP.NET Core supports unit tests of Razor Pages apps.</span></span> <span data-ttu-id="147dc-105">Las pruebas de la capa de acceso a datos (DAL) y de los modelos de página ayudan a garantizar lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="147dc-105">Tests of the data access layer (DAL) and page models help ensure:</span></span>

* <span data-ttu-id="147dc-106">Las partes de una aplicación de Razor Pages funcionan de forma independiente y conjunta como una unidad durante la creación de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="147dc-106">Parts of a Razor Pages app work independently and together as a unit during app construction.</span></span>
* <span data-ttu-id="147dc-107">Las clases y los métodos tienen ámbitos de responsabilidad restringidos.</span><span class="sxs-lookup"><span data-stu-id="147dc-107">Classes and methods have limited scopes of responsibility.</span></span>
* <span data-ttu-id="147dc-108">Hay documentación adicional disponible sobre cómo debe comportarse la aplicación.</span><span class="sxs-lookup"><span data-stu-id="147dc-108">Additional documentation exists on how the app should behave.</span></span>
* <span data-ttu-id="147dc-109">Se detectan regresiones —que son errores que salen a la luz a raíz de las actualizaciones de código— en los procesos de compilación e implementación automatizados.</span><span class="sxs-lookup"><span data-stu-id="147dc-109">Regressions, which are errors brought about by updates to the code, are found during automated building and deployment.</span></span>

<span data-ttu-id="147dc-110">En este tema se da por hecho que el usuario posee conocimientos básicos de las pruebas unitarias y las aplicaciones de Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="147dc-110">This topic assumes that you have a basic understanding of Razor Pages apps and unit tests.</span></span> <span data-ttu-id="147dc-111">Si no está familiarizado con los conceptos de prueba o aplicaciones de Razor Pages, vea los siguientes temas:</span><span class="sxs-lookup"><span data-stu-id="147dc-111">If you're unfamiliar with Razor Pages apps or test concepts, see the following topics:</span></span>

* <xref:razor-pages/index>
* <xref:tutorials/razor-pages/razor-pages-start>
* [<span data-ttu-id="147dc-112">Prueba unitaria de C# en .NET Core mediante pruebas de dotnet y xUnit</span><span class="sxs-lookup"><span data-stu-id="147dc-112">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)

<span data-ttu-id="147dc-113">[Vea o descargue el código de ejemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([cómo descargarlo](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="147dc-113">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="147dc-114">El proyecto de ejemplo se compone de dos aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="147dc-114">The sample project is composed of two apps:</span></span>

| <span data-ttu-id="147dc-115">Aplicación</span><span class="sxs-lookup"><span data-stu-id="147dc-115">App</span></span>         | <span data-ttu-id="147dc-116">Carpeta del proyecto</span><span class="sxs-lookup"><span data-stu-id="147dc-116">Project folder</span></span>                     | <span data-ttu-id="147dc-117">Descripción</span><span class="sxs-lookup"><span data-stu-id="147dc-117">Description</span></span> |
| ----------- | ---------------------------------- | ----------- |
| <span data-ttu-id="147dc-118">Aplicación de mensajes</span><span class="sxs-lookup"><span data-stu-id="147dc-118">Message app</span></span> | <span data-ttu-id="147dc-119">*src/RazorPagesTestSample*</span><span class="sxs-lookup"><span data-stu-id="147dc-119">*src/RazorPagesTestSample*</span></span>         | <span data-ttu-id="147dc-120">Permite a un usuario agregar un mensaje, eliminar un mensaje, eliminar todos los mensajes y analizar mensajes (hallar la media de palabras por mensaje).</span><span class="sxs-lookup"><span data-stu-id="147dc-120">Allows a user to add a message, delete one message, delete all messages, and analyze messages (find the average number of words per message).</span></span> |
| <span data-ttu-id="147dc-121">Probar la aplicación</span><span class="sxs-lookup"><span data-stu-id="147dc-121">Test app</span></span>    | <span data-ttu-id="147dc-122">*tests/RazorPagesTestSample.Tests*</span><span class="sxs-lookup"><span data-stu-id="147dc-122">*tests/RazorPagesTestSample.Tests*</span></span> | <span data-ttu-id="147dc-123">Sirve para realizar una prueba unitaria del modelo de página Index y la DAL de la aplicación de mensajes.</span><span class="sxs-lookup"><span data-stu-id="147dc-123">Used to unit test the DAL and Index page model of the message app.</span></span> |

<span data-ttu-id="147dc-124">Las pruebas se pueden ejecutar con las características de prueba integradas de un IDE, como [Visual Studio](/visualstudio/test/unit-test-your-code) o [Visual Studio para Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span><span class="sxs-lookup"><span data-stu-id="147dc-124">The tests can be run using the built-in test features of an IDE, such as [Visual Studio](/visualstudio/test/unit-test-your-code) or [Visual Studio for Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span></span> <span data-ttu-id="147dc-125">Si usa [Visual Studio Code](https://code.visualstudio.com/) o la línea de comandos, ejecute el siguiente comando en un símbolo del sistema en la carpeta *tests/RazorPagesTestSample.Tests*:</span><span class="sxs-lookup"><span data-stu-id="147dc-125">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesTestSample.Tests* folder:</span></span>

```dotnetcli
dotnet test
```

## <a name="message-app-organization"></a><span data-ttu-id="147dc-126">Organización de la aplicación de mensajes</span><span class="sxs-lookup"><span data-stu-id="147dc-126">Message app organization</span></span>

<span data-ttu-id="147dc-127">La aplicación de mensajes es un sistema de mensajes de Razor Pages con las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="147dc-127">The message app is a Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="147dc-128">La página Index de la aplicación (*Pages/Index.cshtml* y *Pages/Index.cshtml.cs*) proporciona una interfaz de usuario y métodos de modelo de página para controlar la adición, eliminación y análisis de mensajes (hallar la media de palabras por mensaje).</span><span class="sxs-lookup"><span data-stu-id="147dc-128">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (find the average number of words per message).</span></span>
* <span data-ttu-id="147dc-129">La clase `Message` (*Data/Message.cs*) describe un mensaje con dos propiedades: `Id` (clave) y `Text` (mensaje).</span><span class="sxs-lookup"><span data-stu-id="147dc-129">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="147dc-130">Se necesita la propiedad `Text`, que está limitada a 200 caracteres.</span><span class="sxs-lookup"><span data-stu-id="147dc-130">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="147dc-131">Los mensajes se almacenan en la [base de datos en memoria de Entity Framework](/ef/core/providers/in-memory/)&#8224;.</span><span class="sxs-lookup"><span data-stu-id="147dc-131">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="147dc-132">La aplicación contiene una DAL en su clase de contexto de base de datos, `AppDbContext` (*Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="147dc-132">The app contains a DAL in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span> <span data-ttu-id="147dc-133">Los métodos de DAL se marcan como `virtual`, lo que permite realizar simulaciones en ellos para usarlos en las pruebas.</span><span class="sxs-lookup"><span data-stu-id="147dc-133">The DAL methods are marked `virtual`, which allows mocking the methods for use in the tests.</span></span>
* <span data-ttu-id="147dc-134">Si la base de datos está vacía al inicio de una aplicación, el almacén de mensajes se inicializa con tres mensajes.</span><span class="sxs-lookup"><span data-stu-id="147dc-134">If the database is empty on app startup, the message store is initialized with three messages.</span></span> <span data-ttu-id="147dc-135">Estos *mensajes inicializados* también se usan en las pruebas.</span><span class="sxs-lookup"><span data-stu-id="147dc-135">These *seeded messages* are also used in tests.</span></span>

<span data-ttu-id="147dc-136">&#8224;En el tema de EF, [Pruebas con InMemory](/ef/core/miscellaneous/testing/in-memory), se explica cómo usar una base de datos en memoria con las pruebas con MSTest.</span><span class="sxs-lookup"><span data-stu-id="147dc-136">&#8224;The EF topic, [Test with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for tests with MSTest.</span></span> <span data-ttu-id="147dc-137">En este tema se usa el marco de pruebas [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="147dc-137">This topic uses the [xUnit](https://xunit.github.io/) test framework.</span></span> <span data-ttu-id="147dc-138">Los conceptos y las implementaciones de prueba de diferentes marcos de pruebas son similares, pero no idénticos.</span><span class="sxs-lookup"><span data-stu-id="147dc-138">Test concepts and test implementations across different test frameworks are similar but not identical.</span></span>

<span data-ttu-id="147dc-139">Aunque la aplicación de ejemplo no usa el patrón del repositorio y no es un ejemplo eficaz del [patrón Unit of Work (UoW)](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages admite estos patrones de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="147dc-139">Although the sample app doesn't use the repository pattern and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="147dc-140">Para más información, vea [Diseño del nivel de persistencia de infraestructura](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) y <xref:mvc/controllers/testing> (el ejemplo implementa el patrón del repositorio).</span><span class="sxs-lookup"><span data-stu-id="147dc-140">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) and <xref:mvc/controllers/testing> (the sample implements the repository pattern).</span></span>

## <a name="test-app-organization"></a><span data-ttu-id="147dc-141">Organización de la aplicación de prueba</span><span class="sxs-lookup"><span data-stu-id="147dc-141">Test app organization</span></span>

<span data-ttu-id="147dc-142">La aplicación de prueba es una aplicación de consola dentro de la carpeta *tests/RazorPagesTestSample.Tests*.</span><span class="sxs-lookup"><span data-stu-id="147dc-142">The test app is a console app inside the *tests/RazorPagesTestSample.Tests* folder.</span></span>

| <span data-ttu-id="147dc-143">Carpeta de aplicación de prueba</span><span class="sxs-lookup"><span data-stu-id="147dc-143">Test app folder</span></span> | <span data-ttu-id="147dc-144">Descripción</span><span class="sxs-lookup"><span data-stu-id="147dc-144">Description</span></span> |
| --------------- | ----------- |
| <span data-ttu-id="147dc-145">*UnitTests*</span><span class="sxs-lookup"><span data-stu-id="147dc-145">*UnitTests*</span></span>     | <ul><li><span data-ttu-id="147dc-146">*DataAccessLayerTest.cs* contiene las pruebas unitarias de la DAL.</span><span class="sxs-lookup"><span data-stu-id="147dc-146">*DataAccessLayerTest.cs* contains the unit tests for the DAL.</span></span></li><li><span data-ttu-id="147dc-147">*IndexPageTests.cs* contiene las pruebas unitarias del modelo de página Index.</span><span class="sxs-lookup"><span data-stu-id="147dc-147">*IndexPageTests.cs* contains the unit tests for the Index page model.</span></span></li></ul> |
| <span data-ttu-id="147dc-148">*Utilities*</span><span class="sxs-lookup"><span data-stu-id="147dc-148">*Utilities*</span></span>     | <span data-ttu-id="147dc-149">Contiene el método `TestDbContextOptions` empleado para crear nuevas opciones de contexto de base de datos para cada prueba unitaria de DAL, de modo que la base de datos se restablezca a su condición de línea base en cada prueba.</span><span class="sxs-lookup"><span data-stu-id="147dc-149">Contains the `TestDbContextOptions` method used to create new database context options for each DAL unit test so that the database is reset to its baseline condition for each test.</span></span> |

<span data-ttu-id="147dc-150">El marco de pruebas es [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="147dc-150">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="147dc-151">El marco de trabajo de simulación de objetos es [Moq](https://github.com/moq/moq4).</span><span class="sxs-lookup"><span data-stu-id="147dc-151">The object mocking framework is [Moq](https://github.com/moq/moq4).</span></span>

## <a name="unit-tests-of-the-data-access-layer-dal"></a><span data-ttu-id="147dc-152">Pruebas unitarias de la capa de acceso a datos (DAL)</span><span class="sxs-lookup"><span data-stu-id="147dc-152">Unit tests of the data access layer (DAL)</span></span>

<span data-ttu-id="147dc-153">La aplicación de mensajes tiene una DAL con cuatro métodos contenidos en la clase `AppDbContext` (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="147dc-153">The message app has a DAL with four methods contained in the `AppDbContext` class (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span></span> <span data-ttu-id="147dc-154">Cada método tiene una o dos pruebas unitarias en la aplicación de prueba.</span><span class="sxs-lookup"><span data-stu-id="147dc-154">Each method has one or two unit tests in the test app.</span></span>

| <span data-ttu-id="147dc-155">Método de DAL</span><span class="sxs-lookup"><span data-stu-id="147dc-155">DAL method</span></span>               | <span data-ttu-id="147dc-156">Función</span><span class="sxs-lookup"><span data-stu-id="147dc-156">Function</span></span>                                                                   |
| ------------------------ | -------------------------------------------------------------------------- |
| `GetMessagesAsync`       | <span data-ttu-id="147dc-157">Obtiene un elemento `List<Message>` de la base de datos ordenada por la propiedad `Text`.</span><span class="sxs-lookup"><span data-stu-id="147dc-157">Obtains a `List<Message>` from the database sorted by the `Text` property.</span></span> |
| `AddMessageAsync`        | <span data-ttu-id="147dc-158">Agrega un elemento `Message` a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-158">Adds a `Message` to the database.</span></span>                                          |
| `DeleteAllMessagesAsync` | <span data-ttu-id="147dc-159">Elimina todas las entradas `Message` de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-159">Deletes all `Message` entries from the database.</span></span>                           |
| `DeleteMessageAsync`     | <span data-ttu-id="147dc-160">Elimina todas las entradas `Message` de la base de datos según `Id`.</span><span class="sxs-lookup"><span data-stu-id="147dc-160">Deletes a single `Message` from the database by `Id`.</span></span>                      |

<span data-ttu-id="147dc-161">Las pruebas unitarias de la DAL requieren <xref:Microsoft.EntityFrameworkCore.DbContextOptions> al crear un elemento `AppDbContext` para cada prueba.</span><span class="sxs-lookup"><span data-stu-id="147dc-161">Unit tests of the DAL require <xref:Microsoft.EntityFrameworkCore.DbContextOptions> when creating a new `AppDbContext` for each test.</span></span> <span data-ttu-id="147dc-162">Un método para crear el elemento `DbContextOptions` de cada prueba es usar un elemento <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder>:</span><span class="sxs-lookup"><span data-stu-id="147dc-162">One approach to creating the `DbContextOptions` for each test is to use a <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder>:</span></span>

```csharp
var optionsBuilder = new DbContextOptionsBuilder<AppDbContext>()
    .UseInMemoryDatabase("InMemoryDb");

using (var db = new AppDbContext(optionsBuilder.Options))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="147dc-163">El inconveniente de este método es que cada prueba recibe la base de datos en el estado en el que la dejó la prueba anterior.</span><span class="sxs-lookup"><span data-stu-id="147dc-163">The problem with this approach is that each test receives the database in whatever state the previous test left it.</span></span> <span data-ttu-id="147dc-164">Esto puede ser problemático al intentar escribir pruebas unitarias atómicas que no interfieran entre sí.</span><span class="sxs-lookup"><span data-stu-id="147dc-164">This can be problematic when trying to write atomic unit tests that don't interfere with each other.</span></span> <span data-ttu-id="147dc-165">Para forzar que `AppDbContext` use un nuevo contexto de base de datos en cada prueba, proporcione una instancia de `DbContextOptions` que esté basada en un nuevo proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="147dc-165">To force the `AppDbContext` to use a new database context for each test, supply a `DbContextOptions` instance that's based on a new service provider.</span></span> <span data-ttu-id="147dc-166">La aplicación de prueba muestra cómo llevar esto a cabo usando el método `TestDbContextOptions` de su clase `Utilities` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span><span class="sxs-lookup"><span data-stu-id="147dc-166">The test app shows how to do this using its `Utilities` class method `TestDbContextOptions` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs?name=snippet1)]

<span data-ttu-id="147dc-167">El uso de `DbContextOptions` en las pruebas unitarias de DAL permite que cada prueba se ejecute de forma atómica con una instancia de base de datos completamente nueva:</span><span class="sxs-lookup"><span data-stu-id="147dc-167">Using the `DbContextOptions` in the DAL unit tests allows each test to run atomically with a fresh database instance:</span></span>

```csharp
using (var db = new AppDbContext(Utilities.TestDbContextOptions()))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="147dc-168">Cada método de prueba de la clase `DataAccessLayerTest` (*UnitTests/DataAccessLayerTest.cs*) sigue un patrón Organización-Acción-Aserción similar:</span><span class="sxs-lookup"><span data-stu-id="147dc-168">Each test method in the `DataAccessLayerTest` class (*UnitTests/DataAccessLayerTest.cs*) follows a similar Arrange-Act-Assert pattern:</span></span>

1. <span data-ttu-id="147dc-169">Organización: la base de datos se configura para la prueba y/o el resultado previsto se define.</span><span class="sxs-lookup"><span data-stu-id="147dc-169">Arrange: The database is configured for the test and/or the expected outcome is defined.</span></span>
1. <span data-ttu-id="147dc-170">Acción: la prueba se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="147dc-170">Act: The test is executed.</span></span>
1. <span data-ttu-id="147dc-171">Aserción: se realizan aserciones para determinar si el resultado de la prueba es correcto.</span><span class="sxs-lookup"><span data-stu-id="147dc-171">Assert: Assertions are made to determine if the test result is a success.</span></span>

<span data-ttu-id="147dc-172">Por ejemplo, el método `DeleteMessageAsync` es responsable de quitar un mensaje individual identificado por su `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span><span class="sxs-lookup"><span data-stu-id="147dc-172">For example, the `DeleteMessageAsync` method is responsible for removing a single message identified by its `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/src/RazorPagesTestSample/Data/AppDbContext.cs?name=snippet4)]

<span data-ttu-id="147dc-173">Hay dos pruebas para este método:</span><span class="sxs-lookup"><span data-stu-id="147dc-173">There are two tests for this method.</span></span> <span data-ttu-id="147dc-174">una comprueba que el método elimina un mensaje cuando el mensaje está presente en la base de datos</span><span class="sxs-lookup"><span data-stu-id="147dc-174">One test checks that the method deletes a message when the message is present in the database.</span></span> <span data-ttu-id="147dc-175">y la otra, que la base de datos no cambia si el `Id` del mensaje que se quiere eliminar no existe.</span><span class="sxs-lookup"><span data-stu-id="147dc-175">The other method tests that the database doesn't change if the message `Id` for deletion doesn't exist.</span></span> <span data-ttu-id="147dc-176">Aquí mostramos el método `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound`:</span><span class="sxs-lookup"><span data-stu-id="147dc-176">The `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` method is shown below:</span></span>

[!code-csharp[](razor-pages-tests/samples_snapshot/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="147dc-177">En primer lugar, el método lleva a cabo el paso de organización, donde se prepara todo para el paso de acción.</span><span class="sxs-lookup"><span data-stu-id="147dc-177">First, the method performs the Arrange step, where preparation for the Act step takes place.</span></span> <span data-ttu-id="147dc-178">Los mensajes de inicialización se obtienen y se conservan en `seedMessages`.</span><span class="sxs-lookup"><span data-stu-id="147dc-178">The seeding messages are obtained and held in `seedMessages`.</span></span> <span data-ttu-id="147dc-179">Los mensajes de inicialización se guardan en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-179">The seeding messages are saved into the database.</span></span> <span data-ttu-id="147dc-180">El mensaje con un `Id` de `1` se establece para eliminarse.</span><span class="sxs-lookup"><span data-stu-id="147dc-180">The message with an `Id` of `1` is set for deletion.</span></span> <span data-ttu-id="147dc-181">Cuando el método `DeleteMessageAsync` se ejecuta, los mensajes esperados deben incluir todos los mensajes, excepto el que tenga un `Id` de `1`.</span><span class="sxs-lookup"><span data-stu-id="147dc-181">When the `DeleteMessageAsync` method is executed, the expected messages should have all of the messages except for the one with an `Id` of `1`.</span></span> <span data-ttu-id="147dc-182">La variable `expectedMessages` representa el resultado esperado.</span><span class="sxs-lookup"><span data-stu-id="147dc-182">The `expectedMessages` variable represents this expected outcome.</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="147dc-183">El método actúa: El método `DeleteMessageAsync` se ejecuta pasando un `recId` de `1`:</span><span class="sxs-lookup"><span data-stu-id="147dc-183">The method acts: The `DeleteMessageAsync` method is executed passing in the `recId` of `1`:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet2)]

<span data-ttu-id="147dc-184">Por último, el método obtiene el elemento `Messages` del contexto y lo compara con el elemento `expectedMessages`, afirmando que los dos son iguales:</span><span class="sxs-lookup"><span data-stu-id="147dc-184">Finally, the method obtains the `Messages` from the context and compares it to the `expectedMessages` asserting that the two are equal:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet3)]

<span data-ttu-id="147dc-185">Para comparar que los dos elementos `List<Message>` son iguales:</span><span class="sxs-lookup"><span data-stu-id="147dc-185">In order to compare that the two `List<Message>` are the same:</span></span>

* <span data-ttu-id="147dc-186">Los mensajes se ordenan por `Id`.</span><span class="sxs-lookup"><span data-stu-id="147dc-186">The messages are ordered by `Id`.</span></span>
* <span data-ttu-id="147dc-187">Los pares de mensajes se comparan en la propiedad `Text`.</span><span class="sxs-lookup"><span data-stu-id="147dc-187">Message pairs are compared on the `Text` property.</span></span>

<span data-ttu-id="147dc-188">Un método de prueba similar, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound`, comprueba el resultado de intentar eliminar un mensaje que no existe.</span><span class="sxs-lookup"><span data-stu-id="147dc-188">A similar test method, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` checks the result of attempting to delete a message that doesn't exist.</span></span> <span data-ttu-id="147dc-189">En este caso, los mensajes esperados en la base de datos deben ser iguales a los mensajes reales después de que el método `DeleteMessageAsync` se ejecute.</span><span class="sxs-lookup"><span data-stu-id="147dc-189">In this case, the expected messages in the database should be equal to the actual messages after the `DeleteMessageAsync` method is executed.</span></span> <span data-ttu-id="147dc-190">No debe haber ningún cambio en el contenido de la base de datos:</span><span class="sxs-lookup"><span data-stu-id="147dc-190">There should be no change to the database's content:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet4)]

## <a name="unit-tests-of-the-page-model-methods"></a><span data-ttu-id="147dc-191">Pruebas unitarias de los métodos del modelo de página</span><span class="sxs-lookup"><span data-stu-id="147dc-191">Unit tests of the page model methods</span></span>

<span data-ttu-id="147dc-192">Otro conjunto de pruebas unitarias es responsable de las pruebas de los métodos del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="147dc-192">Another set of unit tests is responsible for tests of page model methods.</span></span> <span data-ttu-id="147dc-193">En la aplicación de mensajes, los modelos de página Index se encuentran en la clase `IndexModel` en *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span><span class="sxs-lookup"><span data-stu-id="147dc-193">In the message app, the Index page models are found in the `IndexModel` class in *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span></span>

| <span data-ttu-id="147dc-194">Método del modelo de página</span><span class="sxs-lookup"><span data-stu-id="147dc-194">Page model method</span></span> | <span data-ttu-id="147dc-195">Función</span><span class="sxs-lookup"><span data-stu-id="147dc-195">Function</span></span> |
| ----------------- | -------- |
| `OnGetAsync` | <span data-ttu-id="147dc-196">Obtiene los mensajes de la DAL de la interfaz de usuario mediante el método `GetMessagesAsync`.</span><span class="sxs-lookup"><span data-stu-id="147dc-196">Obtains the messages from the DAL for the UI using the `GetMessagesAsync` method.</span></span> |
| `OnPostAddMessageAsync` | <span data-ttu-id="147dc-197">Si [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) es válido, se llama a `AddMessageAsync` para agregar un mensaje a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-197">If the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is valid, calls `AddMessageAsync` to add a message to the database.</span></span> |
| `OnPostDeleteAllMessagesAsync` | <span data-ttu-id="147dc-198">Llama a `DeleteAllMessagesAsync` para eliminar todos los mensajes de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-198">Calls `DeleteAllMessagesAsync` to delete all of the messages in the database.</span></span> |
| `OnPostDeleteMessageAsync` | <span data-ttu-id="147dc-199">Ejecuta `DeleteMessageAsync` para eliminar un mensaje con el `Id` especificado.</span><span class="sxs-lookup"><span data-stu-id="147dc-199">Executes `DeleteMessageAsync` to delete a message with the `Id` specified.</span></span> |
| `OnPostAnalyzeMessagesAsync` | <span data-ttu-id="147dc-200">Si hay uno o más mensajes en la base de datos, calcula la media de palabras por mensaje.</span><span class="sxs-lookup"><span data-stu-id="147dc-200">If one or more messages are in the database, calculates the average number of words per message.</span></span> |

<span data-ttu-id="147dc-201">Los métodos del modelo de página se comprueban con siete pruebas en la clase `IndexPageTests` (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span><span class="sxs-lookup"><span data-stu-id="147dc-201">The page model methods are tested using seven tests in the `IndexPageTests` class (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span></span> <span data-ttu-id="147dc-202">Las pruebas usan el conocido patrón Organización-Aserción-Acción.</span><span class="sxs-lookup"><span data-stu-id="147dc-202">The tests use the familiar Arrange-Assert-Act pattern.</span></span> <span data-ttu-id="147dc-203">Estas pruebas se centran en lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="147dc-203">These tests focus on:</span></span>

* <span data-ttu-id="147dc-204">Determinar si los métodos siguen el comportamiento correcto cuando [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) no es válido.</span><span class="sxs-lookup"><span data-stu-id="147dc-204">Determining if the methods follow the correct behavior when the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is invalid.</span></span>
* <span data-ttu-id="147dc-205">Confirmar que los métodos generan el elemento <xref:Microsoft.AspNetCore.Mvc.IActionResult> correcto.</span><span class="sxs-lookup"><span data-stu-id="147dc-205">Confirming the methods produce the correct <xref:Microsoft.AspNetCore.Mvc.IActionResult>.</span></span>
* <span data-ttu-id="147dc-206">Comprobar que las asignaciones de valores de propiedad se realizan correctamente.</span><span class="sxs-lookup"><span data-stu-id="147dc-206">Checking that property value assignments are made correctly.</span></span>

<span data-ttu-id="147dc-207">Este grupo de pruebas suele simular los métodos de DAL para generar los datos esperados en el paso de acción, en el que un método de modelo de página se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="147dc-207">This group of tests often mock the methods of the DAL to produce expected data for the Act step where a page model method is executed.</span></span> <span data-ttu-id="147dc-208">Por ejemplo, el método `GetMessagesAsync` de `AppDbContext` se simula para generar una salida.</span><span class="sxs-lookup"><span data-stu-id="147dc-208">For example, the `GetMessagesAsync` method of the `AppDbContext` is mocked to produce output.</span></span> <span data-ttu-id="147dc-209">Cuando un método de modelo de página ejecuta este método, la simulación devuelve el resultado.</span><span class="sxs-lookup"><span data-stu-id="147dc-209">When a page model method executes this method, the mock returns the result.</span></span> <span data-ttu-id="147dc-210">Los datos no provienen de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-210">The data doesn't come from the database.</span></span> <span data-ttu-id="147dc-211">Esto crea condiciones de prueba de confianza y confiables para usar la DAL en las pruebas del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="147dc-211">This creates predictable, reliable test conditions for using the DAL in the page model tests.</span></span>

<span data-ttu-id="147dc-212">La prueba `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` muestra cómo se simula el método `GetMessagesAsync` para el modelo de página:</span><span class="sxs-lookup"><span data-stu-id="147dc-212">The `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` test shows how the `GetMessagesAsync` method is mocked for the page model:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet1&highlight=3-4)]

<span data-ttu-id="147dc-213">Cuando el método `OnGetAsync` se ejecuta en el paso de acción, llama al método `GetMessagesAsync` del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="147dc-213">When the `OnGetAsync` method is executed in the Act step, it calls the page model's `GetMessagesAsync` method.</span></span>

<span data-ttu-id="147dc-214">Paso de acción de prueba unitaria (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span><span class="sxs-lookup"><span data-stu-id="147dc-214">Unit test Act step (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet2)]

<span data-ttu-id="147dc-215">Método `OnGetAsync` del modelo de página `IndexPage` (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span><span class="sxs-lookup"><span data-stu-id="147dc-215">`IndexPage` page model's `OnGetAsync` method (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/src/RazorPagesTestSample/Pages/Index.cshtml.cs?name=snippet1&highlight=3)]

<span data-ttu-id="147dc-216">El método `GetMessagesAsync` de la DAL no devuelve el resultado de esta llamada al método.</span><span class="sxs-lookup"><span data-stu-id="147dc-216">The `GetMessagesAsync` method in the DAL doesn't return the result for this method call.</span></span> <span data-ttu-id="147dc-217">La versión simulada del método devuelve el resultado.</span><span class="sxs-lookup"><span data-stu-id="147dc-217">The mocked version of the method returns the result.</span></span>

<span data-ttu-id="147dc-218">En el paso `Assert`, los mensajes reales (`actualMessages`) se asignan desde la propiedad `Messages` del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="147dc-218">In the `Assert` step, the actual messages (`actualMessages`) are assigned from the `Messages` property of the page model.</span></span> <span data-ttu-id="147dc-219">También se realiza una comprobación de tipo cuando los mensajes se asignan.</span><span class="sxs-lookup"><span data-stu-id="147dc-219">A type check is also performed when the messages are assigned.</span></span> <span data-ttu-id="147dc-220">Las propiedades `Text` de los mensajes esperados y reales se comparan.</span><span class="sxs-lookup"><span data-stu-id="147dc-220">The expected and actual messages are compared by their `Text` properties.</span></span> <span data-ttu-id="147dc-221">La prueba afirma que las dos instancias de `List<Message>` contienen los mismos mensajes.</span><span class="sxs-lookup"><span data-stu-id="147dc-221">The test asserts that the two `List<Message>` instances contain the same messages.</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet3)]

<span data-ttu-id="147dc-222">Otras pruebas de este grupo crean objetos de modelo de página que incluyen <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>, <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, un elemento <xref:Microsoft.AspNetCore.Mvc.ActionContext> para establecer `PageContext`, un elemento `ViewDataDictionary` y un elemento `PageContext`.</span><span class="sxs-lookup"><span data-stu-id="147dc-222">Other tests in this group create page model objects that include the <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>, the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, an <xref:Microsoft.AspNetCore.Mvc.ActionContext> to establish the `PageContext`, a `ViewDataDictionary`, and a `PageContext`.</span></span> <span data-ttu-id="147dc-223">Todos ellos resultan útiles para realizar pruebas.</span><span class="sxs-lookup"><span data-stu-id="147dc-223">These are useful in conducting tests.</span></span> <span data-ttu-id="147dc-224">Por ejemplo, la aplicación de mensajes establece un error de `ModelState` con <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> para comprobar si se devuelve un elemento <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> válido cuando `OnPostAddMessageAsync` se ejecuta:</span><span class="sxs-lookup"><span data-stu-id="147dc-224">For example, the message app establishes a `ModelState` error with <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> to check that a valid <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> is returned when `OnPostAddMessageAsync` is executed:</span></span>

[!code-csharp[](razor-pages-tests/samples/3.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet4&highlight=11,26,29,32)]

## <a name="additional-resources"></a><span data-ttu-id="147dc-225">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="147dc-225">Additional resources</span></span>

* [<span data-ttu-id="147dc-226">Prueba unitaria de C# en .NET Core mediante pruebas de dotnet y xUnit</span><span class="sxs-lookup"><span data-stu-id="147dc-226">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* <xref:mvc/controllers/testing>
* <span data-ttu-id="147dc-227">[Prueba unitaria del código](/visualstudio/test/unit-test-your-code) (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="147dc-227">[Unit Test Your Code](/visualstudio/test/unit-test-your-code) (Visual Studio)</span></span>
* <xref:test/integration-tests>
* [<span data-ttu-id="147dc-228">xUnit.net</span><span class="sxs-lookup"><span data-stu-id="147dc-228">xUnit.net</span></span>](https://xunit.github.io/)
* [<span data-ttu-id="147dc-229">Creación de una solución completa de .NET Core en macOS con Visual Studio para Mac</span><span class="sxs-lookup"><span data-stu-id="147dc-229">Building a complete .NET Core solution on macOS using Visual Studio for Mac</span></span>](/dotnet/core/tutorials/using-on-mac-vs-full-solution)
* [<span data-ttu-id="147dc-230">Introducción a xUnit.net: Uso de .NET Core con la línea de comandos del SDK de .NET</span><span class="sxs-lookup"><span data-stu-id="147dc-230">Getting started with xUnit.net: Using .NET Core with the .NET SDK command line</span></span>](https://xunit.github.io/docs/getting-started-dotnet-core)
* [<span data-ttu-id="147dc-231">Moq</span><span class="sxs-lookup"><span data-stu-id="147dc-231">Moq</span></span>](https://github.com/moq/moq4)
* [<span data-ttu-id="147dc-232">Inicio rápido de Moq</span><span class="sxs-lookup"><span data-stu-id="147dc-232">Moq Quickstart</span></span>](https://github.com/Moq/moq4/wiki/Quickstart)

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="147dc-233">ASP.NET Core admite pruebas unitarias de aplicaciones de Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="147dc-233">ASP.NET Core supports unit tests of Razor Pages apps.</span></span> <span data-ttu-id="147dc-234">Las pruebas de la capa de acceso a datos (DAL) y de los modelos de página ayudan a garantizar lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="147dc-234">Tests of the data access layer (DAL) and page models help ensure:</span></span>

* <span data-ttu-id="147dc-235">Las partes de una aplicación de Razor Pages funcionan de forma independiente y conjunta como una unidad durante la creación de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="147dc-235">Parts of a Razor Pages app work independently and together as a unit during app construction.</span></span>
* <span data-ttu-id="147dc-236">Las clases y los métodos tienen ámbitos de responsabilidad restringidos.</span><span class="sxs-lookup"><span data-stu-id="147dc-236">Classes and methods have limited scopes of responsibility.</span></span>
* <span data-ttu-id="147dc-237">Hay documentación adicional disponible sobre cómo debe comportarse la aplicación.</span><span class="sxs-lookup"><span data-stu-id="147dc-237">Additional documentation exists on how the app should behave.</span></span>
* <span data-ttu-id="147dc-238">Se detectan regresiones —que son errores que salen a la luz a raíz de las actualizaciones de código— en los procesos de compilación e implementación automatizados.</span><span class="sxs-lookup"><span data-stu-id="147dc-238">Regressions, which are errors brought about by updates to the code, are found during automated building and deployment.</span></span>

<span data-ttu-id="147dc-239">En este tema se da por hecho que el usuario posee conocimientos básicos de las pruebas unitarias y las aplicaciones de Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="147dc-239">This topic assumes that you have a basic understanding of Razor Pages apps and unit tests.</span></span> <span data-ttu-id="147dc-240">Si no está familiarizado con los conceptos de prueba o aplicaciones de Razor Pages, vea los siguientes temas:</span><span class="sxs-lookup"><span data-stu-id="147dc-240">If you're unfamiliar with Razor Pages apps or test concepts, see the following topics:</span></span>

* <xref:razor-pages/index>
* <xref:tutorials/razor-pages/razor-pages-start>
* [<span data-ttu-id="147dc-241">Prueba unitaria de C# en .NET Core mediante pruebas de dotnet y xUnit</span><span class="sxs-lookup"><span data-stu-id="147dc-241">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)

<span data-ttu-id="147dc-242">[Vea o descargue el código de ejemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([cómo descargarlo](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="147dc-242">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/test/razor-pages-tests/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="147dc-243">El proyecto de ejemplo se compone de dos aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="147dc-243">The sample project is composed of two apps:</span></span>

| <span data-ttu-id="147dc-244">Aplicación</span><span class="sxs-lookup"><span data-stu-id="147dc-244">App</span></span>         | <span data-ttu-id="147dc-245">Carpeta del proyecto</span><span class="sxs-lookup"><span data-stu-id="147dc-245">Project folder</span></span>                     | <span data-ttu-id="147dc-246">Descripción</span><span class="sxs-lookup"><span data-stu-id="147dc-246">Description</span></span> |
| ----------- | ---------------------------------- | ----------- |
| <span data-ttu-id="147dc-247">Aplicación de mensajes</span><span class="sxs-lookup"><span data-stu-id="147dc-247">Message app</span></span> | <span data-ttu-id="147dc-248">*src/RazorPagesTestSample*</span><span class="sxs-lookup"><span data-stu-id="147dc-248">*src/RazorPagesTestSample*</span></span>         | <span data-ttu-id="147dc-249">Permite a un usuario agregar un mensaje, eliminar un mensaje, eliminar todos los mensajes y analizar mensajes (hallar la media de palabras por mensaje).</span><span class="sxs-lookup"><span data-stu-id="147dc-249">Allows a user to add a message, delete one message, delete all messages, and analyze messages (find the average number of words per message).</span></span> |
| <span data-ttu-id="147dc-250">Probar la aplicación</span><span class="sxs-lookup"><span data-stu-id="147dc-250">Test app</span></span>    | <span data-ttu-id="147dc-251">*tests/RazorPagesTestSample.Tests*</span><span class="sxs-lookup"><span data-stu-id="147dc-251">*tests/RazorPagesTestSample.Tests*</span></span> | <span data-ttu-id="147dc-252">Sirve para realizar una prueba unitaria del modelo de página Index y la DAL de la aplicación de mensajes.</span><span class="sxs-lookup"><span data-stu-id="147dc-252">Used to unit test the DAL and Index page model of the message app.</span></span> |

<span data-ttu-id="147dc-253">Las pruebas se pueden ejecutar con las características de prueba integradas de un IDE, como [Visual Studio](/visualstudio/test/unit-test-your-code) o [Visual Studio para Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span><span class="sxs-lookup"><span data-stu-id="147dc-253">The tests can be run using the built-in test features of an IDE, such as [Visual Studio](/visualstudio/test/unit-test-your-code) or [Visual Studio for Mac](/dotnet/core/tutorials/using-on-mac-vs-full-solution).</span></span> <span data-ttu-id="147dc-254">Si usa [Visual Studio Code](https://code.visualstudio.com/) o la línea de comandos, ejecute el siguiente comando en un símbolo del sistema en la carpeta *tests/RazorPagesTestSample.Tests*:</span><span class="sxs-lookup"><span data-stu-id="147dc-254">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesTestSample.Tests* folder:</span></span>

```dotnetcli
dotnet test
```

## <a name="message-app-organization"></a><span data-ttu-id="147dc-255">Organización de la aplicación de mensajes</span><span class="sxs-lookup"><span data-stu-id="147dc-255">Message app organization</span></span>

<span data-ttu-id="147dc-256">La aplicación de mensajes es un sistema de mensajes de Razor Pages con las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="147dc-256">The message app is a Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="147dc-257">La página Index de la aplicación (*Pages/Index.cshtml* y *Pages/Index.cshtml.cs*) proporciona una interfaz de usuario y métodos de modelo de página para controlar la adición, eliminación y análisis de mensajes (hallar la media de palabras por mensaje).</span><span class="sxs-lookup"><span data-stu-id="147dc-257">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (find the average number of words per message).</span></span>
* <span data-ttu-id="147dc-258">La clase `Message` (*Data/Message.cs*) describe un mensaje con dos propiedades: `Id` (clave) y `Text` (mensaje).</span><span class="sxs-lookup"><span data-stu-id="147dc-258">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="147dc-259">Se necesita la propiedad `Text`, que está limitada a 200 caracteres.</span><span class="sxs-lookup"><span data-stu-id="147dc-259">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="147dc-260">Los mensajes se almacenan en la [base de datos en memoria de Entity Framework](/ef/core/providers/in-memory/)&#8224;.</span><span class="sxs-lookup"><span data-stu-id="147dc-260">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="147dc-261">La aplicación contiene una DAL en su clase de contexto de base de datos, `AppDbContext` (*Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="147dc-261">The app contains a DAL in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span> <span data-ttu-id="147dc-262">Los métodos de DAL se marcan como `virtual`, lo que permite realizar simulaciones en ellos para usarlos en las pruebas.</span><span class="sxs-lookup"><span data-stu-id="147dc-262">The DAL methods are marked `virtual`, which allows mocking the methods for use in the tests.</span></span>
* <span data-ttu-id="147dc-263">Si la base de datos está vacía al inicio de una aplicación, el almacén de mensajes se inicializa con tres mensajes.</span><span class="sxs-lookup"><span data-stu-id="147dc-263">If the database is empty on app startup, the message store is initialized with three messages.</span></span> <span data-ttu-id="147dc-264">Estos *mensajes inicializados* también se usan en las pruebas.</span><span class="sxs-lookup"><span data-stu-id="147dc-264">These *seeded messages* are also used in tests.</span></span>

<span data-ttu-id="147dc-265">&#8224;En el tema de EF, [Pruebas con InMemory](/ef/core/miscellaneous/testing/in-memory), se explica cómo usar una base de datos en memoria con las pruebas con MSTest.</span><span class="sxs-lookup"><span data-stu-id="147dc-265">&#8224;The EF topic, [Test with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for tests with MSTest.</span></span> <span data-ttu-id="147dc-266">En este tema se usa el marco de pruebas [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="147dc-266">This topic uses the [xUnit](https://xunit.github.io/) test framework.</span></span> <span data-ttu-id="147dc-267">Los conceptos y las implementaciones de prueba de diferentes marcos de pruebas son similares, pero no idénticos.</span><span class="sxs-lookup"><span data-stu-id="147dc-267">Test concepts and test implementations across different test frameworks are similar but not identical.</span></span>

<span data-ttu-id="147dc-268">Aunque la aplicación de ejemplo no usa el patrón del repositorio y no es un ejemplo eficaz del [patrón Unit of Work (UoW)](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages admite estos patrones de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="147dc-268">Although the sample app doesn't use the repository pattern and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="147dc-269">Para más información, vea [Diseño del nivel de persistencia de infraestructura](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) y <xref:mvc/controllers/testing> (el ejemplo implementa el patrón del repositorio).</span><span class="sxs-lookup"><span data-stu-id="147dc-269">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design) and <xref:mvc/controllers/testing> (the sample implements the repository pattern).</span></span>

## <a name="test-app-organization"></a><span data-ttu-id="147dc-270">Organización de la aplicación de prueba</span><span class="sxs-lookup"><span data-stu-id="147dc-270">Test app organization</span></span>

<span data-ttu-id="147dc-271">La aplicación de prueba es una aplicación de consola dentro de la carpeta *tests/RazorPagesTestSample.Tests*.</span><span class="sxs-lookup"><span data-stu-id="147dc-271">The test app is a console app inside the *tests/RazorPagesTestSample.Tests* folder.</span></span>

| <span data-ttu-id="147dc-272">Carpeta de aplicación de prueba</span><span class="sxs-lookup"><span data-stu-id="147dc-272">Test app folder</span></span> | <span data-ttu-id="147dc-273">Descripción</span><span class="sxs-lookup"><span data-stu-id="147dc-273">Description</span></span> |
| --------------- | ----------- |
| <span data-ttu-id="147dc-274">*UnitTests*</span><span class="sxs-lookup"><span data-stu-id="147dc-274">*UnitTests*</span></span>     | <ul><li><span data-ttu-id="147dc-275">*DataAccessLayerTest.cs* contiene las pruebas unitarias de la DAL.</span><span class="sxs-lookup"><span data-stu-id="147dc-275">*DataAccessLayerTest.cs* contains the unit tests for the DAL.</span></span></li><li><span data-ttu-id="147dc-276">*IndexPageTests.cs* contiene las pruebas unitarias del modelo de página Index.</span><span class="sxs-lookup"><span data-stu-id="147dc-276">*IndexPageTests.cs* contains the unit tests for the Index page model.</span></span></li></ul> |
| <span data-ttu-id="147dc-277">*Utilities*</span><span class="sxs-lookup"><span data-stu-id="147dc-277">*Utilities*</span></span>     | <span data-ttu-id="147dc-278">Contiene el método `TestDbContextOptions` empleado para crear nuevas opciones de contexto de base de datos para cada prueba unitaria de DAL, de modo que la base de datos se restablezca a su condición de línea base en cada prueba.</span><span class="sxs-lookup"><span data-stu-id="147dc-278">Contains the `TestDbContextOptions` method used to create new database context options for each DAL unit test so that the database is reset to its baseline condition for each test.</span></span> |

<span data-ttu-id="147dc-279">El marco de pruebas es [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="147dc-279">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="147dc-280">El marco de trabajo de simulación de objetos es [Moq](https://github.com/moq/moq4).</span><span class="sxs-lookup"><span data-stu-id="147dc-280">The object mocking framework is [Moq](https://github.com/moq/moq4).</span></span>

## <a name="unit-tests-of-the-data-access-layer-dal"></a><span data-ttu-id="147dc-281">Pruebas unitarias de la capa de acceso a datos (DAL)</span><span class="sxs-lookup"><span data-stu-id="147dc-281">Unit tests of the data access layer (DAL)</span></span>

<span data-ttu-id="147dc-282">La aplicación de mensajes tiene una DAL con cuatro métodos contenidos en la clase `AppDbContext` (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="147dc-282">The message app has a DAL with four methods contained in the `AppDbContext` class (*src/RazorPagesTestSample/Data/AppDbContext.cs*).</span></span> <span data-ttu-id="147dc-283">Cada método tiene una o dos pruebas unitarias en la aplicación de prueba.</span><span class="sxs-lookup"><span data-stu-id="147dc-283">Each method has one or two unit tests in the test app.</span></span>

| <span data-ttu-id="147dc-284">Método de DAL</span><span class="sxs-lookup"><span data-stu-id="147dc-284">DAL method</span></span>               | <span data-ttu-id="147dc-285">Función</span><span class="sxs-lookup"><span data-stu-id="147dc-285">Function</span></span>                                                                   |
| ------------------------ | -------------------------------------------------------------------------- |
| `GetMessagesAsync`       | <span data-ttu-id="147dc-286">Obtiene un elemento `List<Message>` de la base de datos ordenada por la propiedad `Text`.</span><span class="sxs-lookup"><span data-stu-id="147dc-286">Obtains a `List<Message>` from the database sorted by the `Text` property.</span></span> |
| `AddMessageAsync`        | <span data-ttu-id="147dc-287">Agrega un elemento `Message` a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-287">Adds a `Message` to the database.</span></span>                                          |
| `DeleteAllMessagesAsync` | <span data-ttu-id="147dc-288">Elimina todas las entradas `Message` de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-288">Deletes all `Message` entries from the database.</span></span>                           |
| `DeleteMessageAsync`     | <span data-ttu-id="147dc-289">Elimina todas las entradas `Message` de la base de datos según `Id`.</span><span class="sxs-lookup"><span data-stu-id="147dc-289">Deletes a single `Message` from the database by `Id`.</span></span>                      |

<span data-ttu-id="147dc-290">Las pruebas unitarias de la DAL requieren <xref:Microsoft.EntityFrameworkCore.DbContextOptions> al crear un elemento `AppDbContext` para cada prueba.</span><span class="sxs-lookup"><span data-stu-id="147dc-290">Unit tests of the DAL require <xref:Microsoft.EntityFrameworkCore.DbContextOptions> when creating a new `AppDbContext` for each test.</span></span> <span data-ttu-id="147dc-291">Un método para crear el elemento `DbContextOptions` de cada prueba es usar un elemento <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder>:</span><span class="sxs-lookup"><span data-stu-id="147dc-291">One approach to creating the `DbContextOptions` for each test is to use a <xref:Microsoft.EntityFrameworkCore.DbContextOptionsBuilder>:</span></span>

```csharp
var optionsBuilder = new DbContextOptionsBuilder<AppDbContext>()
    .UseInMemoryDatabase("InMemoryDb");

using (var db = new AppDbContext(optionsBuilder.Options))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="147dc-292">El inconveniente de este método es que cada prueba recibe la base de datos en el estado en el que la dejó la prueba anterior.</span><span class="sxs-lookup"><span data-stu-id="147dc-292">The problem with this approach is that each test receives the database in whatever state the previous test left it.</span></span> <span data-ttu-id="147dc-293">Esto puede ser problemático al intentar escribir pruebas unitarias atómicas que no interfieran entre sí.</span><span class="sxs-lookup"><span data-stu-id="147dc-293">This can be problematic when trying to write atomic unit tests that don't interfere with each other.</span></span> <span data-ttu-id="147dc-294">Para forzar que `AppDbContext` use un nuevo contexto de base de datos en cada prueba, proporcione una instancia de `DbContextOptions` que esté basada en un nuevo proveedor de servicios.</span><span class="sxs-lookup"><span data-stu-id="147dc-294">To force the `AppDbContext` to use a new database context for each test, supply a `DbContextOptions` instance that's based on a new service provider.</span></span> <span data-ttu-id="147dc-295">La aplicación de prueba muestra cómo llevar esto a cabo usando el método `TestDbContextOptions` de su clase `Utilities` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span><span class="sxs-lookup"><span data-stu-id="147dc-295">The test app shows how to do this using its `Utilities` class method `TestDbContextOptions` (*tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/Utilities/Utilities.cs?name=snippet1)]

<span data-ttu-id="147dc-296">El uso de `DbContextOptions` en las pruebas unitarias de DAL permite que cada prueba se ejecute de forma atómica con una instancia de base de datos completamente nueva:</span><span class="sxs-lookup"><span data-stu-id="147dc-296">Using the `DbContextOptions` in the DAL unit tests allows each test to run atomically with a fresh database instance:</span></span>

```csharp
using (var db = new AppDbContext(Utilities.TestDbContextOptions()))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="147dc-297">Cada método de prueba de la clase `DataAccessLayerTest` (*UnitTests/DataAccessLayerTest.cs*) sigue un patrón Organización-Acción-Aserción similar:</span><span class="sxs-lookup"><span data-stu-id="147dc-297">Each test method in the `DataAccessLayerTest` class (*UnitTests/DataAccessLayerTest.cs*) follows a similar Arrange-Act-Assert pattern:</span></span>

1. <span data-ttu-id="147dc-298">Organización: la base de datos se configura para la prueba y/o el resultado previsto se define.</span><span class="sxs-lookup"><span data-stu-id="147dc-298">Arrange: The database is configured for the test and/or the expected outcome is defined.</span></span>
1. <span data-ttu-id="147dc-299">Acción: la prueba se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="147dc-299">Act: The test is executed.</span></span>
1. <span data-ttu-id="147dc-300">Aserción: se realizan aserciones para determinar si el resultado de la prueba es correcto.</span><span class="sxs-lookup"><span data-stu-id="147dc-300">Assert: Assertions are made to determine if the test result is a success.</span></span>

<span data-ttu-id="147dc-301">Por ejemplo, el método `DeleteMessageAsync` es responsable de quitar un mensaje individual identificado por su `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span><span class="sxs-lookup"><span data-stu-id="147dc-301">For example, the `DeleteMessageAsync` method is responsible for removing a single message identified by its `Id` (*src/RazorPagesTestSample/Data/AppDbContext.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/src/RazorPagesTestSample/Data/AppDbContext.cs?name=snippet4)]

<span data-ttu-id="147dc-302">Hay dos pruebas para este método:</span><span class="sxs-lookup"><span data-stu-id="147dc-302">There are two tests for this method.</span></span> <span data-ttu-id="147dc-303">una comprueba que el método elimina un mensaje cuando el mensaje está presente en la base de datos</span><span class="sxs-lookup"><span data-stu-id="147dc-303">One test checks that the method deletes a message when the message is present in the database.</span></span> <span data-ttu-id="147dc-304">y la otra, que la base de datos no cambia si el `Id` del mensaje que se quiere eliminar no existe.</span><span class="sxs-lookup"><span data-stu-id="147dc-304">The other method tests that the database doesn't change if the message `Id` for deletion doesn't exist.</span></span> <span data-ttu-id="147dc-305">Aquí mostramos el método `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound`:</span><span class="sxs-lookup"><span data-stu-id="147dc-305">The `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` method is shown below:</span></span>

[!code-csharp[](razor-pages-tests/samples_snapshot/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="147dc-306">En primer lugar, el método lleva a cabo el paso de organización, donde se prepara todo para el paso de acción.</span><span class="sxs-lookup"><span data-stu-id="147dc-306">First, the method performs the Arrange step, where preparation for the Act step takes place.</span></span> <span data-ttu-id="147dc-307">Los mensajes de inicialización se obtienen y se conservan en `seedMessages`.</span><span class="sxs-lookup"><span data-stu-id="147dc-307">The seeding messages are obtained and held in `seedMessages`.</span></span> <span data-ttu-id="147dc-308">Los mensajes de inicialización se guardan en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-308">The seeding messages are saved into the database.</span></span> <span data-ttu-id="147dc-309">El mensaje con un `Id` de `1` se establece para eliminarse.</span><span class="sxs-lookup"><span data-stu-id="147dc-309">The message with an `Id` of `1` is set for deletion.</span></span> <span data-ttu-id="147dc-310">Cuando el método `DeleteMessageAsync` se ejecuta, los mensajes esperados deben incluir todos los mensajes, excepto el que tenga un `Id` de `1`.</span><span class="sxs-lookup"><span data-stu-id="147dc-310">When the `DeleteMessageAsync` method is executed, the expected messages should have all of the messages except for the one with an `Id` of `1`.</span></span> <span data-ttu-id="147dc-311">La variable `expectedMessages` representa el resultado esperado.</span><span class="sxs-lookup"><span data-stu-id="147dc-311">The `expectedMessages` variable represents this expected outcome.</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="147dc-312">El método actúa: El método `DeleteMessageAsync` se ejecuta pasando un `recId` de `1`:</span><span class="sxs-lookup"><span data-stu-id="147dc-312">The method acts: The `DeleteMessageAsync` method is executed passing in the `recId` of `1`:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet2)]

<span data-ttu-id="147dc-313">Por último, el método obtiene el elemento `Messages` del contexto y lo compara con el elemento `expectedMessages`, afirmando que los dos son iguales:</span><span class="sxs-lookup"><span data-stu-id="147dc-313">Finally, the method obtains the `Messages` from the context and compares it to the `expectedMessages` asserting that the two are equal:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet3)]

<span data-ttu-id="147dc-314">Para comparar que los dos elementos `List<Message>` son iguales:</span><span class="sxs-lookup"><span data-stu-id="147dc-314">In order to compare that the two `List<Message>` are the same:</span></span>

* <span data-ttu-id="147dc-315">Los mensajes se ordenan por `Id`.</span><span class="sxs-lookup"><span data-stu-id="147dc-315">The messages are ordered by `Id`.</span></span>
* <span data-ttu-id="147dc-316">Los pares de mensajes se comparan en la propiedad `Text`.</span><span class="sxs-lookup"><span data-stu-id="147dc-316">Message pairs are compared on the `Text` property.</span></span>

<span data-ttu-id="147dc-317">Un método de prueba similar, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound`, comprueba el resultado de intentar eliminar un mensaje que no existe.</span><span class="sxs-lookup"><span data-stu-id="147dc-317">A similar test method, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` checks the result of attempting to delete a message that doesn't exist.</span></span> <span data-ttu-id="147dc-318">En este caso, los mensajes esperados en la base de datos deben ser iguales a los mensajes reales después de que el método `DeleteMessageAsync` se ejecute.</span><span class="sxs-lookup"><span data-stu-id="147dc-318">In this case, the expected messages in the database should be equal to the actual messages after the `DeleteMessageAsync` method is executed.</span></span> <span data-ttu-id="147dc-319">No debe haber ningún cambio en el contenido de la base de datos:</span><span class="sxs-lookup"><span data-stu-id="147dc-319">There should be no change to the database's content:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet4)]

## <a name="unit-tests-of-the-page-model-methods"></a><span data-ttu-id="147dc-320">Pruebas unitarias de los métodos del modelo de página</span><span class="sxs-lookup"><span data-stu-id="147dc-320">Unit tests of the page model methods</span></span>

<span data-ttu-id="147dc-321">Otro conjunto de pruebas unitarias es responsable de las pruebas de los métodos del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="147dc-321">Another set of unit tests is responsible for tests of page model methods.</span></span> <span data-ttu-id="147dc-322">En la aplicación de mensajes, los modelos de página Index se encuentran en la clase `IndexModel` en *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span><span class="sxs-lookup"><span data-stu-id="147dc-322">In the message app, the Index page models are found in the `IndexModel` class in *src/RazorPagesTestSample/Pages/Index.cshtml.cs*.</span></span>

| <span data-ttu-id="147dc-323">Método del modelo de página</span><span class="sxs-lookup"><span data-stu-id="147dc-323">Page model method</span></span> | <span data-ttu-id="147dc-324">Función</span><span class="sxs-lookup"><span data-stu-id="147dc-324">Function</span></span> |
| ----------------- | -------- |
| `OnGetAsync` | <span data-ttu-id="147dc-325">Obtiene los mensajes de la DAL de la interfaz de usuario mediante el método `GetMessagesAsync`.</span><span class="sxs-lookup"><span data-stu-id="147dc-325">Obtains the messages from the DAL for the UI using the `GetMessagesAsync` method.</span></span> |
| `OnPostAddMessageAsync` | <span data-ttu-id="147dc-326">Si [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) es válido, se llama a `AddMessageAsync` para agregar un mensaje a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-326">If the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is valid, calls `AddMessageAsync` to add a message to the database.</span></span> |
| `OnPostDeleteAllMessagesAsync` | <span data-ttu-id="147dc-327">Llama a `DeleteAllMessagesAsync` para eliminar todos los mensajes de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-327">Calls `DeleteAllMessagesAsync` to delete all of the messages in the database.</span></span> |
| `OnPostDeleteMessageAsync` | <span data-ttu-id="147dc-328">Ejecuta `DeleteMessageAsync` para eliminar un mensaje con el `Id` especificado.</span><span class="sxs-lookup"><span data-stu-id="147dc-328">Executes `DeleteMessageAsync` to delete a message with the `Id` specified.</span></span> |
| `OnPostAnalyzeMessagesAsync` | <span data-ttu-id="147dc-329">Si hay uno o más mensajes en la base de datos, calcula la media de palabras por mensaje.</span><span class="sxs-lookup"><span data-stu-id="147dc-329">If one or more messages are in the database, calculates the average number of words per message.</span></span> |

<span data-ttu-id="147dc-330">Los métodos del modelo de página se comprueban con siete pruebas en la clase `IndexPageTests` (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span><span class="sxs-lookup"><span data-stu-id="147dc-330">The page model methods are tested using seven tests in the `IndexPageTests` class (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*).</span></span> <span data-ttu-id="147dc-331">Las pruebas usan el conocido patrón Organización-Aserción-Acción.</span><span class="sxs-lookup"><span data-stu-id="147dc-331">The tests use the familiar Arrange-Assert-Act pattern.</span></span> <span data-ttu-id="147dc-332">Estas pruebas se centran en lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="147dc-332">These tests focus on:</span></span>

* <span data-ttu-id="147dc-333">Determinar si los métodos siguen el comportamiento correcto cuando [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) no es válido.</span><span class="sxs-lookup"><span data-stu-id="147dc-333">Determining if the methods follow the correct behavior when the [ModelState](xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary) is invalid.</span></span>
* <span data-ttu-id="147dc-334">Confirmar que los métodos generan el elemento <xref:Microsoft.AspNetCore.Mvc.IActionResult> correcto.</span><span class="sxs-lookup"><span data-stu-id="147dc-334">Confirming the methods produce the correct <xref:Microsoft.AspNetCore.Mvc.IActionResult>.</span></span>
* <span data-ttu-id="147dc-335">Comprobar que las asignaciones de valores de propiedad se realizan correctamente.</span><span class="sxs-lookup"><span data-stu-id="147dc-335">Checking that property value assignments are made correctly.</span></span>

<span data-ttu-id="147dc-336">Este grupo de pruebas suele simular los métodos de DAL para generar los datos esperados en el paso de acción, en el que un método de modelo de página se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="147dc-336">This group of tests often mock the methods of the DAL to produce expected data for the Act step where a page model method is executed.</span></span> <span data-ttu-id="147dc-337">Por ejemplo, el método `GetMessagesAsync` de `AppDbContext` se simula para generar una salida.</span><span class="sxs-lookup"><span data-stu-id="147dc-337">For example, the `GetMessagesAsync` method of the `AppDbContext` is mocked to produce output.</span></span> <span data-ttu-id="147dc-338">Cuando un método de modelo de página ejecuta este método, la simulación devuelve el resultado.</span><span class="sxs-lookup"><span data-stu-id="147dc-338">When a page model method executes this method, the mock returns the result.</span></span> <span data-ttu-id="147dc-339">Los datos no provienen de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="147dc-339">The data doesn't come from the database.</span></span> <span data-ttu-id="147dc-340">Esto crea condiciones de prueba de confianza y confiables para usar la DAL en las pruebas del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="147dc-340">This creates predictable, reliable test conditions for using the DAL in the page model tests.</span></span>

<span data-ttu-id="147dc-341">La prueba `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` muestra cómo se simula el método `GetMessagesAsync` para el modelo de página:</span><span class="sxs-lookup"><span data-stu-id="147dc-341">The `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` test shows how the `GetMessagesAsync` method is mocked for the page model:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet1&highlight=3-4)]

<span data-ttu-id="147dc-342">Cuando el método `OnGetAsync` se ejecuta en el paso de acción, llama al método `GetMessagesAsync` del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="147dc-342">When the `OnGetAsync` method is executed in the Act step, it calls the page model's `GetMessagesAsync` method.</span></span>

<span data-ttu-id="147dc-343">Paso de acción de prueba unitaria (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span><span class="sxs-lookup"><span data-stu-id="147dc-343">Unit test Act step (*tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet2)]

<span data-ttu-id="147dc-344">Método `OnGetAsync` del modelo de página `IndexPage` (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span><span class="sxs-lookup"><span data-stu-id="147dc-344">`IndexPage` page model's `OnGetAsync` method (*src/RazorPagesTestSample/Pages/Index.cshtml.cs*):</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/src/RazorPagesTestSample/Pages/Index.cshtml.cs?name=snippet1&highlight=3)]

<span data-ttu-id="147dc-345">El método `GetMessagesAsync` de la DAL no devuelve el resultado de esta llamada al método.</span><span class="sxs-lookup"><span data-stu-id="147dc-345">The `GetMessagesAsync` method in the DAL doesn't return the result for this method call.</span></span> <span data-ttu-id="147dc-346">La versión simulada del método devuelve el resultado.</span><span class="sxs-lookup"><span data-stu-id="147dc-346">The mocked version of the method returns the result.</span></span>

<span data-ttu-id="147dc-347">En el paso `Assert`, los mensajes reales (`actualMessages`) se asignan desde la propiedad `Messages` del modelo de página.</span><span class="sxs-lookup"><span data-stu-id="147dc-347">In the `Assert` step, the actual messages (`actualMessages`) are assigned from the `Messages` property of the page model.</span></span> <span data-ttu-id="147dc-348">También se realiza una comprobación de tipo cuando los mensajes se asignan.</span><span class="sxs-lookup"><span data-stu-id="147dc-348">A type check is also performed when the messages are assigned.</span></span> <span data-ttu-id="147dc-349">Las propiedades `Text` de los mensajes esperados y reales se comparan.</span><span class="sxs-lookup"><span data-stu-id="147dc-349">The expected and actual messages are compared by their `Text` properties.</span></span> <span data-ttu-id="147dc-350">La prueba afirma que las dos instancias de `List<Message>` contienen los mismos mensajes.</span><span class="sxs-lookup"><span data-stu-id="147dc-350">The test asserts that the two `List<Message>` instances contain the same messages.</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet3)]

<span data-ttu-id="147dc-351">Otras pruebas de este grupo crean objetos de modelo de página que incluyen <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>, <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, un elemento <xref:Microsoft.AspNetCore.Mvc.ActionContext> para establecer `PageContext`, un elemento `ViewDataDictionary` y un elemento `PageContext`.</span><span class="sxs-lookup"><span data-stu-id="147dc-351">Other tests in this group create page model objects that include the <xref:Microsoft.AspNetCore.Http.DefaultHttpContext>, the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary>, an <xref:Microsoft.AspNetCore.Mvc.ActionContext> to establish the `PageContext`, a `ViewDataDictionary`, and a `PageContext`.</span></span> <span data-ttu-id="147dc-352">Todos ellos resultan útiles para realizar pruebas.</span><span class="sxs-lookup"><span data-stu-id="147dc-352">These are useful in conducting tests.</span></span> <span data-ttu-id="147dc-353">Por ejemplo, la aplicación de mensajes establece un error de `ModelState` con <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> para comprobar si se devuelve un elemento <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> válido cuando `OnPostAddMessageAsync` se ejecuta:</span><span class="sxs-lookup"><span data-stu-id="147dc-353">For example, the message app establishes a `ModelState` error with <xref:Microsoft.AspNetCore.Mvc.ModelBinding.ModelStateDictionary.AddModelError*> to check that a valid <xref:Microsoft.AspNetCore.Mvc.RazorPages.PageResult> is returned when `OnPostAddMessageAsync` is executed:</span></span>

[!code-csharp[](razor-pages-tests/samples/2.x/tests/RazorPagesTestSample.Tests/UnitTests/IndexPageTests.cs?name=snippet4&highlight=11,26,29,32)]

## <a name="additional-resources"></a><span data-ttu-id="147dc-354">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="147dc-354">Additional resources</span></span>

* [<span data-ttu-id="147dc-355">Prueba unitaria de C# en .NET Core mediante pruebas de dotnet y xUnit</span><span class="sxs-lookup"><span data-stu-id="147dc-355">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* <xref:mvc/controllers/testing>
* <span data-ttu-id="147dc-356">[Prueba unitaria del código](/visualstudio/test/unit-test-your-code) (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="147dc-356">[Unit Test Your Code](/visualstudio/test/unit-test-your-code) (Visual Studio)</span></span>
* <xref:test/integration-tests>
* [<span data-ttu-id="147dc-357">xUnit.net</span><span class="sxs-lookup"><span data-stu-id="147dc-357">xUnit.net</span></span>](https://xunit.github.io/)
* [<span data-ttu-id="147dc-358">Creación de una solución completa de .NET Core en macOS con Visual Studio para Mac</span><span class="sxs-lookup"><span data-stu-id="147dc-358">Building a complete .NET Core solution on macOS using Visual Studio for Mac</span></span>](/dotnet/core/tutorials/using-on-mac-vs-full-solution)
* [<span data-ttu-id="147dc-359">Introducción a xUnit.net: Uso de .NET Core con la línea de comandos del SDK de .NET</span><span class="sxs-lookup"><span data-stu-id="147dc-359">Getting started with xUnit.net: Using .NET Core with the .NET SDK command line</span></span>](https://xunit.github.io/docs/getting-started-dotnet-core)
* [<span data-ttu-id="147dc-360">Moq</span><span class="sxs-lookup"><span data-stu-id="147dc-360">Moq</span></span>](https://github.com/moq/moq4)
* [<span data-ttu-id="147dc-361">Inicio rápido de Moq</span><span class="sxs-lookup"><span data-stu-id="147dc-361">Moq Quickstart</span></span>](https://github.com/Moq/moq4/wiki/Quickstart)
* <span data-ttu-id="147dc-362">[JustMockLite](https://github.com/telerik/JustMockLite): marco ficticio para desarrolladores de .NET.</span><span class="sxs-lookup"><span data-stu-id="147dc-362">[JustMockLite](https://github.com/telerik/JustMockLite): A mocking framework for .NET developers.</span></span> <span data-ttu-id="147dc-363">(*Microsoft no realiza su mantenimiento ni su soporte técnico.* )</span><span class="sxs-lookup"><span data-stu-id="147dc-363">(*Not maintained or supported by Microsoft.*)</span></span>

::: moniker-end
