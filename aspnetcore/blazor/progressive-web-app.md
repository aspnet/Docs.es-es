---
title: 'Creación de aplicaciones web progresivas con ASP.NET Core Blazor WebAssembly'
author: guardrex
description: 'Obtenga información sobre cómo compilar aplicaciones web progresivas (PWA) basadas en Blazor que usan características de exploradores modernos para comportarse como aplicaciones de escritorio.'
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 06/10/2020
no-loc:
- 'appsettings.json'
- 'ASP.NET Core Identity'
- 'cookie'
- 'Cookie'
- 'Blazor'
- 'Blazor Server'
- 'Blazor WebAssembly'
- 'Identity'
- "Let's Encrypt"
- 'Razor'
- 'SignalR'
uid: blazor/progressive-web-app
ms.openlocfilehash: c8ff2fc0f2f4d4e75f535f379ec94ea9de2e3ecb
ms.sourcegitcommit: ca34c1ac578e7d3daa0febf1810ba5fc74f60bbf
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 10/30/2020
ms.locfileid: "93055703"
---
# <a name="build-progressive-web-applications-with-aspnet-core-no-locblazor-webassembly"></a><span data-ttu-id="bd61c-103">Creación de aplicaciones web progresivas con ASP.NET Core Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="bd61c-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="bd61c-104">Por [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="bd61c-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

<span data-ttu-id="bd61c-105">Una aplicación web progresiva suele ser una aplicación de página única que usa las API y funciones de exploradores modernos para comportarse como una aplicación de escritorio.</span><span class="sxs-lookup"><span data-stu-id="bd61c-105">A Progressive Web Application (PWA) is usually a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> <span data-ttu-id="bd61c-106">Blazor WebAssembly es una plataforma de aplicaciones web del lado cliente basada en estándares, por lo que puede usar cualquier API de explorador, incluidas las de PWA necesarias para las siguientes funcionalidades:</span><span class="sxs-lookup"><span data-stu-id="bd61c-106">Blazor WebAssembly is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="bd61c-107">Trabajo sin conexión y carga instantánea, con independencia de la velocidad de la red.</span><span class="sxs-lookup"><span data-stu-id="bd61c-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="bd61c-108">Ejecución en una ventana de aplicación propia, no solo en una ventana del explorador.</span><span class="sxs-lookup"><span data-stu-id="bd61c-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="bd61c-109">Apertura desde el menú de inicio del sistema operativo host o la pantalla principal.</span><span class="sxs-lookup"><span data-stu-id="bd61c-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="bd61c-110">Recepción de notificaciones push desde un servidor back-end, incluso cuando el usuario no utiliza la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="bd61c-111">Actualización automática en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="bd61c-111">Automatically updating in the background.</span></span>

<span data-ttu-id="bd61c-112">La palabra *progresiva* se usa para describir estas aplicaciones porque:</span><span class="sxs-lookup"><span data-stu-id="bd61c-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="bd61c-113">Es posible que un usuario detecte primero la aplicación y la use en su explorador web como cualquier otra SPA.</span><span class="sxs-lookup"><span data-stu-id="bd61c-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="bd61c-114">Más adelante, el usuario pasa a instalarla en su sistema operativo y a habilitar las notificaciones push.</span><span class="sxs-lookup"><span data-stu-id="bd61c-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="bd61c-115">Creación de un proyecto a partir de la plantilla de PWA</span><span class="sxs-lookup"><span data-stu-id="bd61c-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="bd61c-116">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="bd61c-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="bd61c-117">Al crear una **aplicación Blazor WebAssembly** en el cuadro de diálogo **Crear un nuevo proyecto** , active la casilla **Aplicación web progresiva** :</span><span class="sxs-lookup"><span data-stu-id="bd61c-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progressive Web Application** check box:</span></span>

![La casilla "Aplicación web progresiva" está activada en el cuadro de diálogo Nuevo proyecto de Visual Studio.](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="bd61c-119">Visual Studio Code y CLI de .NET Core</span><span class="sxs-lookup"><span data-stu-id="bd61c-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="bd61c-120">Cree un proyecto de PWA en un shell de comandos con el modificador `--pwa`:</span><span class="sxs-lookup"><span data-stu-id="bd61c-120">Create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyNewProject --pwa
```

---

<span data-ttu-id="bd61c-121">Opcionalmente, PWA se puede configurar para una aplicación creada a partir de la plantilla ASP.NET Core hospedado.</span><span class="sxs-lookup"><span data-stu-id="bd61c-121">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="bd61c-122">El escenario de PWA es independiente del modelo de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="bd61c-122">The PWA scenario is independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="bd61c-123">Instalación y manifiesto de la aplicación</span><span class="sxs-lookup"><span data-stu-id="bd61c-123">Installation and app manifest</span></span>

<span data-ttu-id="bd61c-124">Al visitar una aplicación creada con la plantilla PWA, los usuarios tienen la opción de instalar la aplicación en el menú de inicio o la pantalla principal de su sistema operativo, o bien mediante el acoplamiento.</span><span class="sxs-lookup"><span data-stu-id="bd61c-124">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="bd61c-125">La forma en la que se presenta esta opción depende del explorador del usuario.</span><span class="sxs-lookup"><span data-stu-id="bd61c-125">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="bd61c-126">Al usar exploradores basados en Chromium de escritorio, como Edge o Chrome, aparece un botón **Agregar** en la barra de direcciones URL.</span><span class="sxs-lookup"><span data-stu-id="bd61c-126">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="bd61c-127">Después de que el usuario seleccione el botón **Agregar** , recibirá un cuadro de diálogo de confirmación:</span><span class="sxs-lookup"><span data-stu-id="bd61c-127">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![El cuadro de diálogo de confirmación en Google Chrome presenta al usuario un botón Instalar para la aplicación "MyBlazorPwa".](progressive-web-app/_static/image2.png)

<span data-ttu-id="bd61c-129">En iOS, los visitantes pueden instalar la PWA mediante el botón **Compartir** de Safari y la opción que permite la **adición a la pantalla de inicio**.</span><span class="sxs-lookup"><span data-stu-id="bd61c-129">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="bd61c-130">En Chrome para Android, los usuarios deben seleccionar el botón **Menú** en la esquina superior derecha y, después, **Agregar a la pantalla principal**.</span><span class="sxs-lookup"><span data-stu-id="bd61c-130">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="bd61c-131">Una vez instalada, la aplicación aparece en una ventana propia, sin ninguna barra de direcciones:</span><span class="sxs-lookup"><span data-stu-id="bd61c-131">Once installed, the app appears in its own window without an address bar:</span></span>

![La aplicación "MyBlazorPwa" se ejecuta en Google Chrome sin una barra de direcciones.](progressive-web-app/_static/image3.png)

<span data-ttu-id="bd61c-133">Para personalizar el título, la combinación de colores, el icono u otros detalles de la ventana, vea el archivo `manifest.json` del directorio `wwwroot` del proyecto.</span><span class="sxs-lookup"><span data-stu-id="bd61c-133">To customize the window's title, color scheme, icon, or other details, see the `manifest.json` file in the project's `wwwroot` directory.</span></span> <span data-ttu-id="bd61c-134">El esquema de este archivo se define mediante los estándares web.</span><span class="sxs-lookup"><span data-stu-id="bd61c-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="bd61c-135">Para obtener más información, vea [Documentación web de MDN: Manifiesto de aplicación web](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="bd61c-135">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="bd61c-136">Compatibilidad sin conexión</span><span class="sxs-lookup"><span data-stu-id="bd61c-136">Offline support</span></span>

<span data-ttu-id="bd61c-137">De forma predeterminada, las aplicaciones creadas mediante la plantilla PWA tienen compatibilidad para ejecutarse sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-137">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="bd61c-138">Un usuario debe visitar primero la aplicación mientras está en línea.</span><span class="sxs-lookup"><span data-stu-id="bd61c-138">A user must first visit the app while they're online.</span></span> <span data-ttu-id="bd61c-139">El explorador descarga automáticamente y almacena en caché todos los recursos necesarios para trabajar sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-139">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bd61c-140">La compatibilidad con el desarrollo interferiría con el ciclo de desarrollo habitual de realización y prueba de los cambios.</span><span class="sxs-lookup"><span data-stu-id="bd61c-140">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="bd61c-141">Por tanto, la compatibilidad sin conexión solo está habilitada para las aplicaciones *publicadas*.</span><span class="sxs-lookup"><span data-stu-id="bd61c-141">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="bd61c-142">Si tiene previsto distribuir una PWA habilitada para su uso sin conexión, hay [varias advertencias importantes](#caveats-for-offline-pwas).</span><span class="sxs-lookup"><span data-stu-id="bd61c-142">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="bd61c-143">Estos escenarios son propios de la PWA sin conexión y no específicos de Blazor.</span><span class="sxs-lookup"><span data-stu-id="bd61c-143">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="bd61c-144">Asegúrese de leer y comprender estas advertencias antes de realizar suposiciones sobre cómo funcionará la aplicación habilitada para su uso sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="bd61c-145">Para ver cómo funciona la compatibilidad sin conexión:</span><span class="sxs-lookup"><span data-stu-id="bd61c-145">To see how offline support works:</span></span>

1. <span data-ttu-id="bd61c-146">Publique la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-146">Publish the app.</span></span> <span data-ttu-id="bd61c-147">Para obtener más información, vea <xref:blazor/host-and-deploy/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="bd61c-147">For more information, see <xref:blazor/host-and-deploy/index#publish-the-app>.</span></span>
1. <span data-ttu-id="bd61c-148">Implemente la aplicación en un servidor que admita HTTPS y acceda a la aplicación en un explorador mediante su dirección HTTPS segura.</span><span class="sxs-lookup"><span data-stu-id="bd61c-148">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="bd61c-149">Abra las herramientas de desarrollo del explorador y, en la pestaña **Aplicación** , compruebe que se ha registrado un *trabajo de servicio* para el host:</span><span class="sxs-lookup"><span data-stu-id="bd61c-149">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![En la pestaña "Aplicación" de las herramientas para desarrolladores de Google Chrome se muestra un trabajo de servicio activado y en ejecución.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="bd61c-151">Vuelva a cargar la página y examine la pestaña **Red**. **Trabajo de servicio** o **caché de memoria** se muestran como orígenes de todos los recursos de la página:</span><span class="sxs-lookup"><span data-stu-id="bd61c-151">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![Pestaña "Red" de las herramientas para desarrolladores de Google Chrome en la que se muestran los orígenes de todos los recursos de la página.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="bd61c-153">Para comprobar que el explorador no depende del acceso a la red para cargar la aplicación, puede:</span><span class="sxs-lookup"><span data-stu-id="bd61c-153">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="bd61c-154">Apagar el servidor web y ver cómo la aplicación continúa funcionando con normalidad, lo que incluye las recargas de páginas.</span><span class="sxs-lookup"><span data-stu-id="bd61c-154">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="bd61c-155">Del mismo modo, la aplicación sigue funcionando con normalidad cuando hay una conexión de red lenta.</span><span class="sxs-lookup"><span data-stu-id="bd61c-155">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="bd61c-156">Indicar al explorador que simule el modo sin conexión en la pestaña **Red** :</span><span class="sxs-lookup"><span data-stu-id="bd61c-156">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![Pestaña "Red" de las herramientas para desarrolladores de Google Chrome con el cambio de "En línea" a "Sin conexión" en la lista desplegable del modo de explorador.](progressive-web-app/_static/image6.png)

<span data-ttu-id="bd61c-158">La compatibilidad sin conexión mediante un trabajo de servicio es un estándar web, no específico de Blazor.</span><span class="sxs-lookup"><span data-stu-id="bd61c-158">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="bd61c-159">Para obtener más información sobre los trabajo de servicio, vea [Documentación web de MDN: API de trabajo de servicio](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="bd61c-159">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="bd61c-160">Para obtener más información sobre los patrones de uso comunes de los trabajos de servicio, vea [Google Web: El ciclo de vida del trabajo de servicio](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="bd61c-160">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

<span data-ttu-id="bd61c-161">La plantilla de PWA de Blazor genera dos archivos de trabajo de servicio:</span><span class="sxs-lookup"><span data-stu-id="bd61c-161">Blazor's PWA template produces two service worker files:</span></span>

* <span data-ttu-id="bd61c-162">`wwwroot/service-worker.js`, que se usa durante el desarrollo.</span><span class="sxs-lookup"><span data-stu-id="bd61c-162">`wwwroot/service-worker.js`, which is used during development.</span></span>
* <span data-ttu-id="bd61c-163">`wwwroot/service-worker.published.js`, que se usa después de publicar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-163">`wwwroot/service-worker.published.js`, which is used after the app is published.</span></span>

<span data-ttu-id="bd61c-164">Para compartir la lógica entre los dos archivos de trabajo de servicio, tenga en cuenta el enfoque siguiente:</span><span class="sxs-lookup"><span data-stu-id="bd61c-164">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="bd61c-165">Agregue un tercer archivo de JavaScript para contener la lógica común.</span><span class="sxs-lookup"><span data-stu-id="bd61c-165">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="bd61c-166">Use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) para cargar la lógica común en los dos archivos de trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="bd61c-166">Use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="bd61c-167">Estrategia de captura desde la caché</span><span class="sxs-lookup"><span data-stu-id="bd61c-167">Cache-first fetch strategy</span></span>

<span data-ttu-id="bd61c-168">El servicio de trabajo integrado `service-worker.published.js` resuelve las solicitudes mediante una estrategia *desde la caché*.</span><span class="sxs-lookup"><span data-stu-id="bd61c-168">The built-in `service-worker.published.js` service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="bd61c-169">Esto significa que el trabajo de servicio prefiere devolver el contenido almacenado en caché, con independencia de si el usuario tiene acceso de red o de si hay contenido más reciente disponible en el servidor.</span><span class="sxs-lookup"><span data-stu-id="bd61c-169">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="bd61c-170">La estrategia de almacenar primero en caché es valiosa porque:</span><span class="sxs-lookup"><span data-stu-id="bd61c-170">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="bd61c-171">**Garantiza la confiabilidad.**</span><span class="sxs-lookup"><span data-stu-id="bd61c-171">**It ensures reliability.**</span></span> <span data-ttu-id="bd61c-172">El acceso a la red no es un estado booleano.</span><span class="sxs-lookup"><span data-stu-id="bd61c-172">Network access isn't a boolean state.</span></span> <span data-ttu-id="bd61c-173">Un usuario no está simplemente en línea o sin conexión:</span><span class="sxs-lookup"><span data-stu-id="bd61c-173">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="bd61c-174">El dispositivo del usuario puede asumir que está en línea, pero es posible que la red sea tan lenta que no sea factible esperar.</span><span class="sxs-lookup"><span data-stu-id="bd61c-174">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="bd61c-175">Es posible que la red devuelva resultados no válidos para ciertas direcciones URL, como cuando hay un portal Wi-Fi cautivo que bloquea o redirige determinadas solicitudes.</span><span class="sxs-lookup"><span data-stu-id="bd61c-175">The network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="bd61c-176">Por este motivo la API `navigator.onLine` del explorador no es confiable y no se debe depender de ella.</span><span class="sxs-lookup"><span data-stu-id="bd61c-176">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="bd61c-177">**Garantiza la corrección.**</span><span class="sxs-lookup"><span data-stu-id="bd61c-177">**It ensures correctness.**</span></span> <span data-ttu-id="bd61c-178">Al compilar una memoria caché de recursos sin conexión, el trabajo de servicio usa el hash de contenido para garantizar que ha capturado una instantánea completa y autocoherente de los recursos en un solo instante en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="bd61c-178">When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="bd61c-179">Después, esta caché se utiliza como unidad atómica.</span><span class="sxs-lookup"><span data-stu-id="bd61c-179">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="bd61c-180">No tiene sentido solicitar a la red recursos más recientes, ya que las únicas versiones necesarias son las que ya se han almacenado en caché.</span><span class="sxs-lookup"><span data-stu-id="bd61c-180">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="bd61c-181">Todo lo demás implica riesgos de incoherencia e incompatibilidad (por ejemplo, intentar usar versiones de ensamblados .NET que no se han compilado de forma conjunta).</span><span class="sxs-lookup"><span data-stu-id="bd61c-181">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="bd61c-182">Actualizaciones en segundo plano</span><span class="sxs-lookup"><span data-stu-id="bd61c-182">Background updates</span></span>

<span data-ttu-id="bd61c-183">Como modelo mental, puede pensar que una PWA primero sin conexión se comporta como una aplicación móvil que se puede instalar.</span><span class="sxs-lookup"><span data-stu-id="bd61c-183">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="bd61c-184">La aplicación se inicia inmediatamente, con independencia de la conectividad de la red, pero la lógica de la aplicación instalada procede de una instantánea de un momento dado que podría no ser la versión más reciente.</span><span class="sxs-lookup"><span data-stu-id="bd61c-184">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="bd61c-185">La plantilla de PWA Blazor genera aplicaciones que intentan actualizarse de forma automática en segundo plano cada vez que el usuario realiza una visita y tiene una conexión de red operativa.</span><span class="sxs-lookup"><span data-stu-id="bd61c-185">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="bd61c-186">Así es como funciona:</span><span class="sxs-lookup"><span data-stu-id="bd61c-186">The way this works is as follows:</span></span>

* <span data-ttu-id="bd61c-187">Durante la compilación, el proyecto genera un *manifiesto de recursos de trabajo de servicio*.</span><span class="sxs-lookup"><span data-stu-id="bd61c-187">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="bd61c-188">De forma predeterminada, se denomina `service-worker-assets.js`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-188">By default, this is called `service-worker-assets.js`.</span></span> <span data-ttu-id="bd61c-189">En el manifiesto se enumeran todos los recursos estáticos que la aplicación necesita para funcionar sin conexión, como los ensamblados .NET, los archivos JavaScript y CSS, incluidos sus hash de contenido.</span><span class="sxs-lookup"><span data-stu-id="bd61c-189">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="bd61c-190">Esta lista la carga el trabajo de servicio para saber qué recursos almacenar en la caché.</span><span class="sxs-lookup"><span data-stu-id="bd61c-190">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="bd61c-191">Cada vez que el usuario visita la aplicación, el explorador vuelve a solicitar `service-worker.js` y `service-worker-assets.js` en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="bd61c-191">Each time the user visits the app, the browser re-requests `service-worker.js` and `service-worker-assets.js` in the background.</span></span> <span data-ttu-id="bd61c-192">Los archivos se comparan byte a byte con el trabajo de servicio instalado existente.</span><span class="sxs-lookup"><span data-stu-id="bd61c-192">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="bd61c-193">Si el servidor devuelve contenido cambiado para cualquiera de estos archivos, el trabajo de servicio intenta instalar una nueva versión de sí mismo.</span><span class="sxs-lookup"><span data-stu-id="bd61c-193">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="bd61c-194">Al instalar una versión nueva de sí mismo, el trabajo de servicio crea una caché independiente para los recursos sin conexión y comienza a rellenarla con los recursos enumerados en `service-worker-assets.js`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-194">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in `service-worker-assets.js`.</span></span> <span data-ttu-id="bd61c-195">Esta lógica se implementa en la función `onInstall` dentro de `service-worker.published.js`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-195">This logic is implemented in the `onInstall` function inside `service-worker.published.js`.</span></span>
* <span data-ttu-id="bd61c-196">El proceso se completa correctamente cuando todos los recursos se cargan sin errores y todos los hashes de contenido coinciden.</span><span class="sxs-lookup"><span data-stu-id="bd61c-196">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="bd61c-197">Si se realiza correctamente, el nuevo trabajo de servicio entra en un estado de *espera de la activación*.</span><span class="sxs-lookup"><span data-stu-id="bd61c-197">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="bd61c-198">En cuanto el usuario cierra la aplicación (no quedan pestañas de aplicación ni ventanas), el nuevo trabajo de servicio se *activa* y se usa para las posteriores visitas a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-198">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="bd61c-199">El trabajo de servicio anterior y su memoria caché se eliminan.</span><span class="sxs-lookup"><span data-stu-id="bd61c-199">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="bd61c-200">Si el proceso no se completa correctamente, se descarta la nueva instancia del trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="bd61c-200">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="bd61c-201">El proceso de actualización se vuelve a intentar en la próxima visita del usuario; con suerte, tendrá una mejor conexión de red que permita completar las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="bd61c-201">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="bd61c-202">Para personalizar este proceso, modifique la lógica del trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="bd61c-202">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="bd61c-203">Ninguno de los comportamientos anteriores es específico de Blazor; simplemente es la experiencia predeterminada proporcionada por la opción de plantilla de PWA.</span><span class="sxs-lookup"><span data-stu-id="bd61c-203">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="bd61c-204">Para obtener más información, vea [Documentación web de MDN: API de trabajo de servicio](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="bd61c-204">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="bd61c-205">Procedimientos para resolver las solicitudes</span><span class="sxs-lookup"><span data-stu-id="bd61c-205">How requests are resolved</span></span>

<span data-ttu-id="bd61c-206">Como se ha descrito en la sección [Estrategia de captura desde la caché](#cache-first-fetch-strategy), el trabajo de servicio predeterminado usa una estrategia *desde la caché* , lo que significa que intenta servir contenido almacenado en caché cuando esté disponible.</span><span class="sxs-lookup"><span data-stu-id="bd61c-206">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="bd61c-207">Si no hay contenido en caché para una dirección URL determinada (por ejemplo, cuando se solicitan datos de una API de back-end), el trabajo de servicio recurre a una solicitud de red normal.</span><span class="sxs-lookup"><span data-stu-id="bd61c-207">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="bd61c-208">La solicitud de red se realiza correctamente si se puede acceder al servidor.</span><span class="sxs-lookup"><span data-stu-id="bd61c-208">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="bd61c-209">Esta lógica se implementa dentro de la función `onFetch` en `service-worker.published.js`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-209">This logic is implemented inside `onFetch` function within `service-worker.published.js`.</span></span>

<span data-ttu-id="bd61c-210">Si los componentes de Razor de la aplicación dependen de la solicitud de datos a las API de back-end y quiere proporcionar una experiencia de usuario sencilla para las solicitudes erróneas por falta de disponibilidad de la red, implemente lógica en los componentes de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-210">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="bd61c-211">Por ejemplo, use solicitudes `try/catch` en torno a <xref:System.Net.Http.HttpClient>.</span><span class="sxs-lookup"><span data-stu-id="bd61c-211">For example, use `try/catch` around <xref:System.Net.Http.HttpClient> requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="bd61c-212">Compatibilidad de las páginas representadas por el servidor</span><span class="sxs-lookup"><span data-stu-id="bd61c-212">Support server-rendered pages</span></span>

<span data-ttu-id="bd61c-213">Tenga en cuenta lo que sucede cuando el usuario navega por primera vez a una dirección URL como `/counter` o cualquier otro vínculo profundo de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-213">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="bd61c-214">En estos casos, no le interesa devolver el contenido en caché como `/counter`, sino que necesita que el explorador cargue el contenido en caché como `/index.html` para iniciar la aplicación Blazor WebAssembly.</span><span class="sxs-lookup"><span data-stu-id="bd61c-214">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="bd61c-215">Estas solicitudes iniciales se conocen como solicitudes de *navegación* , en lugar de:</span><span class="sxs-lookup"><span data-stu-id="bd61c-215">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="bd61c-216">Solicitudes de `subresource` para imágenes, hojas de estilo u otros archivos.</span><span class="sxs-lookup"><span data-stu-id="bd61c-216">`subresource` requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="bd61c-217">Solicitudes de `fetch/XHR` para datos de API.</span><span class="sxs-lookup"><span data-stu-id="bd61c-217">`fetch/XHR` requests for API data.</span></span>

<span data-ttu-id="bd61c-218">El trabajo de servicio predeterminado contiene lógica de casos especiales para las solicitudes de navegación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-218">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="bd61c-219">Para resolver las solicitudes, el trabajo de servicio devuelve el contenido en caché para `/index.html`, independientemente de la dirección URL solicitada.</span><span class="sxs-lookup"><span data-stu-id="bd61c-219">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="bd61c-220">Esta lógica se implementa en la función `onFetch` dentro de `service-worker.published.js`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-220">This logic is implemented in the `onFetch` function inside `service-worker.published.js`.</span></span>

<span data-ttu-id="bd61c-221">Si la aplicación tiene determinadas direcciones URL que deben devolver el código HTML representado por el servidor (y no servir `/index.html` desde la caché), tendrá que editar la lógica en el trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="bd61c-221">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="bd61c-222">Si todas las direcciones URL que contienen `/Identity/` se deben controlar como solicitudes normales solo en línea en el servidor, modifique la lógica `onFetch` de `service-worker.published.js`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-222">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify `service-worker.published.js` `onFetch` logic.</span></span> <span data-ttu-id="bd61c-223">Busque el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="bd61c-223">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="bd61c-224">Cambie el código por lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="bd61c-224">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="bd61c-225">Si no lo hace, independientemente de la conectividad de red, el trabajo de servicio intercepta las solicitudes de esas direcciones URL y las resuelve mediante `/index.html`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-225">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="bd61c-226">Control del almacenamiento en caché de recursos</span><span class="sxs-lookup"><span data-stu-id="bd61c-226">Control asset caching</span></span>

<span data-ttu-id="bd61c-227">Si el proyecto define la propiedad `ServiceWorkerAssetsManifest` de MSBuild, las herramientas de compilación de Blazor generan un manifiesto de recursos de trabajo de servicio con el nombre especificado.</span><span class="sxs-lookup"><span data-stu-id="bd61c-227">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="bd61c-228">La plantilla de PWA predeterminada produce un archivo de proyecto que contiene la propiedad siguiente:</span><span class="sxs-lookup"><span data-stu-id="bd61c-228">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="bd61c-229">El archivo se coloca en el directorio de salida `wwwroot`, por lo que el explorador puede recuperar este archivo solicitando `/service-worker-assets.js`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-229">The file is placed in the `wwwroot` output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="bd61c-230">Para ver el contenido de este archivo, abra `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` en un editor de texto.</span><span class="sxs-lookup"><span data-stu-id="bd61c-230">To see the contents of this file, open `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` in a text editor.</span></span> <span data-ttu-id="bd61c-231">Pero no edite el archivo, ya que se vuelve a generar en cada compilación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-231">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="bd61c-232">De forma predeterminada, este manifiesto muestra:</span><span class="sxs-lookup"><span data-stu-id="bd61c-232">By default, this manifest lists:</span></span>

* <span data-ttu-id="bd61c-233">Los recursos administrados por Blazor, como los ensamblados .NET y los archivos de runtime de WebAssembly .NET necesarios para funcionar sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-233">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="bd61c-234">Todos los recursos para publicar contenido en el directorio `wwwroot` de la aplicación, como imágenes, hojas de estilos y archivos JavaScript, incluidos los recursos web estáticos proporcionados por los proyectos externos y los paquetes NuGet.</span><span class="sxs-lookup"><span data-stu-id="bd61c-234">All resources for publishing to the app's `wwwroot` directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="bd61c-235">Puede controlar cuál de estos recursos captura y almacena en caché el trabajo de servicio mediante la edición de la lógica `onInstall` en `service-worker.published.js`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-235">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in `service-worker.published.js`.</span></span> <span data-ttu-id="bd61c-236">De forma predeterminada, el trabajo de servicio captura y almacena en caché los archivos que coinciden con las extensiones de nombre de archivo web típicas, como `.html`, `.css`, `.js` y `.wasm`, además de tipos de archivo específicos de Blazor WebAssembly (`.dll`, `.pdb`).</span><span class="sxs-lookup"><span data-stu-id="bd61c-236">By default, the service worker fetches and caches files matching typical web filename extensions such as `.html`, `.css`, `.js`, and `.wasm`, plus file types specific to Blazor WebAssembly (`.dll`, `.pdb`).</span></span>

<span data-ttu-id="bd61c-237">Para incluir recursos adicionales que no están presentes en el directorio `wwwroot` de la aplicación, defina entradas `ItemGroup` de MSBuild adicionales, como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="bd61c-237">To include additional resources that aren't present in the app's `wwwroot` directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="bd61c-238">Los metadatos de `AssetUrl` especifican la dirección URL de base relativa que debe usar el explorador al capturar el recurso en la memoria caché.</span><span class="sxs-lookup"><span data-stu-id="bd61c-238">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="bd61c-239">Puede ser independiente del nombre del archivo de origen en el disco.</span><span class="sxs-lookup"><span data-stu-id="bd61c-239">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bd61c-240">Agregar un elemento `ServiceWorkerAssetsManifestItem` no hace que el archivo se publique en el directorio `wwwroot` de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-240">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's `wwwroot` directory.</span></span> <span data-ttu-id="bd61c-241">La salida de la publicación se debe controlar por separado.</span><span class="sxs-lookup"><span data-stu-id="bd61c-241">The publish output must be controlled separately.</span></span> <span data-ttu-id="bd61c-242">El elemento `ServiceWorkerAssetsManifestItem` solo hace que aparezca una entrada adicional en el manifiesto de recursos de trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="bd61c-242">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="bd61c-243">Notificaciones de inserción</span><span class="sxs-lookup"><span data-stu-id="bd61c-243">Push notifications</span></span>

<span data-ttu-id="bd61c-244">Al igual que cualquier otra PWA, una PWA Blazor WebAssembly puede recibir notificaciones de inserción de un servidor back-end.</span><span class="sxs-lookup"><span data-stu-id="bd61c-244">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="bd61c-245">El servidor puede enviar notificaciones push en cualquier momento, incluso cuando el usuario no utiliza la aplicación de forma activa.</span><span class="sxs-lookup"><span data-stu-id="bd61c-245">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="bd61c-246">Por ejemplo, se pueden enviar notificaciones push cuando otro usuario realiza una acción pertinente.</span><span class="sxs-lookup"><span data-stu-id="bd61c-246">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="bd61c-247">El mecanismo para enviar una notificación de inserción es totalmente independiente de Blazor WebAssembly, ya que lo implementa el servidor back-end, que puede usar cualquier tecnología.</span><span class="sxs-lookup"><span data-stu-id="bd61c-247">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="bd61c-248">Si quiere enviar notificaciones push desde un servidor de ASP.NET Core, considere la posibilidad de [usar una técnica similar al enfoque adoptado en el taller de Blazing Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="bd61c-248">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="bd61c-249">El mecanismo para recibir y mostrar una notificación de inserción en el cliente también es independiente de Blazor WebAssembly, ya que se implementa en el archivo JavaScript del trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="bd61c-249">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="bd61c-250">Para obtener un ejemplo, vea el [enfoque que se usa en el taller de Blazing Pizza](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="bd61c-250">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="bd61c-251">Advertencias de PWA sin conexión</span><span class="sxs-lookup"><span data-stu-id="bd61c-251">Caveats for offline PWAs</span></span>

<span data-ttu-id="bd61c-252">No todas las aplicaciones deben intentar admitir el uso sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-252">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="bd61c-253">La compatibilidad sin conexión agrega una complejidad significativa, aunque no siempre es pertinente para los casos de uso necesarios.</span><span class="sxs-lookup"><span data-stu-id="bd61c-253">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="bd61c-254">La compatibilidad sin conexión normalmente solo es pertinente:</span><span class="sxs-lookup"><span data-stu-id="bd61c-254">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="bd61c-255">Si el almacén de datos principal es local para el explorador.</span><span class="sxs-lookup"><span data-stu-id="bd61c-255">If the primary data store is local to the browser.</span></span> <span data-ttu-id="bd61c-256">Por ejemplo, el enfoque es relevante en una aplicación con una interfaz de usuario para un dispositivo [IoT](https://en.wikipedia.org/wiki/Internet_of_things) que almacena datos en `localStorage` o [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="bd61c-256">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="bd61c-257">Si la aplicación realiza un trabajo significativo para capturar y almacenar en caché los datos de la API de back-end pertinentes para cada usuario, para que puedan desplazarse por ellos sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-257">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="bd61c-258">Si la aplicación admite la edición, se tendrá que crear un sistema para realizar el seguimiento de los cambios y sincronizar datos con el back-end.</span><span class="sxs-lookup"><span data-stu-id="bd61c-258">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="bd61c-259">Si el objetivo es garantizar que la aplicación se cargue de forma inmediata, independientemente de las condiciones de la red.</span><span class="sxs-lookup"><span data-stu-id="bd61c-259">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="bd61c-260">Implemente una experiencia de usuario adecuada en torno a las solicitudes de API de back-end para mostrar el progreso de las solicitudes y comportarse correctamente cuando se produzca un error en las solicitudes debido a la falta de disponibilidad de la red.</span><span class="sxs-lookup"><span data-stu-id="bd61c-260">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="bd61c-261">Además, las PWA con capacidad sin conexión deben tratar con una gran variedad de complicaciones adicionales.</span><span class="sxs-lookup"><span data-stu-id="bd61c-261">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="bd61c-262">Los desarrolladores se deben familiarizar cuidadosamente con las advertencias de las secciones siguientes.</span><span class="sxs-lookup"><span data-stu-id="bd61c-262">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="bd61c-263">Compatibilidad sin conexión solo al realizar la publicación</span><span class="sxs-lookup"><span data-stu-id="bd61c-263">Offline support only when published</span></span>

<span data-ttu-id="bd61c-264">Durante el desarrollo, normalmente le interesará ver cada cambio reflejado inmediatamente en el explorador, sin pasar por un proceso de actualización en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="bd61c-264">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="bd61c-265">Por tanto, la plantilla de PWA de Blazor solo habilita la compatibilidad sin conexión cuando se publica.</span><span class="sxs-lookup"><span data-stu-id="bd61c-265">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="bd61c-266">Al compilar una aplicación compatible sin conexión, no basta con probarla en el entorno de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="bd61c-266">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="bd61c-267">Tendrá que probar la aplicación en su estado publicado para entender cómo responde a otras condiciones de red.</span><span class="sxs-lookup"><span data-stu-id="bd61c-267">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="bd61c-268">Finalización de la actualización tras la navegación del usuario fuera de la aplicación</span><span class="sxs-lookup"><span data-stu-id="bd61c-268">Update completion after user navigation away from app</span></span>

<span data-ttu-id="bd61c-269">Las actualizaciones no se completan hasta que el usuario haya navegado fuera de la aplicación en todas las pestañas.</span><span class="sxs-lookup"><span data-stu-id="bd61c-269">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="bd61c-270">Como se ha explicado en la sección [Actualizaciones en segundo plano](#background-updates), después de implementar una actualización en la aplicación, el explorador captura los archivos de trabajo de servicio actualizados para comenzar el proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="bd61c-270">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="bd61c-271">Lo que sorprende a muchos desarrolladores es que, incluso cuando se completa esta actualización, **no** surtirá efecto hasta que el usuario haya navegado fuera de todas las pestañas.</span><span class="sxs-lookup"><span data-stu-id="bd61c-271">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="bd61c-272">**No** basta con actualizar la pestaña en la que se muestra la aplicación, incluso si es la única.</span><span class="sxs-lookup"><span data-stu-id="bd61c-272">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="bd61c-273">Hasta que la aplicación se cierre por completo, el nuevo trabajo de servicio permanece en el estado *en espera de activación*.</span><span class="sxs-lookup"><span data-stu-id="bd61c-273">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="bd61c-274">**Esto no es específico de Blazor, sino que es un comportamiento estándar de la plataforma web.**</span><span class="sxs-lookup"><span data-stu-id="bd61c-274">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="bd61c-275">Habitualmente, esto trae problemas a los desarrolladores que intentan probar las actualizaciones de su trabajo de servicio o de los recursos almacenados en la caché sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-275">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="bd61c-276">Si inserta en el repositorio las herramientas para desarrolladores del explorador, puede ver algo parecido a lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="bd61c-276">If you check in the browser's developer tools, you may see something like the following:</span></span>

![La pestaña "Aplicación" de Google Chrome en la que se muestra que el trabajo de servicio de la aplicación está en "espera de activarse".](progressive-web-app/_static/image7.png)

<span data-ttu-id="bd61c-278">Mientras la lista de "clientes" (las pestañas o ventanas en las que se muestra la aplicación) no esté vacía, el trabajo sigue en espera.</span><span class="sxs-lookup"><span data-stu-id="bd61c-278">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="bd61c-279">Los trabajos de servicio hacen esto para garantizar la coherencia.</span><span class="sxs-lookup"><span data-stu-id="bd61c-279">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="bd61c-280">La coherencia significa que todos los recursos se capturan de la misma caché atómica.</span><span class="sxs-lookup"><span data-stu-id="bd61c-280">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="bd61c-281">Al probar los cambios, puede que le resulte conveniente hacer clic en el vínculo "skipWaiting", como se muestra en la captura de pantalla anterior, y después volver a cargar la página.</span><span class="sxs-lookup"><span data-stu-id="bd61c-281">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="bd61c-282">Puede automatizar este proceso para todos los usuarios si codifica el trabajo de servicio para [omitir la fase de "espera" y activarlo inmediatamente al actualizar](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="bd61c-282">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="bd61c-283">Si lo hace, ya no tendrá la garantía de que los recursos siempre se capturen de forma coherente desde la misma instancia de la caché.</span><span class="sxs-lookup"><span data-stu-id="bd61c-283">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="bd61c-284">Posibilidad para los usuarios de ejecutar cualquier versión histórica de la aplicación</span><span class="sxs-lookup"><span data-stu-id="bd61c-284">Users may run any historical version of the app</span></span>

<span data-ttu-id="bd61c-285">Normalmente, los desarrolladores web esperan que los usuarios solo ejecuten la última versión implementada de su aplicación web, ya que es lo habitual en el modelo de distribución web tradicional.</span><span class="sxs-lookup"><span data-stu-id="bd61c-285">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="bd61c-286">Pero una PWA sin conexión es más similar a una aplicación móvil nativa, cuya versión ejecutada por los usuarios no siempre es la más reciente.</span><span class="sxs-lookup"><span data-stu-id="bd61c-286">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="bd61c-287">Como se ha explicado en la sección [Actualizaciones en segundo plano](#background-updates), después de implementar una actualización en la aplicación, **cada usuario existente sigue utilizando una versión anterior durante, al menos, una visita adicional** , porque la actualización se produce en segundo plano y no se activa hasta que el usuario se desplaza fuera de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-287">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="bd61c-288">Además, la versión anterior que se usa no es necesariamente la anterior que se ha implementado.</span><span class="sxs-lookup"><span data-stu-id="bd61c-288">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="bd61c-289">La versión anterior puede ser *cualquier* versión histórica, en función de la última vez que el usuario haya completado una actualización.</span><span class="sxs-lookup"><span data-stu-id="bd61c-289">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="bd61c-290">Esto puede ser un problema si los elementos de front-end y back-end de la aplicación requieren un acuerdo sobre el esquema para las solicitudes de API.</span><span class="sxs-lookup"><span data-stu-id="bd61c-290">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="bd61c-291">No debe implementar los cambios de esquema de API incompatibles con versiones anteriores hasta que se asegure de que todos los usuarios hayan realizado la actualización.</span><span class="sxs-lookup"><span data-stu-id="bd61c-291">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="bd61c-292">Como alternativa, impida que los usuarios utilicen versiones anteriores incompatibles de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-292">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="bd61c-293">Este requisito de escenario es el mismo que para las aplicaciones móviles nativas.</span><span class="sxs-lookup"><span data-stu-id="bd61c-293">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="bd61c-294">Si implementa un cambio importante en las API de servidor, la aplicación cliente se interrumpe para los usuarios que todavía no hayan realizado la actualización.</span><span class="sxs-lookup"><span data-stu-id="bd61c-294">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="bd61c-295">Si es posible, no implemente cambios importantes en las API de back-end.</span><span class="sxs-lookup"><span data-stu-id="bd61c-295">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="bd61c-296">Si tiene que hacerlo, considere la posibilidad de usar [API de trabajo de servicio estándar como ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) para determinar si la aplicación está actualizada y, en caso contrario, impedir que se use.</span><span class="sxs-lookup"><span data-stu-id="bd61c-296">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="bd61c-297">Interferencias con páginas representadas por el servidor</span><span class="sxs-lookup"><span data-stu-id="bd61c-297">Interference with server-rendered pages</span></span>

<span data-ttu-id="bd61c-298">Como se ha descrito en la sección [Compatibilidad de las páginas representadas por el servidor](#support-server-rendered-pages), si quiere omitir el comportamiento del trabajo de servicio de devolver contenido de `/index.html` para todas las solicitudes de navegación, modifique la lógica en el trabajo de servicio.</span><span class="sxs-lookup"><span data-stu-id="bd61c-298">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="bd61c-299">Almacenamiento en caché de todos los contenidos del manifiesto de recursos del trabajo de servicio de forma predeterminada</span><span class="sxs-lookup"><span data-stu-id="bd61c-299">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="bd61c-300">Como se ha descrito en la sección [Control del almacenamiento en caché de recursos](#control-asset-caching), el archivo `service-worker-assets.js` se genera durante la compilación y enumera todos los recursos que el trabajo de servicio debe capturar y almacenar en caché.</span><span class="sxs-lookup"><span data-stu-id="bd61c-300">As described in the [Control asset caching](#control-asset-caching) section, the file `service-worker-assets.js` is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="bd61c-301">Como en esta lista se incluye de forma predeterminada todo lo que se emite para `wwwroot` (incluido el contenido proporcionado por paquetes y proyectos externos), debe tener cuidado de no incluir demasiado contenido en él.</span><span class="sxs-lookup"><span data-stu-id="bd61c-301">Since this list by default includes everything emitted to `wwwroot`, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="bd61c-302">Si el directorio `wwwroot` contiene millones de imágenes, el trabajo de servicio intenta recuperarlas y almacenarlas en caché, lo que consume un ancho de banda excesivo y probablemente no se complete de forma correcta.</span><span class="sxs-lookup"><span data-stu-id="bd61c-302">If the `wwwroot` directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="bd61c-303">Implemente lógica arbitraria para controlar qué subconjunto del contenido del manifiesto se debe capturar y almacenar en caché mediante la edición de la función `onInstall` de `service-worker.published.js`.</span><span class="sxs-lookup"><span data-stu-id="bd61c-303">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in `service-worker.published.js`.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="bd61c-304">Interacción con la autenticación</span><span class="sxs-lookup"><span data-stu-id="bd61c-304">Interaction with authentication</span></span>

<span data-ttu-id="bd61c-305">La plantilla de PWA se puede usar junto con la autenticación.</span><span class="sxs-lookup"><span data-stu-id="bd61c-305">The PWA template can be used in conjunction with authentication.</span></span> <span data-ttu-id="bd61c-306">Una PWA que puede ejecutarse sin conexión también puede admitir la autenticación cuando el usuario tiene conectividad de red.</span><span class="sxs-lookup"><span data-stu-id="bd61c-306">An offline-capable PWA can also support authentication when the user has initial network connectivity.</span></span>

<span data-ttu-id="bd61c-307">Cuando un usuario no tiene conectividad de red, no puede autenticarse ni obtener tokens de acceso.</span><span class="sxs-lookup"><span data-stu-id="bd61c-307">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="bd61c-308">De forma predeterminada, si se intenta visitar la página de inicio de sesión sin acceso a la red, se genera un mensaje de "error de red".</span><span class="sxs-lookup"><span data-stu-id="bd61c-308">By default, attempting to visit the login page without network access results in a "network error" message.</span></span> <span data-ttu-id="bd61c-309">Debe diseñar un flujo de interfaz de usuario que permita al usuario realizar tareas útiles mientras está sin conexión sin tener que autenticarse u obtener tokens de acceso.</span><span class="sxs-lookup"><span data-stu-id="bd61c-309">You must design a UI flow that allows the user perform useful tasks while offline without attempting to authenticate the user or obtain access tokens.</span></span> <span data-ttu-id="bd61c-310">Como alternativa, puede diseñar la aplicación para que genere un error leve cuando la red no esté disponible.</span><span class="sxs-lookup"><span data-stu-id="bd61c-310">Alternatively, you can design the app to gracefully fail when the network isn't available.</span></span> <span data-ttu-id="bd61c-311">Si la aplicación no se puede diseñar para dar cabida a estos escenarios, probablemente no convenga habilitar la compatibilidad para ejecutarse sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-311">If the app can't be designed to handle these scenarios, you might not want to enable offline support.</span></span>

<span data-ttu-id="bd61c-312">Cuando una aplicación que está diseñada para usarse tanto con conexión como sin ella vuelve a conectarse:</span><span class="sxs-lookup"><span data-stu-id="bd61c-312">When an app that's designed for online and offline use is online again:</span></span>

* <span data-ttu-id="bd61c-313">Puede que la aplicación necesite aprovisionar un nuevo token de acceso.</span><span class="sxs-lookup"><span data-stu-id="bd61c-313">The app might need to provision a new access token.</span></span>
* <span data-ttu-id="bd61c-314">La aplicación debe detectar si un usuario diferente ha iniciado sesión en el servicio para poder realizar las operaciones en la cuenta del usuario que se efectuaron mientras estaba sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-314">The app must detect if a different user is signed into the service so that it can apply operations to the user's account that were made while they were offline.</span></span>

<span data-ttu-id="bd61c-315">Para crear una aplicación PWA sin conexión que interactúe con la autenticación:</span><span class="sxs-lookup"><span data-stu-id="bd61c-315">To create an offline PWA app that interacts with authentication:</span></span>

* <span data-ttu-id="bd61c-316">Reemplace <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> por una fábrica que almacene el último usuario que inició sesión y use el usuario almacenado cuando la aplicación esté sin conexión.</span><span class="sxs-lookup"><span data-stu-id="bd61c-316">Replace the <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> with a factory that stores the last signed-in user and uses the stored user when the app is offline.</span></span>
* <span data-ttu-id="bd61c-317">Ponga en cola las operaciones mientras la aplicación está sin conexión y realícelas cuando la aplicación vuelva a estar en línea.</span><span class="sxs-lookup"><span data-stu-id="bd61c-317">Queue operations while the app is offline and apply them when the app returns online.</span></span>
* <span data-ttu-id="bd61c-318">Al cerrar sesión, borre el usuario almacenado.</span><span class="sxs-lookup"><span data-stu-id="bd61c-318">During sign out, clear the stored user.</span></span>

<span data-ttu-id="bd61c-319">La aplicación de ejemplo [`CarChecker`](https://github.com/SteveSandersonMS/CarChecker) demuestra los métodos anteriores.</span><span class="sxs-lookup"><span data-stu-id="bd61c-319">The [`CarChecker`](https://github.com/SteveSandersonMS/CarChecker) sample app demonstrates the preceding approaches.</span></span> <span data-ttu-id="bd61c-320">Eche un vistazo a las siguientes partes de la aplicación:</span><span class="sxs-lookup"><span data-stu-id="bd61c-320">See the following parts of the app:</span></span>

* <span data-ttu-id="bd61c-321">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span><span class="sxs-lookup"><span data-stu-id="bd61c-321">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span></span>
* <span data-ttu-id="bd61c-322">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span><span class="sxs-lookup"><span data-stu-id="bd61c-322">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span></span>
* <span data-ttu-id="bd61c-323">Componente `LoginStatus` (`Client/Shared/LoginStatus.razor`)</span><span class="sxs-lookup"><span data-stu-id="bd61c-323">`LoginStatus` component (`Client/Shared/LoginStatus.razor`)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="bd61c-324">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="bd61c-324">Additional resources</span></span>

* [<span data-ttu-id="bd61c-325">Negociación entre orígenes de SignalR para la autenticación</span><span class="sxs-lookup"><span data-stu-id="bd61c-325">SignalR cross-origin negotiation for authentication</span></span>](xref:blazor/fundamentals/additional-scenarios#signalr-cross-origin-negotiation-for-authentication)
